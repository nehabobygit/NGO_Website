(function(g){var window=this;'use strict';var zFw=function(e){var a=new g.O$("und",new g.WO("Default","und",!0));a.captionTracks=e.captionTracks;return a},NT5=function(e){return new g.QM(function(a,r){var P=e.length,B=[];
if(P)for(var h=function(X,f){P--;B[X]=f;P==0&&a(B)},c=function(X){r(X)},y,T=0;T<e.length;T++)y=e[T],g.qWL(y,g.TV(h,T),c);
else a(B)})},im=function(e){this.S=e},zv=function(){im.apply(this,arguments)},x1a=function(){zv.apply(this,arguments)},Isb=function(){zv.apply(this,arguments)},HrG=function(){zv.apply(this,arguments)},qw5=function(){zv.apply(this,arguments)},vcl=function(){zv.apply(this,arguments)},RF8=function(){zv.apply(this,arguments)},SwN=function(){zv.apply(this,arguments)},s5a=function(){im.apply(this,arguments)},m1a=function(){zv.apply(this,arguments)},FS9=function(){zv.apply(this,arguments)},MOM=function(){zv.apply(this,
arguments)},j5M=function(){zv.apply(this,arguments)},uEG=function(){zv.apply(this,arguments)},KSB=function(){zv.apply(this,arguments)},ecG=function(){zv.apply(this,arguments)},aOB=function(){zv.apply(this,arguments)},rSN=function(){zv.apply(this,arguments)},Pba=function(){zv.apply(this,arguments)},B9V=function(){zv.apply(this,arguments)},hcV=function(){zv.apply(this,arguments)},cS9=function(){im.apply(this,arguments)},oqB=function(){zv.apply(this,arguments)},nq8=function(){zv.apply(this,arguments)},
ySN=function(){zv.apply(this,arguments)},T9G=function(){zv.apply(this,arguments)},X1M=function(){zv.apply(this,arguments)},fO9=function(){zv.apply(this,arguments)},ASN=function(){zv.apply(this,arguments)},Uqw=function(){zv.apply(this,arguments)},Cb5=function(){zv.apply(this,arguments)},GpV=function(){im.apply(this,arguments)},EqN=function(){im.apply(this,arguments)},beb=function(){im.apply(this,arguments)},tkB=function(){zv.apply(this,arguments)},gqB=function(){zv.apply(this,arguments)},ZeG=function(){zv.apply(this,
arguments)},OeM=function(){zv.apply(this,arguments)},kpM=function(){zv.apply(this,arguments)},dq5=function(){zv.apply(this,arguments)},JSb=function(){zv.apply(this,arguments)},DqZ=function(){zv.apply(this,arguments)},VkG=function(){zv.apply(this,arguments)},$qa=function(){zv.apply(this,arguments)},Qsl=function(){zv.apply(this,arguments)},WeB=function(){zv.apply(this,arguments)},lO8=function(){zv.apply(this,arguments)},Lea=function(){zv.apply(this,arguments)},Yew=function(){zv.apply(this,arguments)},
w1l=function(){zv.apply(this,arguments)},p1M=function(){zv.apply(this,arguments)},ieM=function(){zv.apply(this,arguments)},zc8=function(){zv.apply(this,arguments)},N9Z=function(){zv.apply(this,arguments)},xqw=function(){zv.apply(this,arguments)},IOG=function(){zv.apply(this,arguments)},Hea=function(){zv.apply(this,arguments)},qeM=function(){zv.apply(this,arguments)},vq5=function(){zv.apply(this,arguments)},Rcw=function(){zv.apply(this,arguments)},SeB=function(){zv.apply(this,arguments)},ssZ=function(){im.apply(this,
arguments)},mq9=function(){zv.apply(this,arguments)},FeN=function(){zv.apply(this,arguments)},Mk8=function(){zv.apply(this,arguments)},jsB=function(){zv.apply(this,arguments)},ut9=function(){zv.apply(this,arguments)},KeZ=function(){zv.apply(this,arguments)},ew5=function(){zv.apply(this,arguments)},aNB=function(){zv.apply(this,arguments)},rPN=function(){zv.apply(this,arguments)},PE5=function(){zv.apply(this,arguments)},BWG=function(){zv.apply(this,arguments)},hwG=function(){zv.apply(this,arguments)},
cPV=function(){zv.apply(this,arguments)},oPG=function(){zv.apply(this,arguments)},nPa=function(){zv.apply(this,arguments)},yPG=function(){zv.apply(this,arguments)},TW9=function(){zv.apply(this,arguments)},Xya=function(){zv.apply(this,arguments)},fN9=function(){zv.apply(this,arguments)},AP9=function(){zv.apply(this,arguments)},U_N=function(){zv.apply(this,arguments)},CE8=function(){zv.apply(this,arguments)},GQV=function(){zv.apply(this,arguments)},EPZ=function(){zv.apply(this,arguments)},bNa=function(){zv.apply(this,
arguments)},tCN=function(){zv.apply(this,arguments)},gPN=function(){zv.apply(this,arguments)},ZNa=function(){zv.apply(this,arguments)},ONa=function(){zv.apply(this,arguments)},kQG=function(){zv.apply(this,arguments)},d_8=function(){zv.apply(this,arguments)},JP8=function(){zv.apply(this,arguments)},D_G=function(){zv.apply(this,arguments)},VC9=function(e){e=e.key||e.id;
if(!e)throw Error("Entity key is missing");return e},$_8=function(){if(NF)return NF();
var e={};NF=g.MU("PersistentEntityStoreDb",{Gp:(e.EntityStore={W4:1},e.EntityAssociationStore={W4:2},e),shared:!1,upgrade:function(a,r){r(1)&&g.WU(g.d1(a,"EntityStore",{keyPath:"key"}),"entityType","entityType");r(2)&&(a=g.d1(a,"EntityAssociationStore",{keyPath:["parentEntityKey","childEntityKey"]}),g.WU(a,"byParentEntityKey","parentEntityKey"),g.WU(a,"byChildEntityKey","childEntityKey"))},
version:3});return NF()},QtV=function(e){return g.NU($_8(),e)},WKG=function(e){return g.NU((0,g.fX9)(),e)},xv=function(e){this.token=e},IC=function(e,a){a=a===void 0?{}:a;
g.I6.call(this,g.AKb[e],Object.assign({},{name:"PESEncoderError",type:e},a));this.type=e;this.level="WARNING";Object.setPrototypeOf(this,IC.prototype)},lNN=function(e){return new IC("WRONG_DATA_TYPE",{Il:e})},LKa=function(e){return e instanceof Error?new IC("UNKNOWN_ENCODE_ERROR",{originalMessage:e.message}):new IC("UNKNOWN_ENCODE_ERROR")},YoZ=function(e){return e instanceof Error?new IC("UNKNOWN_DECODE_ERROR",{originalMessage:e.message}):new IC("UNKNOWN_DECODE_ERROR")},wyN=function(e,a){e=e instanceof
IC?e:a(e);
g.D6(e);throw e;},py5=function(){},iNN=function(e,a,r){try{return e.B(a,r)}catch(P){wyN(P,LKa)}},zw8=function(e){e=(new TextEncoder).encode(e).subarray(0,16);
var a=new Uint8Array(16);a.set(e);return a},HX=function(e){this.S=e},x_Z=function(e){var a=NWN[e];
if(a)return a;g.VJ(new g.I6("Entity model not found.",{entityType:e}))},INl=function(e,a){this.S=e;
this.T=a;this.B={}},qo9=function(e,a){a:{e=HNB(e.T,a.version);
try{var r=e.T(a.data,a.key);break a}catch(P){wyN(P,YoZ)}r=void 0}return r},qF=function(e,a,r){return e.S.objectStore("EntityStore").get(a).then(function(P){if(P){if(r&&P.entityType!==r)throw Error("Incorrect entity type");
return qo9(e,P)}})},vX=function(e,a,r){return r?(r=r.map(function(P){return qF(e,P,a)}),g.bk.all(r)):e.S.objectStore("EntityStore").index("entityType").getAll(IDBKeyRange.only(a)).then(function(P){return P.map(function(B){return qo9(e,B)})})},Sx=function(e,a,r){var P=VC9(a),B=HNB(e.T,1),h=Object.assign({},a);
return e.S.objectStore("EntityStore").get(P).then(function(c){if(c){if(c.entityType!==r)throw Error("Incorrect entity type");h.entityMetadata||(c=qo9(e,c),h.entityMetadata=c.entityMetadata)}}).then(function(){var c={key:P,
entityType:r,data:iNN(B,h,P),version:1};return g.bk.all([g.VB(e.S.objectStore("EntityStore"),c),vPG(e,h,r)])}).then(function(){RC(e,P,r);
return P})},RwM=function(e,a,r){a=a.map(function(P){return Sx(e,P,r)});
return g.bk.all(a)},sB=function(e,a,r){if(r==null?0:r.iL){var P=new Set;
return Sol(e,a,P).then(function(){for(var h=[],c=g.Z(P),y=c.next();!y.done;y=c.next())h.push(sB(e,y.value));return g.bk.all(h).then(function(){})})}var B=g.sV(a).entityType;
return g.bk.all([e.S.objectStore("EntityStore").delete(a),stN(e,a)]).then(function(){RC(e,a,B)})},m_w=function(e,a){return g.w1(e.S.objectStore("EntityStore").index("entityType"),{query:IDBKeyRange.only(a)},function(r){return g.bk.all([r.delete(),
stN(e,r.cursor.primaryKey)]).then(function(){RC(e,r.cursor.primaryKey,a);return g.Ll(r)})})},FKZ=function(e,a,r,P){var B=HNB(e.T,1);
return qF(e,a,P).then(function(h){if(h){h=g.ag(h,r);var c={key:a,entityType:P,data:iNN(B,h,a),version:1};return g.bk.all([g.VB(e.S.objectStore("EntityStore"),c),vPG(e,h,P)])}}).then(function(){RC(e,a,P);
return a})},RC=function(e,a,r){var P=e.B[r];
P||(P=new Set,e.B[r]=P);P.add(a)},MCV=function(e,a,r){var P=VC9(a);
r=x_Z(r);if(!r)return g.bk.resolve([]);r=new r(a);e=e.S.objectStore("EntityAssociationStore");a=[];r=g.Z(r.T());for(var B=r.next();!B.done;B=r.next())a.push(g.VB(e,{parentEntityKey:P,childEntityKey:B.value}));return g.bk.all(a).then(function(h){return h.map(function(c){return c[1]})})},stN=function(e,a){return e.S.objectStore("EntityAssociationStore").index("byParentEntityKey").delete(IDBKeyRange.only(a))},vPG=function(e,a,r){var P=VC9(a);
return stN(e,P).then(function(){return MCV(e,a,r)})},Sol=function(e,a,r){if(r.has(a))return g.bk.resolve(void 0);
r.add(a);return jtM(e,a).then(function(P){return e.S.objectStore("EntityAssociationStore").index("byParentEntityKey").delete(IDBKeyRange.only(a)).then(function(){return P})}).then(function(P){var B=g.bk.resolve(void 0);
P=g.Z(P);for(var h=P.next(),c={};!h.done;c={dh:void 0},h=P.next())c.dh=h.value,B=B.then(function(y){return function(){return Sol(e,y.dh,r)}}(c));
return B}).then(function(){})},jtM=function(e,a){var r=e.S.objectStore("EntityAssociationStore");
return r.index("byParentEntityKey").getAll(IDBKeyRange.only(a)).then(function(P){var B=[];P=g.Z(P);for(var h=P.next();!h.done;h=P.next())h=h.value,B.push(r.index("byChildEntityKey").getAll(h.childEntityKey));return g.bk.all(B)}).then(function(P){var B=[];
P=g.Z(P);for(var h=P.next();!h.done;h=P.next())h=h.value,h.length===1&&B.push(h[0].childEntityKey);return B})},mL=function(){},uPb=function(){this.S={};
this.S[0]=new mL;if(!g.CK("aes_pes_encoder_killswitch")){var e=this.S;try{var a=g.Hh();var r=zw8(a);var P=new HX(new g.nC(r),new g.yP(r))}catch(B){throw e=B instanceof Error?new IC("KEY_CREATION_FAILED",{originalMessage:B.message}):new IC("KEY_CREATION_FAILED"),g.D6(e),e;}e[1]=P}},HNB=function(e,a){a=a===void 0?0:a;
e=e.S[a];if(!e)throw a=new IC("INVALID_ENCODER_VERSION",{Il:a}),g.D6(a),a;return e},FG=function(e,a){g.N.call(this);
this.token=e;this.S=a;this.observers=[];e=new g.uq.BroadcastChannel("PERSISTENT_ENTITY_STORE_SYNC:"+g.Hh());e.onmessage=this.T.bind(this);this.channel=e},MF=function(e,a,r){var P,B,h,c;
return g.Y(function(y){if(y.T==1)return g.l(y,QtV(e.token),2);if(y.T!=3)return P=y.S,g.l(y,g.DI(P,["EntityStore","EntityAssociationStore"],a,function(T){B=new INl(T,e.S);return r(B)}),3);
h=y.S;B&&(c=B.B,Object.keys(c).length>0&&(e.channel.postMessage(c),KK5(e,c)));return y.return(h)})},jx=function(e,a,r){return MF(e,{mode:"readwrite",
DD:!0},function(P){return Sx(P,a,r)})},e3b=function(e,a){return MF(e,{mode:"readwrite",
DD:!0},function(r){return RwM(r,a,"offlineOrchestrationActionWrapperEntity")})},a_G=function(e,a){return MF(e,{mode:"readwrite",
DD:!0},function(r){return sB(r,a)})},r49=function(e){return MF(e,{mode:"readwrite",
DD:!0},function(a){return m_w(a,"videoPlaybackPositionEntity")})},um=function(e,a,r){return MF(e,{mode:"readonly",
DD:!0},function(P){return qF(P,a,r)})},Kb=function(e,a,r){return MF(e,{mode:"readonly",
DD:!0},function(P){return vX(P,a,r)})},KK5=function(e,a){e=g.Z(e.observers);
for(var r=e.next();!r.done;r=e.next())r=r.value,r(a)},PTN=function(){var e,a,r;
return g.Y(function(P){if(P.T==1)return g.kN(P,2),g.l(P,g.mQ(),4);if(P.T!=2){e=P.S;if(!e||!g.ql()||typeof g.uq.BroadcastChannel==="undefined")return P.return();a=new uPb;return P.return(new FG(e,a))}r=g.Q3(P);r instanceof Error&&g.D6(r);return P.return()})},e4=function(){BkG||(BkG=PTN());
return BkG},h3G=function(e){var a;
e=(a=e.options)==null?void 0:a.persistenceOption;return e==="ENTITY_PERSISTENCE_OPTION_PERSIST"||e==="ENTITY_PERSISTENCE_OPTION_INMEMORY_AND_PERSIST"},c4a=function(e){var a;
return g.Y(function(r){return r.T==1?g.l(r,e4(),2):(a=r.S)?g.l(r,MF(a,"readwrite",function(P){for(var B={},h=g.Z(e),c=h.next(),y={};!c.done;y={h4:void 0,fA:void 0},c=h.next())y.h4=c.value,y.h4.entityKey&&h3G(y.h4)&&(y.fA=g.Pd(y.h4.payload),c=void 0,y.h4.type==="ENTITY_MUTATION_TYPE_REPLACE"&&(c=function(T){return function(){return Sx(P,T.h4.payload[T.fA],T.fA)}}(y)),y.h4.type==="ENTITY_MUTATION_TYPE_DELETE"&&(c=function(T){return function(){return sB(P,T.h4.entityKey)}}(y)),y.h4.type==="ENTITY_MUTATION_TYPE_UPDATE"&&
(c=function(T){return function(){return FKZ(P,T.h4.entityKey,T.h4.payload[T.fA],T.fA)}}(y)),c&&(B[y.h4.entityKey]=B[y.h4.entityKey]?B[y.h4.entityKey].then(c):c()));
return g.bk.all(Object.values(B))}),0):r.return()})},oON=function(e){var a;
return g.Y(function(r){if(r.T==1){a=e.mutations;if(!a||a.length<=0)return r.return();if(g.k0){var P={type:"ENTITY_LOADED"};a!==void 0&&(P.payload=a);g.k0.dispatch(P)}return g.l(r,c4a(a),2)}a.length=0;g.OO(r)})},nO8=function(e){return e!==void 0},y49=function(e){var a=g.KQ();
a=Object.assign({},a);e=Object.assign({},e);for(var r in a)e[r]?(a[r]!==4&&(a[r]=e[r]),delete e[r]):a[r]!==2&&(a[r]=4);Object.assign(a,e);g.I83(a);JSON.stringify(a);return a},TkG=function(e){var a,r;
return g.Y(function(P){if(P.T==1)return g.l(P,g.mQ(),2);if(P.T!=3)return(a=P.S)?g.l(P,g.r3(a),3):P.return();r=P.S;return P.return(g.DI(r,["index","media","captions"],{mode:"readwrite",DD:!0},function(B){var h=IDBKeyRange.bound(e+"|",e+"~");B=[B.objectStore("index").delete(h),B.objectStore("media").delete(h),B.objectStore("captions").delete(h)];return g.bk.all(B).then(function(){})}))})},XnZ=function(){var e,a;
return g.Y(function(r){if(r.T==1)return g.l(r,g.mQ(),2);if(r.T!=3){e=r.S;if(!e)throw g.GE("rvdfd");return g.l(r,g.r3(e),3)}a=r.S;return r.return(g.DI(a,["index","media"],{mode:"readwrite",DD:!0},function(P){var B={};return g.lk(P.objectStore("index"),{},function(h){var c=h.cursor.key.match(/^([\w\-_]+)\|(a|v)$/),y=g.bk.resolve(void 0);if(c){var T=c[1];c=c[2];B[T]=B[T]||{};var X;B[T][c]=g.SEO((X=h.getValue())==null?void 0:X.fmts)}else y=h.delete().then(function(){});
return g.bk.all([g.Ll(h),y]).then(function(f){return g.Z(f).next().value})}).then(function(){for(var h={},c=g.Z(Object.keys(B)),y=c.next();!y.done;y=c.next()){y=y.value;
var T=B[y].v;h[y]=B[y].a&&T?1:2}var X=y49(h);return g.deq(P.objectStore("media"),{},function(f){var A=f.cursor.key.match(g.M9J);A&&h[A[1]]||P.objectStore("media").delete(f.cursor.key);return g.C9q(f)}).then(function(){return X})})}))})},f_N=function(e,a){var r,P;
return g.Y(function(B){if(B.T==1)return g.l(B,g.mQ(),2);if(B.T!=3){r=B.S;if(!r)throw g.GE("wct");return g.l(B,g.r3(r),3)}P=B.S;return g.l(B,g.DI(P,["captions"],{mode:"readwrite",DD:!0},function(h){var c=[];h=h.objectStore("captions");for(var y=0;y<a.length;y++){var T=g.VB(h,a[y],e+"|"+a[y].metadata.vss_id);c.push(T)}return g.bk.all(c)}),0)})},A4N=function(e){var a,r,P;
return g.Y(function(B){if(B.T==1)return a=IDBKeyRange.bound(e+"|",e+"~"),g.l(B,g.mQ(),2);if(B.T!=3){r=B.S;if(!r)throw g.GE("gactfv");return g.l(B,g.r3(r),3)}P=B.S;return B.return(P.getAll("captions",a))})},UiG=function(e){return g.Y(function(a){g.aG(e,0);
return a.return(TkG(e))})},CTG=function(e){return{context:g.sK(),
videoIds:e}},GYB=function(e){return{context:g.sK(),
playlistIds:e}},EON=function(e){return{context:g.sK(),
offlinePlaylistSyncChecks:e}},bp8=function(){this.S=new Map},gOZ=function(){tUN||(tUN=new bp8);
return tUN},Zp5=function(e,a){return{eventType:{flowEventNamespace:"FLOW_EVENT_NAMESPACE_OFFLINE_ORCHESTRATION",
flowEventType:e},metadata:a,statusCode:void 0,csn:void 0,can:void 0}},OpM=function(e,a,r){if(!r){var P=P===void 0?!1:P;
r=e.S.get("FLOW_TYPE_OFFLINE_ORCHESTRATION");if(!r||P)r=g.Ch(16),e.S.set("FLOW_TYPE_OFFLINE_ORCHESTRATION",r)}e={flowNonce:r,flowType:"FLOW_TYPE_OFFLINE_ORCHESTRATION",flowEventType:a.eventType};a.metadata&&(e.flowMetadata=a.metadata);a.statusCode!==void 0&&(e.flowEventStatus=a.statusCode);a.csn&&(e.csn=a.csn);a.can&&(e.can=a.can);g.BU("flowEvent",e,void 0)},kYG=function(e){var a,r,P,B,h,c,y,T,X,f,A,U,C,G,O,d,W,V,L,z,q,M,m,cI,CL,nL,y3,aT,$N,F4,ea,EG,n5,lq,cd,iN,vB,oQ,Q,IQ;
return g.Y(function(L5){if(L5.T==1)return g.l(L5,MF(e,{mode:"readonly",DD:!0},function(PI){return vX(PI,"playbackData").then(function(Jw){var k=Jw.map(function(IZ){return IZ.transfer}).filter(function(IZ){return!!IZ}),r4=Jw.map(function(IZ){return IZ.offlineVideoPolicy}).filter(function(IZ){return!!IZ}),Lf=Jw.filter(function(IZ){return!!IZ.key}).map(function(IZ){return g.mf(g.sV(IZ.key).entityId,"downloadStatusEntity")});
k=vX(PI,"transfer",k);r4=vX(PI,"offlineVideoPolicy",r4);Lf=vX(PI,"downloadStatusEntity",Lf);var nD=k.then(function(IZ){IZ=IZ.reduce(function(sO,rb){(rb==null?0:rb.offlineVideoStreams)&&sO.push.apply(sO,g.UO(rb.offlineVideoStreams));return sO},[]).filter(function(sO){return!!sO});
return vX(PI,"offlineVideoStreams",IZ)});
return g.bk.all([k,r4,nD,Lf]).then(function(IZ){var sO=g.Z(IZ);IZ=sO.next().value;var rb=sO.next().value;var aD=sO.next().value;sO=sO.next().value;return[Jw,IZ,rb,aD,sO]})})}),2);
if(L5.T!=3)return a=L5.S,g.l(L5,MF(e,{mode:"readonly",DD:!0},function(PI){return vX(PI,"mainDownloadsListEntity").then(function(Jw){var k,r4;return(r4=(k=Jw[0])==null?void 0:k.downloads)!=null?r4:[]})}),3);
r=L5.S;P=g.Z(a);B=P.next().value;h=P.next().value;c=P.next().value;y=P.next().value;T=P.next().value;X=B;f=h;A=c;U=y;C=T;G={};O={};d={};W={};V={};L=[];z=g.Z(f);for(q=z.next();!q.done;q=z.next())(M=q.value)&&(G[M.key]=M);m=g.Z(A);for(cI=m.next();!cI.done;cI=m.next())(CL=cI.value)&&(O[CL.key]=CL);nL=g.Z(C);for(y3=nL.next();!y3.done;y3=nL.next())(aT=y3.value)&&(d[aT.key]=aT);$N=g.Z(U);for(F4=$N.next();!F4.done;F4=$N.next())(ea=F4.value)&&(W[ea.key]=ea);EG=g.Z(r);for(n5=EG.next();!n5.done;n5=EG.next())lq=
n5.value,cd=void 0,V[(cd=lq.videoItem)!=null?cd:""]=!0,lq.videoItem&&(vB=iN=void 0,oQ=(vB=(iN=g.sV(lq.videoItem))==null?void 0:iN.entityId)!=null?vB:"",L.push({externalVideoId:oQ}));Q=X.filter(function(PI){if(!PI||!PI.key||!PI.offlineVideoPolicy)return!1;PI=g.sV(PI.key).entityId;PI=g.mf(PI,"downloadStatusEntity");var Jw;return!(PI&&((Jw=d[PI])==null?void 0:Jw.downloadState)==="DOWNLOAD_STATE_USER_DELETED")});
IQ=Q.map(function(PI){var Jw=G[PI.transfer],k=[];if(Jw==null?0:Jw.offlineVideoStreams)for(var r4=g.Z(Jw.offlineVideoStreams),Lf=r4.next();!Lf.done;Lf=r4.next())(Lf=W[Lf.value])&&k.push(Lf);r4=O[PI.offlineVideoPolicy];Lf=V;var nD=PI==null?void 0:PI.playerResponseTimestamp,IZ=g.sV(r4.key).entityId;PI=g.mf(IZ,"mainVideoEntity");if(r4.action==="OFFLINE_VIDEO_POLICY_ACTION_DISABLE"){var sO="OFFLINE_VIDEO_STATE_DISABLED";r4.expirationTimestamp&&Number(r4.expirationTimestamp)<Date.now()/1E3&&(sO="OFFLINE_VIDEO_STATE_EXPIRED")}else if(r4.action===
"OFFLINE_VIDEO_POLICY_ACTION_DOWNLOAD_FAILED")sO="OFFLINE_VIDEO_STATE_OFFLINE_FAILED";else{switch(Jw==null?void 0:Jw.transferState){case "TRANSFER_STATE_TRANSFER_IN_QUEUE":sO="OFFLINE_VIDEO_STATE_PENDING";break;case "TRANSFER_STATE_TRANSFERRING":sO="OFFLINE_VIDEO_STATE_TRANSFERRING";break;case "TRANSFER_STATE_PAUSED_BY_USER":sO="OFFLINE_VIDEO_STATE_PAUSED_TRANSFER";break;case "TRANSFER_STATE_FAILED":sO="OFFLINE_VIDEO_STATE_OFFLINE_FAILED";break;case "TRANSFER_STATE_COMPLETE":sO="OFFLINE_VIDEO_STATE_PLAYABLE";
break;case "TRANSFER_STATE_WAITING_FOR_PLAYER_RESPONSE_REFRESH":sO="OFFLINE_VIDEO_STATE_STREAMS_OUT_OF_DATE";break;default:sO="OFFLINE_VIDEO_STATE_UNKNOWN"}if(sO==="OFFLINE_VIDEO_STATE_OFFLINE_FAILED")switch(Jw==null?void 0:Jw.failureReason){case "TRANSFER_FAILURE_REASON_EXTERNAL_FILESYSTEM_WRITE":case "TRANSFER_FAILURE_REASON_FILESYSTEM_WRITE":sO="OFFLINE_VIDEO_STATE_OUT_OF_STORAGE_ERROR";break;case "TRANSFER_FAILURE_REASON_STREAM_MISSING":sO="OFFLINE_VIDEO_STATE_STREAMS_MISSING";break;case "TRANSFER_FAILURE_REASON_NETWORK":case "TRANSFER_FAILURE_REASON_NETWORK_LOST":sO=
"OFFLINE_VIDEO_STATE_NETWORK_ERROR"}}IZ={id:IZ,videoState:sO};if(Jw==null?0:Jw.cotn)IZ.cotn=Jw.cotn;if(Jw==null?0:Jw.maximumDownloadQuality)IZ.selectedVideoQuality=Jw==null?void 0:Jw.maximumDownloadQuality;if(Jw==null?0:Jw.lastProgressTimeMs)IZ.lastProgressTimeMs=Jw.lastProgressTimeMs;nD&&(IZ.playerResponseSavedTimeMs=String(Number(nD)*1E3));Jw=String;nD=0;k=g.Z(k);for(sO=k.next();!sO.done;sO=k.next())if(sO=sO.value,sO.streamsProgress){sO=g.Z(sO.streamsProgress);for(var rb=sO.next();!rb.done;rb=sO.next()){var aD=
void 0;nD+=Number((aD=rb.value.numBytesDownloaded)!=null?aD:0)}}IZ.downloadedBytes=Jw(nD);IZ.selectedOfflineMode=Lf[PI]?"OFFLINE_MODE_TYPE_AUTO_OFFLINE":"OFFLINE_NOW";r4.action==="OFFLINE_VIDEO_POLICY_ACTION_DISABLE"&&(IZ.offlinePlaybackDisabledReason=r4.offlinePlaybackDisabledReason);return IZ});
return L5.return({offlineVideos:IQ,additionalOfflineClientState:{mainAppAdditionalOfflineClientState:{smartDownloadVideos:L}}})})},dia=function(){this.locks=navigator.locks},J4b=function(){try{var e=g.aZ("ytglobal.locks_");
if(e)return e;var a;if(a=navigator){var r=navigator;a="locks"in r&&!!r.locks}if(a)return g.uq.localStorage&&g.uq.localStorage.getItem("noop"),e=new dia,g.KL("ytglobal.locks_",e),e}catch(P){}},ao=function(){},DiN=function(){},VUl=function(e){if(e.includes(":"))throw Error("Invalid user cache name: "+e);
return e+":"+g.Hh("CacheStorage get")},$iN=function(){return g.Y(function(e){if(rB!==void 0)return e.return(rB);
rB=new Promise(function(a){var r;return g.Y(function(P){switch(P.T){case 1:return g.kN(P,2),g.l(P,Pq.open("test-only"),4);case 4:return g.l(P,Pq.delete("test-only"),5);case 5:g.Dl(P,3);break;case 2:if(r=g.Q3(P),r instanceof Error&&r.name==="SecurityError")return a(!1),P.return();case 3:a("caches"in window),g.OO(P)}})});
return e.return(rB)})},W0B=function(){return g.Y(function(e){if(e.T==1)return g.l(e,$iN(),2);
if(!e.S)return e.return(void 0);QzB||(QzB=new DiN);return e.return(QzB)})},Bq=function(e,a,r){g.VJ(new g.I6("Woffle: "+e,r?{cotn:r}:""));
a instanceof Error&&g.VJ(a)},l_B=function(e){var a;
return g.Y(function(r){if(r.T==1)return g.l(r,kYG(e),2);a=r.S;g.BU("offlineStateSnapshot",a);g.OO(r)})},h8=function(e){g.N.call(this);
var a=this;this.api=e;this.Ob={Mdm:function(){return a.S},
EXM:function(){return a.T}};
typeof g.uq.BroadcastChannel!=="undefined"&&(this.S=new g.uq.BroadcastChannel("PLAYER_OFFLINE_ERROR_SYNC:"+g.Hh()),this.S.onmessage=this.B.bind(this),this.T=new g.uq.BroadcastChannel("PLAYER_OFFLINE_PAUSE_SYNC:"+g.Hh()),this.T.onmessage=this.L.bind(this))},cq=function(e,a){e.api.qF("onOfflineOperationFailure",a);
var r;(r=e.S)==null||r.postMessage(a)},L0w=function(e,a,r){var P=this;
this.Y=e;this.N=a;this.visibility=r;this.C=this.D=this.Z=this.B=this.S=!1;this.L=new g.vP(function(){P.m7()});
this.Ob={wq:function(){return P.T},
m7:function(){P.m7()},
wS1:function(){return P.L}};
this.visibility.subscribe("visibilitystatechange",function(){P.GG()})},YmZ=function(e){if(!e.B&&!e.S){var a=J4b();
if(a){e.B=!0;var r=g.Hh("OfflineLockManager");a.request("woffle_orchestration_leader:"+r,{},function(){var P,B;return g.Y(function(h){switch(h.T){case 1:return g.kN(h,2),e.T=new g.fp,e.S=!0,e.B=!1,g.l(h,e.Y(),4);case 4:return g.l(h,e.T.promise,5);case 5:g.Dl(h,0);break;case 2:P=g.Q3(h),e.m7(),P instanceof Error&&(B=P,B.args=[{name:"WoLockManagerError",Hb:P.name}],g.D6(B)),g.OO(h)}})})}}},wn9=function(e){e.S&&(e.C=!0,oo(e))},pnN=function(e,a){e.S&&(e.Z=a,oo(e))},ipb=function(e,a){e.S&&(e.D=a,oo(e))},
oo=function(e){e.D&&e.Z&&e.C&&e.visibility.isBackground()?g.sC(e.L,6E4):e.L.stop()},nM=function(e){var a;
e.offlineDeleteReason=(a=e.offlineDeleteReason)!=null?a:"OFFLINE_DELETE_REASON_UNKNOWN";var r;e.offlineModeType=(r=e.offlineModeType)!=null?r:"OFFLINE_NOW";g.BU("offlineDeleteEvent",e)},yS=function(e,a){var r=a.videoId;
var P=a.rb;a=a.offlineModeType;e.encryptedVideoId=r;e.cotn=P==null?void 0:P.cotn;e.offlineabilityFormatType=P==null?void 0:P.maximumDownloadQuality;var B;e.isRefresh=(B=P==null?void 0:P.isRefresh)!=null?B:!1;var h;e.softErrorCount=(h=P==null?void 0:P.transferRetryCount)!=null?h:0;e.offlineModeType=a!=null?a:"OFFLINE_NOW";(e.transferStatusType==="TRANSFER_STATUS_TYPE_UNKNOWN"&&e.statusType==="UNKNOWN_STATUS_TYPE"||!e.transferStatusType&&!e.statusType)&&g.VJ(Error("Woffle unknown transfer status"));
g.BU("offlineTransferStatusChanged",e)},z35=function(e){yS({transferStatusType:"TRANSFER_STATUS_TYPE_ENQUEUED",
statusType:"ADDED_TO_QUEUE"},e)},Nkl=function(e,a,r,P){P={transferStatusType:"TRANSFER_STATUS_TYPE_PROCESSING",
statusType:"OFFLINING_STARTED",transferFirstStarted:!!P};a&&r&&(a=Math.floor(a/1024).toFixed(),r=Math.floor(r/1024).toFixed(),P.alreadyDownloadedKbytes=a,P.totalFetchedKbytes=a,P.totalContentKbytes=r);yS(P,e)},xi8=function(e){yS({transferStatusType:"TRANSFER_STATUS_TYPE_REENQUEUED_BY_PLAYER_RESPONSE_REFRESH"},e)},I_G=function(e){yS({transferStatusType:"TRANSFER_STATUS_TYPE_DEQUEUED_BY_USER_PAUSE",
statusType:"SUSPENDED"},e)},Hpw=function(e){switch(e){case "TRANSFER_FAILURE_REASON_FILESYSTEM_WRITE":case "TRANSFER_FAILURE_REASON_EXTERNAL_FILESYSTEM_WRITE":return"OFFLINE_DATABASE_ERROR";
case "TRANSFER_FAILURE_REASON_PLAYABILITY":return"NOT_PLAYABLE";case "TRANSFER_FAILURE_REASON_TOO_MANY_RETRIES":return"TOO_MANY_RETRIES";case "TRANSFER_FAILURE_REASON_INTERNAL":return"OFFLINE_DOWNLOAD_CONTROLLER_ERROR";case "TRANSFER_FAILURE_REASON_STREAM_MISSING":return"STREAM_VERIFICATION_FAILED";case "TRANSFER_FAILURE_REASON_SERVER":case "TRANSFER_FAILURE_REASON_SERVER_PROPERTY_MISSING":return"OFFLINE_REQUEST_FAILURE";case "TRANSFER_FAILURE_REASON_NETWORK":return"OFFLINE_NETWORK_ERROR";default:return"UNKNOWN_FAILURE_REASON"}},
Tf=function(e){var a,r,P;
return((P=(a=e.actionMetadata)==null?void 0:(r=a.retryScheduleIntervalsInSeconds)==null?void 0:r.length)!=null?P:0)>0},XA=function(e){return e.actionType==="OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD"&&!!e.entityKey},fM=function(e){return e.actionType==="OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH"&&!!e.entityKey},A8=function(e){return e.actionType==="OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE"&&!!e.entityKey},qmG=function(e){return e.actionType==="OFFLINE_ORCHESTRATION_ACTION_TYPE_UPDATE"&&!!e.entityKey},
U6=function(e,a,r,P,B){B=B===void 0?!1:B;
var h,c,y,T,X,f;return g.Y(function(A){if(A.T==1)return h=g.mf(e,a),c=g.mf(e,"downloadStatusEntity"),g.l(A,MF(r,{mode:"readonly",DD:!0},function(U){return g.bk.all([qF(U,h,a),qF(U,c,"downloadStatusEntity")])}),2);
y=A.S;T=y.length?y[0]:void 0;if(!T)return A.Oo(0);X=vO9;if(f=y.length>1?y[1]:void 0){if(f.downloadState==="DOWNLOAD_STATE_USER_DELETED"&&!B)return A.return();f.downloadState=P}else f={key:c,downloadState:P};g.L4(T,X,f);return g.l(A,MF(r,{mode:"readwrite",DD:!0},function(U){return g.bk.all([Sx(U,T,a),Sx(U,f,"downloadStatusEntity")])}),0)})},CM=function(e,a){return e.actionType===a.actionType&&e.entityKey===a.entityKey},Gf=function(e,a){if(e&&e.transferState!=="TRANSFER_STATE_COMPLETE"&&e.transferState!==
"TRANSFER_STATE_FAILED"){var r=g.sV(e.key).entityId;
yS({transferStatusType:"TRANSFER_STATUS_TYPE_TERMINATED_BY_USER",statusType:"CANCELLED"},{videoId:r,rb:e,offlineModeType:a})}},E6=function(e){if(!e||!e.thumbnails)return[];
var a=[];e=g.Z(e.thumbnails);for(var r=e.next();!r.done;r=e.next())r=r.value,r.url&&a.push(r.url);return a},R3V=function(e,a,r){r=r===void 0?[]:r;
var P,B,h,c,y,T,X,f,A,U,C,G,O;return g.Y(function(d){if(d.T==1)return r.length?g.l(d,Kb(e,a),2):d.return([]);P=d.S;B=new Set;h=g.Z(P);for(c=h.next();!c.done;c=h.next())if(y=c.value,T=y.id||y.key)X=g.sV(T).entityId,B.add(X);f=[];A=g.Z(r);for(U=A.next();!U.done;U=A.next())C=U.value,G=C.offlineVideoData,O=void 0,((O=G)==null?0:O.videoId)&&!B.has(G.videoId)&&f.push(C);return d.return(f)})},Sm8=function(e,a,r){return new g.UT(e,{cotn:a,
raw_player_response:r,download_media:!0,start:Infinity,disable_watch_next:!0})},szl=function(){return{priority:1,
retryScheduleIntervalsInSeconds:[1,2,4]}},bM=function(e,a,r,P,B,h,c,y,T,X,f){this.entityType=e;
this.actionId=a;this.action=r;this.parentActionId=P;this.rootActionId=B===void 0?a:B;this.childActionIds=h;this.prereqActionId=c;this.postreqActionIds=y;this.hasChildActionFailed=X;this.retryScheduleIndex=0;this.S=f||Date.now();this.retryScheduleIndex=T||0},t8=function(e){if(!e.key)throw Error("Entity key is required.");
if(!e.actionProto)throw Error("OfflineOrchestrationAction is required.");var a=g.sV(e.key),r=g.sV(e.actionProto.entityKey);return new bM(r.entityType,a.entityId,e.actionProto,e.parentActionId,e.rootActionId,e.childActionIds,e.prereqActionId,e.postreqActionIds,e.retryScheduleIndex,e.hasChildActionFailed,Number(e.enqueueTimeSec)*1E3)},gB=function(e){return{key:g.mf(e.actionId,"offlineOrchestrationActionWrapperEntity"),
actionProto:e.action,parentActionId:e.parentActionId,rootActionId:e.rootActionId,childActionIds:e.childActionIds,prereqActionId:e.prereqActionId,postreqActionIds:e.postreqActionIds,retryScheduleIndex:e.retryScheduleIndex,hasChildActionFailed:e.hasChildActionFailed,enqueueTimeSec:(e.S/1E3).toFixed()}},miB=function(){var e;
return g.Y(function(a){return a.T==1?g.l(a,W0B(),2):(e=a.S)?a.return(e.delete("yt-player-local-img")):a.return(!0)})},Zr=function(e){var a,r;
return g.Y(function(P){if(P.T==1)return g.l(P,W0B(),2);if(P.T!=3){a=P.S;if(!a)throw Error("Cache API not supported");return e.length?g.l(P,a.open("yt-player-local-img"),3):P.return()}r=P.S;return g.l(P,Promise.all(e.map(function(B){return r.delete(B)})),0)})},O6=function(e){var a,r;
return g.Y(function(P){if(P.T==1)return g.l(P,W0B(),2);if(P.T!=3){a=P.S;if(!a)throw Error("Cache API not supported");return e.length?g.l(P,a.open("yt-player-local-img"),3):P.return()}r=P.S;return g.l(P,r.addAll(e),0)})},ko=function(e,a,r,P,B){var h,c,y,T,X,f,A,U,C,G,O,d,W,V,L,z,q,M,m,cI,CL,nL,y3,aT,$N,F4,ea,EG,n5,lq,cd;
return g.Y(function(iN){switch(iN.T){case 1:return h=g.mf(e,"mainVideoEntity"),c=g.mf(e,"ytMainChannelEntity"),y=g.mf(e,"transfer"),T=g.mf(e,"videoDownloadContextEntity"),g.l(iN,MF(a,{mode:"readonly",DD:!0},function(vB){return g.bk.all([qF(vB,h,"mainVideoEntity"),qF(vB,c,"ytMainChannelEntity"),qF(vB,y,"transfer"),qF(vB,T,"videoDownloadContextEntity"),vX(vB,"ytMainChannelEntity"),vX(vB,"offlineOrchestrationActionWrapperEntity")])}),2);
case 2:X=iN.S;f=g.Z(X);A=f.next().value;U=f.next().value;C=f.next().value;G=f.next().value;O=f.next().value;d=f.next().value;W=A;V=U;L=C;z=G;q=O;M=d;if(!W&&!V){iN.Oo(3);break}m=W?E6(W.thumbnail):[];if(!V){cI=[];iN.Oo(4);break}return g.l(iN,F08(V,q),5);case 5:cI=iN.S;case 4:return CL=cI,g.l(iN,Zr(m.concat(CL)),3);case 3:nL=[];y3=g.mf(e,"downloadStatusEntity");aT=g.Z(M);for($N=aT.next();!$N.done;$N=aT.next())F4=$N.value,ea=g.sV(F4.key).entityId,EG=t8(F4),n5=g.sV(EG.action.entityKey).entityId,ea!==e&&
n5!==e||CM(r,F4.actionProto)||nL.push(F4.key);return g.l(iN,MF(a,{mode:"readwrite",DD:!0},function(vB){var oQ=nL.map(function(Q){return sB(vB,Q)});
oQ.push(sB(vB,h,{iL:!0}));oQ.push(sB(vB,y3,{iL:!0}));return g.bk.all(oQ)}),7);
case 7:cd=(lq=z)==null?void 0:lq.offlineModeType,B&&(nM(B),B.offlineModeType&&(cd=B.offlineModeType)),Gf(L,cd),cq(P,{entityKey:h,failureReason:"OFFLINE_OPERATION_FAILURE_REASON_VIDEO_DELETED"}),g.OO(iN)}})},uDN=function(e,a,r,P){var B,h,c,y,T,X,f,A,U,C,G,O,d,W,V,L,z,q,M,m,cI,CL,nL,y3,aT,$N,F4,ea,EG,n5,lq,cd,iN,vB,oQ,Q,IQ,L5,PI,Jw,k,r4,Lf,nD,IZ,sO,rb,aD,Hd,J;
return g.Y(function(t){switch(t.T){case 1:return B=g.mf(e,"mainPlaylistEntity"),h=g.mf(e,"ytMainChannelEntity"),g.l(t,MF(a,{mode:"readonly",DD:!0},function(D){return g.bk.all([qF(D,B,"mainPlaylistEntity"),qF(D,h,"ytMainChannelEntity"),vX(D,"mainPlaylistEntity"),vX(D,"mainDownloadsListEntity"),vX(D,"ytMainChannelEntity"),vX(D,"offlineOrchestrationActionWrapperEntity")])}),2);
case 2:c=t.S;y=g.Z(c);T=y.next().value;X=y.next().value;f=y.next().value;A=y.next().value;U=y.next().value;C=y.next().value;G=T;O=X;d=f;W=A;V=U;L=C;if(!G&&!O){t.Oo(3);break}z=G?MUM(G):[];if(!O){q=[];t.Oo(4);break}return g.l(t,F08(O,V),5);case 5:q=t.S;case 4:return M=q,g.l(t,Zr(z.concat(M)),3);case 3:m=[];cI=new Map;if(!G){t.Oo(7);break}return g.l(t,jzB(G,d,W),8);case 8:m=t.S;CL=g.Z(m);for(nL=CL.next();!nL.done;nL=CL.next())y3=nL.value,cI.set(y3,{videoId:y3,playlistId:e,offlineDeleteReason:"OFFLINE_DELETE_REASON_PARENT_LIST_DELETE"});
return g.l(t,MF(a,{mode:"readonly",DD:!0},function(D){return g.bk.all([vX(D,"transfer"),vX(D,"videoDownloadContextEntity")])}),9);
case 9:aT=t.S;$N=g.Z(aT);F4=$N.next().value;ea=$N.next().value;EG=F4;n5=ea;lq=g.Z(EG);for(cd=lq.next();!cd.done;cd=lq.next())iN=cd.value,vB=g.sV(iN.key).entityId,(oQ=cI.get(vB))&&iN&&(oQ.cotn=iN.cotn);Q=g.Z(n5);for(IQ=Q.next();!IQ.done;IQ=Q.next())L5=IQ.value,PI=g.sV(L5.key).entityId,(Jw=cI.get(PI))&&L5&&(Jw.offlineModeType=L5.offlineModeType);case 7:k=[];r4=g.Z(L);for(Lf=r4.next();!Lf.done;Lf=r4.next())nD=Lf.value,IZ=g.sV(nD.key).entityId,sO=t8(nD),IZ!==e&&sO.rootActionId!==e||CM(r,nD.actionProto)||
k.push(nD.key);rb=g.mf(e,"mainPlaylistEntity");return g.l(t,MF(a,{mode:"readwrite",DD:!0},function(D){var w=k.map(function(I){return sB(D,I)});
w.push(sB(D,rb,{iL:!0}));return g.bk.all(w)}),10);
case 10:if(!G){t.Oo(0);break}m.reverse();if(!m){t.Oo(0);break}aD=g.Z(m);Hd=aD.next();case 13:if(Hd.done){t.Oo(0);break}J=Hd.value;return g.l(t,ko(J,a,r,P,cI.get(J)),14);case 14:Hd=aD.next(),t.Oo(13)}})},et9=function(e,a,r,P){var B,h,c,y,T,X,f,A,U;
return g.Y(function(C){if(C.T==1)return B=g.mf("DOWNLOADS_LIST_ENTITY_ID_MANUAL_DOWNLOADS","mainDownloadsListEntity"),h=new Map,g.l(C,MF(e,{mode:"readwrite",DD:!0},function(G){var O=vX(G,"transfer"),d=vX(G,"offlineOrchestrationActionWrapperEntity"),W=vX(G,"videoDownloadContextEntity"),V=qF(G,B,"mainDownloadsListEntity");return g.bk.all([O,d,W,V]).then(function(L){L=g.Z(L);var z=L.next().value;var q=L.next().value;var M=L.next().value;var m=L.next().value;L=K0b.map(function(CL){return m_w(G,CL)});
q=g.Z(q);for(var cI=q.next();!cI.done;cI=q.next())cI=cI.value,CM(a,cI.actionProto)||L.push(sB(G,cI.key,{iL:!0}));m&&(m.downloads=[],L.push(Sx(G,m,"mainDownloadsListEntity")));if(M)for(M=g.Z(M),m=M.next();!m.done;m=M.next())m=m.value,q=g.sV(m.key).entityId,q=g.mf(q,"transfer"),h.set(q,m.offlineModeType);return g.bk.all(L).then(function(){return z})})}),2);
c=C.S;y=g.Z(c);for(T=y.next();!T.done;T=y.next())X=T.value,Gf(X,h.get(X.key)),f=g.sV(X.key).entityId,A={videoId:f,offlineDeleteReason:P,cotn:X.cotn,offlineModeType:h.get(X.key)},nM(A),U=g.mf(f,"mainVideoEntity"),cq(r,{entityKey:U,failureReason:"OFFLINE_OPERATION_FAILURE_REASON_VIDEO_DELETED"});return g.l(C,miB(),0)})},MUM=function(e,a){var r=[];
if(e.thumbnailStyleData){e=g.Z(e.thumbnailStyleData);for(var P=e.next();!P.done;P=e.next()){var B=void 0,h=void 0,c=void 0;r=r.concat(E6((B=P.value)==null?void 0:(h=B.value)==null?void 0:(c=h.collageThumbnail)==null?void 0:c.coverThumbnail))}}a=E6(a);return r.concat(a)},jzB=function(e,a,r){var P,B,h,c,y,T,X,f,A,U,C,G,O,d,W,V,L,z,q,M,m,cI,CL;
return g.Y(function(nL){P=[];B=new Set;if(r.length)for(h=g.Z(r),c=h.next();!c.done;c=h.next())if(y=c.value,T=void 0,(T=y.downloads)==null?0:T.length)for(X=g.Z(y.downloads),f=X.next();!f.done;f=X.next())A=f.value,A.videoItem&&(U=g.sV(A.videoItem).entityId,B.add(U));if(e.videos){C=g.Z(e.videos);for(G=C.next();!G.done;G=C.next())O=G.value,d=JSON.parse(g.sV(O).entityId),d.videoId&&!B.has(d.videoId)&&P.push(d.videoId);W=g.Z(a);for(V=W.next();!V.done;V=W.next())if(L=V.value,L.key!==e.key&&(z=L.videos))for(q=
g.Z(z),M=q.next();!M.done;M=q.next())m=M.value,cI=JSON.parse(g.sV(m).entityId),cI.videoId&&(CL=P.indexOf(cI.videoId),CL!==-1&&P.splice(CL,1))}return nL.return(P)})},F08=function(e,a){var r,P,B,h,c,y,T,X;
return g.Y(function(f){r=E6(e.avatar);P=g.Z(a);for(B=P.next();!B.done;B=P.next())if(h=B.value,h.id!==e.id)for(c=g.Z(E6(h.avatar)),y=c.next();!y.done;y=c.next())T=y.value,X=r.indexOf(T),X!==-1&&r.splice(X,1);return f.return(r)})},anM=function(e){var a;
return g.Y(function(r){a=g.H(e.frameworkUpdates,dB);return e.frameworkUpdates&&a?g.l(r,oON(a),0):r.return()})},P9a=function(e){var a;
if((a=e.onResponseReceivedActions)!=null&&a.length){var r;e=(r=g.H(g.H(e.onResponseReceivedActions[0],rnG),g.oHB))==null?void 0:r.actions;if(e!=null&&e.length)return e}},Bib=function(e){var a,r,P;
return g.Y(function(B){if(B.T==1)return e?g.l(B,um(e,g.xi,"mainDownloadsListEntity"),2):B.return([]);a=B.S;return((r=a)==null?0:(P=r.downloads)==null?0:P.length)?B.return(a.downloads.map(function(h){var c;return(c=h.videoItem)!=null?c:""})):B.return([])})},cn9=function(e,a){var r;
return g.Y(function(P){return P.T==1?g.l(P,htw(e,a),2):(r=P.S)?g.l(P,MF(e,{mode:"readwrite",DD:!0},function(B){var h=[Sx(B,r.mainDownloadsLibraryEntity,"mainDownloadsLibraryEntity")];r.mainDownloadsListEntity&&h.push(Sx(B,r.mainDownloadsListEntity,"mainDownloadsListEntity"));return g.bk.all(h)}),0):P.Oo(0)})},htw=function(e,a){var r,P,B,h,c,y,T,X,f,A,U,C,G,O,d,W,V,L;
return g.Y(function(z){if(z.T==1)return r=g.mf("main_downloads_library_id","mainDownloadsLibraryEntity"),P=g.mf("DOWNLOADS_LIST_ENTITY_ID_MANUAL_DOWNLOADS","mainDownloadsListEntity"),g.l(z,MF(e,{mode:"readonly",DD:!0},function(q){return g.bk.all([qF(q,r,"mainDownloadsLibraryEntity"),qF(q,P,"mainDownloadsListEntity")])}),2);
B=z.S;h=g.Z(B);c=h.next().value;y=h.next().value;T=c;X=y;T||(T={id:r});f=g.Z(a);for(A=f.next();!A.done;A=f.next())if(U=A.value,U===g.xi){if(T.smartDownloadsList)return z.return();T.smartDownloadsList=U}else if(C=g.sV(U).entityType,G={},C==="mainPlaylistEntity"?G.playlistItem=U:C==="mainVideoEntity"&&(G.videoItem=U),!g.Ak(G)){O=void 0;if((O=X)==null?0:O.downloads){d=!1;W=g.Z(X.downloads);for(V=W.next();!V.done;V=W.next())if(L=V.value,L.playlistItem===U||L.videoItem===U){d=!0;break}d||X.downloads.push(G)}else X=
{id:P,downloads:[G]};T.downloadsList=P}return z.return({mainDownloadsLibraryEntity:T,mainDownloadsListEntity:X})})},o4l=function(e,a){var r,P,B,h,c,y,T,X,f,A,U,C,G,O,d;
return g.Y(function(W){if(W.T==1)return r=g.mf("main_downloads_library_id","mainDownloadsLibraryEntity"),P=g.mf("DOWNLOADS_LIST_ENTITY_ID_MANUAL_DOWNLOADS","mainDownloadsListEntity"),g.l(W,MF(e,{mode:"readonly",DD:!0},function(V){return g.bk.all([qF(V,r,"mainDownloadsLibraryEntity"),qF(V,P,"mainDownloadsListEntity"),qF(V,g.xi,"mainDownloadsListEntity")])}),2);
B=W.S;h=g.Z(B);c=h.next().value;y=h.next().value;T=h.next().value;X=c;f=y;A=T;if(!X)return W.Oo(0);if(a===g.xi&&((U=A)==null?0:U.downloads))A.downloads=[];else if((C=f)==null?0:C.downloads)for(G=g.sV(a).entityType,O=0;O<f.downloads.length;O++)if(d=f.downloads[O],G==="mainVideoEntity"&&d.videoItem===a){f.downloads.splice(O,1);break}else if(G==="mainPlaylistEntity"&&d.playlistItem===a){f.downloads.splice(O,1);break}return g.l(W,MF(e,{mode:"readwrite",DD:!0},function(V){var L=[Sx(V,X,"mainDownloadsLibraryEntity")];
f&&L.push(Sx(V,f,"mainDownloadsListEntity"));A&&L.push(Sx(V,A,"mainDownloadsListEntity"));return g.bk.all(L)}),0)})},J8=function(e,a){var r,P,B,h,c,y,T,X,f,A,U;
return g.Y(function(C){if(C.T==1)return r=g.mf(a,"transfer"),P=g.mf(a,"videoDownloadContextEntity"),g.l(C,MF(e,{mode:"readonly",DD:!0},function(G){return g.bk.all([qF(G,r,"transfer"),qF(G,P,"videoDownloadContextEntity")])}),2);
B=C.S;h=g.Z(B);c=h.next().value;y=h.next().value;T=c;X=y;U={videoId:a,cotn:(f=T)==null?void 0:f.cotn,offlineModeType:(A=X)==null?void 0:A.offlineModeType};return C.return(U)})},Dr=function(e,a,r,P,B){var h,c,y,T,X,f,A,U,C,G,O,d,W,V,L,z,q,M,m,cI;
return g.Y(function(CL){switch(CL.T){case 1:return h=g.mf(e,"musicTrack"),c=g.mf(e,"transfer"),g.l(CL,MF(a,{mode:"readonly",DD:!0},function(nL){return g.bk.all([qF(nL,h,"musicTrack"),qF(nL,c,"transfer"),vX(nL,"musicTrack"),vX(nL,"offlineOrchestrationActionWrapperEntity")])}),2);
case 2:y=CL.S;T=g.Z(y);X=T.next().value;f=T.next().value;A=T.next().value;U=T.next().value;C=X;G=f;O=A;d=U;if(!C){CL.Oo(3);break}return g.l(CL,n45(C,O),4);case 4:return W=CL.S,g.l(CL,Zr(W),3);case 3:V=[];L=g.Z(d);for(z=L.next();!z.done;z=L.next())q=z.value,M=g.sV(q.key).entityId,m=t8(q),cI=g.sV(m.action.entityKey).entityId,M!==e&&cI!==e||CM(r,q.actionProto)||V.push(q.key);return g.l(CL,MF(a,{mode:"readwrite",DD:!0},function(nL){var y3=V.map(function(aT){return sB(nL,aT)});
y3.push(sB(nL,h,{iL:!0}));return g.bk.all(y3)}),6);
case 6:Gf(G),B&&nM(B),cq(P,{entityKey:h,failureReason:"OFFLINE_OPERATION_FAILURE_REASON_VIDEO_DELETED"}),g.OO(CL)}})},VS=function(e,a,r,P,B){var h,c,y,T,X,f,A,U,C,G,O,d,W,V,L,z,q,M,m,cI,CL,nL,y3,aT,$N,F4,ea,EG,n5,lq,cd,iN,vB,oQ,Q,IQ;
return g.Y(function(L5){switch(L5.T){case 1:return h=g.mf(e,a),c=g.mf("music_downloads_library_id","musicDownloadsLibraryEntity"),g.l(L5,MF(r,{mode:"readonly",DD:!0},function(PI){return g.bk.all([qF(PI,h,a),qF(PI,c,"musicDownloadsLibraryEntity"),vX(PI,a),vX(PI,"offlineOrchestrationActionWrapperEntity")])}),2);
case 2:y=L5.S;T=g.Z(y);X=T.next().value;f=T.next().value;A=T.next().value;U=T.next().value;C=X;G=f;O=A;d=U;if(!C){L5.Oo(3);break}return g.l(L5,n45(C,O),4);case 4:return W=L5.S,g.l(L5,Zr(W),3);case 3:V=[];L=new Map;if(!C){L5.Oo(6);break}return g.l(L5,ynb(C,O,G),7);case 7:V=L5.S;z=g.Z(V);for(q=z.next();!q.done;q=z.next())M=q.value,m=g.sV(M).entityId,L.set(m,{videoId:m,playlistId:e,offlineDeleteReason:"OFFLINE_DELETE_REASON_PARENT_LIST_DELETE"});return g.l(L5,Kb(r,"transfer"),8);case 8:for(cI=L5.S,CL=
g.Z(cI),nL=CL.next();!nL.done;nL=CL.next())y3=nL.value,aT=g.sV(y3.key).entityId,($N=L.get(aT))&&y3&&($N.cotn=y3.cotn);case 6:F4=[];ea=g.Z(d);for(EG=ea.next();!EG.done;EG=ea.next())n5=EG.value,lq=g.sV(n5.key).entityId,cd=t8(n5),lq!==e&&cd.rootActionId!==e||CM(P,n5.actionProto)||F4.push(n5.key);iN=g.mf(e,a);return g.l(L5,MF(r,{mode:"readwrite",DD:!0},function(PI){var Jw=F4.map(function(k){return sB(PI,k)});
Jw.push(sB(PI,iN,{iL:!0}));return g.bk.all(Jw)}),9);
case 9:if(!C){L5.Oo(0);break}V.reverse();if(!V.length){L5.Oo(0);break}vB=g.Z(V);oQ=vB.next();case 12:if(oQ.done){L5.Oo(0);break}Q=oQ.value;IQ=g.sV(Q).entityId;if(!IQ){L5.Oo(13);break}return g.l(L5,Dr(IQ,r,P,B,L.get(IQ)),13);case 13:oQ=vB.next(),L5.Oo(12)}})},$o=function(e,a,r){var P,B,h,c,y,T,X;
return g.Y(function(f){if(f.T==1)return g.l(f,MF(e,{mode:"readwrite",DD:!0},function(A){var U=vX(A,"transfer"),C=vX(A,"offlineOrchestrationActionWrapperEntity");return g.bk.all([U,C]).then(function(G){G=g.Z(G);var O=G.next().value;var d=G.next().value;G=Ti9.map(function(z){return m_w(A,z)});
d=g.Z(d);for(var W=d.next();!W.done;W=d.next()){W=W.value;var V=g.sV(W.actionProto.entityKey).entityType==="musicTrack",L=W.actionProto.actionType==="OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD";CM(a,W.actionProto)||V&&(!V||L)||G.push(sB(A,W.key,{iL:!0}))}return g.bk.all(G).then(function(){return O})})}),2);
P=f.S;B=g.Z(P);for(h=B.next();!h.done;h=B.next())c=h.value,Gf(c),y=g.sV(c.key).entityId,T={videoId:y,offlineDeleteReason:void 0,cotn:c.cotn},nM(T),X=g.mf(y,"musicTrack"),cq(r,{entityKey:X,failureReason:"OFFLINE_OPERATION_FAILURE_REASON_VIDEO_DELETED"});return g.l(f,miB(),0)})},XPw=function(e){for(var a,r=g.Z(e.additionalMetadatas),P=r.next();!P.done;P=r.next())P=P.value,P.offlineMusicVideoData&&(a=P.offlineMusicVideoData);
var B,h,c,y,T;return{id:g.mf(e.videoId,"musicTrack"),videoId:e.videoId,title:e.title,thumbnailDetails:e.thumbnail,lengthMs:String(Number(e.lengthSeconds)*1E3),albumTitle:(B=a)==null?void 0:B.releaseTitle,musicVideoType:(h=a)==null?void 0:h.musicVideoType,contentRating:{explicitType:(c=a)==null?void 0:c.explicitType},artistNames:((y=a)==null?void 0:y.byline)||((T=a)==null?void 0:T.channelName),downloadMetadata:g.mf(e.videoId,"musicTrackDownloadMetadataEntity")}},ynb=function(e,a,r){var P,B,h,c,y,T,
X,f,A,U,C,G,O,d,W,V,L,z;
return g.Y(function(q){P=[];B=new Set;if((h=r)==null?0:(c=h.downloadedTracks)==null?0:c.length)for(y=g.Z(r.downloadedTracks),T=y.next();!T.done;T=y.next())X=T.value,B.add(X);if(e.tracks){f=g.Z(e.tracks);for(A=f.next();!A.done;A=f.next())U=A.value,B.has(U)||P.push(U);C=g.Z(a);for(G=C.next();!G.done;G=C.next())if(O=G.value,O.id!==e.id&&(d=O.tracks))for(W=g.Z(d),V=W.next();!V.done;V=W.next())L=V.value,z=P.indexOf(L),z!==-1&&P.splice(z,1)}return q.return(P)})},n45=function(e,a){var r,P,B,h,c,y,T,X;
return g.Y(function(f){r=E6(e.thumbnailDetails);P=g.Z(a);for(B=P.next();!B.done;B=P.next())if(h=B.value,h.id!==e.id)for(c=g.Z(E6(h.thumbnailDetails)),y=c.next();!y.done;y=c.next())T=y.value,X=r.indexOf(T),X!==-1&&r.splice(X,1);return f.return(r)})},fnG=function(e,a){var r,P,B,h,c,y,T,X,f;
return g.Y(function(A){if(A.T==1)return r=g.mf("music_downloads_library_id","musicDownloadsLibraryEntity"),g.l(A,um(e,r,"musicDownloadsLibraryEntity"),2);(P=A.S)||(P={id:r});B=g.sV(a).entityType;B==="musicTrack"?(h=P.downloadedTracks)!=null&&h.includes(a)||(P.downloadedTracks=((c=P.downloadedTracks)!=null?c:[]).concat(a)):B==="musicPlaylist"?(y=P.downloadedPlaylists)!=null&&y.includes(a)||(P.downloadedPlaylists=((T=P.downloadedPlaylists)!=null?T:[]).concat(a)):B!=="musicAlbumRelease"||(X=P.downloadedAlbumReleases)!=
null&&X.includes(a)||(P.downloadedAlbumReleases=((f=P.downloadedAlbumReleases)!=null?f:[]).concat(a));return g.l(A,jx(e,P,"musicDownloadsLibraryEntity"),0)})},AnG=function(e,a){var r,P,B,h,c,y,T;
return g.Y(function(X){if(X.T==1)return r=g.mf("music_downloads_library_id","musicDownloadsLibraryEntity"),g.l(X,um(e,r,"musicDownloadsLibraryEntity"),2);P=X.S;if(!P)return X.Oo(0);B=g.sV(a).entityType;B==="musicTrack"?h=P.downloadedTracks:B==="musicPlaylist"&&(h=P.downloadedPlaylists);if((c=h)==null?0:c.length)for(y=0;y<h.length;y++)if(T=h[y],T===a){h.splice(y,1);break}return g.l(X,jx(e,P,"musicDownloadsLibraryEntity"),0)})},UeG=function(e){var a=e.videos;
e=[];var r=[];if(a){a=g.Z(a);for(var P=a.next();!P.done;P=a.next()){var B=P.value.offlineVideoData.videoId;P=g.mf(B,"musicTrack");B=g.mf(B,"musicTrackDownloadMetadataEntity");e.push(P);r.push(B)}}return{f$:e,zq:r}},QS=function(e,a,r){a={track:XPw(a)};
r&&(a.playlistId=r);if(e=g.H(e.actionMetadata,C9N))a.maximumDownloadQuality=e.maximumDownloadQuality;return{musicTrackEntityActionMetadata:a}},E4V=function(e){var a,r,P,B,h,c,y,T;
return g.Y(function(X){switch(X.T){case 1:return a=g.v3(),r=CTG(e),P=g.Md(GkM),g.kN(X,2),h={Ic:!0},g.l(X,g.L8(a,r,P,void 0,h),4);case 4:B=X.S;g.Dl(X,3);break;case 2:c=g.Q3(X);if(c instanceof g.Id)throw y="GetOffline network manager error: "+c.message,Bq(y,c),Error(y);Bq("GetOffline fetch request error",c);throw Error("GetOffline fetch request error");case 3:T=Wq(B);if(!B)throw Bq("Network request failed"),Error("Network request failed");if(T!==void 0)lM(T);else if(!B.videos||!B.videos.length)throw Bq("No data"),
Error("No data");return X.return(B.videos.map(function(f){return f.offlineVideoData}))}})},bX5=function(e){var a,r,P,B,h,c,y,T;
return g.Y(function(X){switch(X.T){case 1:return a=g.v3(),r=GYB(e),P=g.Md(GkM),g.kN(X,2),h={Ic:!0},g.l(X,g.L8(a,r,P,void 0,h),4);case 4:B=X.S;g.Dl(X,3);break;case 2:c=g.Q3(X);if(c instanceof g.Id)throw y="GetOffline network manager error for playlist: "+c.message,Bq(y,c),Error(y);Bq("GetOffline fetch request error for playlist",c);throw Error("GetOffline fetch request error for playlist");case 3:T=Wq(B);if(!B)throw Bq("Network request failed for playlist"),Error("Network request failed for playlist");
if(T!==void 0)lM(T,"playlist");else if(!B.playlists||!B.playlists.length)throw Bq("No data for playlist"),Error("No data for playlist");return X.return(B.playlists.map(function(f){return f.offlinePlaylistData}))}})},g4G=function(e,a,r,P){var B,h,c,y,T,X,f,A,U,C,G,O,d,W,V,L,z,q,M,m,cI,CL,nL,y3,aT,$N,F4,ea,EG,n5;
return g.Y(function(lq){switch(lq.T){case 1:return g.l(lq,e4(),2);case 2:B=lq.S;if(!B)return lq.return([]);h=[];if((c=P)==null?0:c.length){h=P;lq.Oo(3);break}return g.l(lq,Kb(B,"mainPlaylistEntity"),4);case 4:h=lq.S;case 3:if(!h.length)return lq.return([]);y=[];T=Date.now()/1E3;X=g.Z(h);f=X.next();case 5:if(f.done)return y.length?g.l(lq,tpV(y),10):lq.return([]);A=f.value;if(!A.downloadState){U=void 0;lq.Oo(8);break}return g.l(lq,um(B,A.downloadState,"mainPlaylistDownloadStateEntity"),9);case 9:U=
lq.S;case 8:C=U;G=void 0;d=(O=(G=A)==null?void 0:G.entityMetadata)&&O.nextAutoRefreshIntervalSeconds?Number(O.nextAutoRefreshIntervalSeconds):NaN;W=Number.isNaN(d)?e:d;L=V=void 0;z=((V=C)==null?0:V.lastSyncedTimestampMillis)?Number((L=C)==null?void 0:L.lastSyncedTimestampMillis)/1E3:0;M=q=void 0;m=((q=C)==null?0:q.addedTimestampMillis)?Number((M=C)==null?void 0:M.addedTimestampMillis)/1E3:0;if(r||!O||z+W<=T){cI=[];CL=void 0;if((CL=A.videos)==null?0:CL.length)for(nL=g.Z(A.videos),y3=nL.next();!y3.done;y3=
nL.next())aT=y3.value,$N=JSON.parse(g.sV(aT).entityId),$N.videoId&&cI.push($N.videoId);F4="0";O&&(ea=void 0,F4=String(Number((ea=O.offlineLastModifiedTimestampSeconds)!=null?ea:0).toFixed()));EG={playlistId:A.playlistId,videoIds:cI,offlineLastModifiedTimestamp:F4,autoSync:a,offlineDateAddedTimestamp:String(m.toFixed())};y.push(EG)}f=X.next();lq.Oo(5);break;case 10:return n5=lq.S,lq.return(n5)}})},ZXN=function(){var e,a,r,P,B;
return g.Y(function(h){if(h.T==1)return g.l(h,e4(),2);if(h.T!=3)return(e=h.S)?g.l(h,Kb(e,"refresh"),3):h.return(!1);a=h.S;if((r=a[0])==null||!r.refreshTime)return h.return(!1);P=Number(a[0].refreshTime);B=Date.now()/1E3;return h.return(isFinite(P)&&B>=P)})},kkG=function(e,a){var r,P,B;
return g.Y(function(h){switch(h.T){case 1:return g.kN(h,2),g.l(h,OX9(e,a),4);case 4:return P=h.S,g.l(h,anM(P),5);case 5:r=P9a(P);g.Dl(h,3);break;case 2:B=g.Q3(h),Bq("getAndProcessSmartDownloadsResponse request or processing error",B);case 3:return h.return(r)}})},deN=function(e,a,r,P){var B,h,c,y,T,X,f,A,U,C,G,O,d,W,V,L,z,q,M,m,cI,CL,nL,y3,aT,$N,F4,ea,EG,n5;
return g.Y(function(lq){switch(lq.T){case 1:return g.l(lq,e4(),2);case 2:B=lq.S;if(!B)return lq.return([]);h=[];if((c=P)==null?0:c.length){h=P;lq.Oo(3);break}return g.l(lq,Kb(B,"musicPlaylist"),4);case 4:h=lq.S;case 3:if(!h.length)return lq.return([]);y=[];T=Date.now()/1E3;X=g.Z(h);f=X.next();case 5:if(f.done)return y.length?g.l(lq,tpV(y),10):lq.return([]);A=f.value;U=void 0;G=(C=(U=A)==null?void 0:U.entityMetadata)&&C.nextAutoRefreshIntervalSeconds?Number(C.nextAutoRefreshIntervalSeconds):NaN;O=
Number.isNaN(G)?e:G;W=d=0;V="DOWNLOAD_SYNC_STATE_UNKNOWN";if(!A.downloadMetadata){lq.Oo(8);break}return g.l(lq,um(B,A.downloadMetadata,"musicPlaylistDownloadMetadataEntity"),9);case 9:L=lq.S,q=z=void 0,d=Number((q=(z=L)==null?void 0:z.addedTimestampMillis)!=null?q:"0")/1E3,m=M=void 0,W=Number((m=(M=L)==null?void 0:M.lastModifiedTimestampMillis)!=null?m:"0")/1E3,CL=cI=void 0,V=(CL=(cI=L)==null?void 0:cI.syncState)!=null?CL:"DOWNLOAD_SYNC_STATE_UNKNOWN";case 8:nL=void 0;if(r||V!=="DOWNLOAD_SYNC_STATE_UP_TO_DATE"||
!C||Number((nL=C.lastSyncedTimestampSeconds)!=null?nL:0)+O<=T){y3=[];aT=void 0;if((aT=A.tracks)==null?0:aT.length)for($N=g.Z(A.tracks),F4=$N.next();!F4.done;F4=$N.next())ea=F4.value,y3.push(g.sV(ea).entityId);EG={playlistId:A.playlistId,videoIds:y3,offlineLastModifiedTimestamp:String(W.toFixed()),autoSync:a,offlineDateAddedTimestamp:String(d.toFixed())};y.push(EG)}f=X.next();lq.Oo(5);break;case 10:return n5=lq.S,lq.return(n5)}})},OX9=function(e,a){var r,P,B,h,c,y,T,X,f,A;
return g.Y(function(U){switch(U.T){case 1:return r=g.v3(),g.l(U,e4(),2);case 2:P=U.S;if(!P){U.Oo(3);break}return g.l(U,kYG(P),4);case 4:B=U.S;case 3:var C=B;h={context:g.sK(),browseId:"FEdownloads",browseRequestSupportedMetadata:{downloadsBrowseParams:{offlineFeatureSettingState:{isSdEnabled:e},offlineClientState:C,clientStateRequestData:{preferredFormatType:a}}}};c=g.Md(Jnl);g.kN(U,5);T={Ic:!0};return g.l(U,g.L8(r,h,c,void 0,T),7);case 7:y=U.S;g.Dl(U,6);break;case 5:X=g.Q3(U);if(X instanceof g.Id)throw f=
"DPS network manager error for smart downloads: "+X.message,Bq(f,X),Error(f);Bq("DPS fetch request error for smart downloads",X);throw Error("DPS fetch request error for smart downloads");case 6:A=Wq(y);if(y)A!==void 0&&lM(A,"smart downloads");else throw Bq("Network request failed for smart downloads"),Error("Network request failed for smart downloads");return U.return(y)}})},VpZ=function(e,a){var r,P,B,h,c,y,T,X;
return g.Y(function(f){switch(f.T){case 1:return r=g.v3(),P={context:g.sK(),videoPlaybackPositionEntities:e,lastSyncTimestampUsec:a},B=g.Md(DeV),g.kN(f,2),c={Ic:!0},g.l(f,g.L8(r,P,B,void 0,c),4);case 4:h=f.S;g.Dl(f,3);break;case 2:y=g.Q3(f);if(y instanceof g.Id)throw T="VPPS network manager error: "+y.message,Bq(T,y),Error(T);Bq("VPPS fetch request error",y);throw Error("VPPS fetch request error");case 3:X=Wq(h);if(h)X!==void 0&&lM(X,"position sync");else throw Bq("Network request failed for position sync"),
Error("Network request failed for position sync");return f.return(h)}})},QaN=function(e,a,r){var P,B,h,c,y,T,X,f;
return g.Y(function(A){switch(A.T){case 1:P=g.v3();var U=r.refreshData,C=r.isEnqueuedForExpiredStreamUrlRefetch,G=r.gK,O=r.offlineSourceData,d=r.mediaCapabilities,W={entityKey:e};U&&(W.refreshData=U);C&&(W.isExpiredStreamUrlRefetch=C);G&&(W.downloadParameters=G);O&&(W.offlineSourceData=O);U={context:g.gC(a),signatureTimestamp:20299,videos:[W]};d&&(U.mediaCapabilities=d);B=U;h=g.Md($ea);g.kN(A,2);y={Ic:!0};return g.l(A,g.L8(P,B,h,void 0,y),4);case 4:c=A.S;g.Dl(A,3);break;case 2:T=g.Q3(A);if(T instanceof
g.Id)throw X="GetPDE network manager error: "+T.message,Bq(X,T),Error(X);Bq("GetPDE fetch request error",T);throw Error("GetPDE fetch request error");case 3:f=Wq(c);if(c)f!==void 0&&lM(f,"PDE");else throw Bq("Network request failed for PDE"),Error("Network request failed for PDE");return A.return(c)}})},Wq=function(e){var a;
return(a=e.errorMetadata)==null?void 0:a.status},lM=function(e,a){a=a?" for "+a:"";
if(e===0)throw e="Empty response body"+a,Bq(e),Error(e);e="Response with error"+a;Bq(e);throw Error(e);},tpV=function(e){var a,r,P,B,h,c,y,T;
return g.Y(function(X){switch(X.T){case 1:return a=g.v3(),r=EON(e),P=g.Md(Wsl),g.kN(X,2),h={Ic:!0},g.l(X,g.L8(a,r,P,void 0,h),4);case 4:B=X.S;g.Dl(X,3);break;case 2:c=g.Q3(X);if(c instanceof g.Id)throw y="offlinePlaylistSyncCheck network manager error: "+c.message,Bq(y,c),Error(y);Bq("offlinePlaylistSyncCheck fetch request error",c);throw Error("offlinePlaylistSyncCheck fetch request error");case 3:T=Wq(B);if(!B)throw Bq("Network request failed for playlist sync"),Error("Network request failed for playlist sync");
if(T!==void 0)lM(T,"playlist sync");else if(!B.offlinePlaylistSyncCheckDatas||!B.offlinePlaylistSyncCheckDatas.length)throw Bq("No data for playlist sync"),Error("No data for playlist sync");return X.return(B.offlinePlaylistSyncCheckDatas.map(function(f){return f.offlinePlaylistSyncCheckData}))}})},LM=function(e){this.S=e},ln5=function(e,a){var r,P,B,h,c,y;
return g.Y(function(T){switch(T.T){case 1:r=new Map,P=g.Z(a),B=P.next();case 2:if(B.done){T.Oo(4);break}h=B.value;c=r;y=c.set;return g.l(T,e.T(h),5);case 5:y.call(c,h,T.S);B=P.next();T.Oo(2);break;case 4:return T.return(r)}})},Yo=function(e,a,r,P,B,h){a=g.mf(a,r);
P=Object.assign({},h,{priority:P,retryScheduleIntervalsInSeconds:B});return{actionType:e,entityKey:a,actionMetadata:P}},wB=function(e,a,r,P,B,h){this.status=e;
this.S=a;this.L=r;this.T=P;this.B=B;this.downloadState=h},LsN=function(e,a,r){this.S=e;
this.iW=a;this.B=r},pPG=function(e,a){var r,P,B,h,c,y,T,X,f;
return g.Y(function(A){switch(A.T){case 1:return r=a.entityKey,B=(P=g.H(a.actionMetadata,pM))==null?void 0:P.isEnqueuedForExpiredStreamUrlRefetch,g.kN(A,2),h=void 0,g.l(A,YCG(e,a),4);case 4:h=A.S;g.kN(A,5);var U=(U=g.H(a.actionMetadata,pM))?{maximumDownloadQuality:U.maximumDownloadQuality}:void 0;return g.l(A,QaN(r,e.iW,{isEnqueuedForExpiredStreamUrlRefetch:B,gK:U,offlineSourceData:h}),7);case 7:c=A.S;g.Dl(A,6,2);break;case 5:return g.Q3(A,2),y=Tf(a)?"OFFLINE_ORCHESTRATION_FAILURE_REASON_RECOVERABLE_NETWORK_ERROR":
"OFFLINE_ORCHESTRATION_FAILURE_REASON_UNRECOVERABLE_NETWORK_ERROR",Bq("PDE handleAdd error"),A.return(iM(a,!1,void 0,"OFFLINE_OPERATION_FAILURE_REASON_NETWORK_REQUEST_FAILED",y,"DOWNLOAD_STATE_FAILED"));case 6:return g.l(A,wPB(e,c,a),8);case 8:return A.return(iM(a,!0,c.orchestrationActions));case 2:return T=g.Q3(A),X="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",f="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",T instanceof g.XX&&T.type==="QUOTA_EXCEEDED"&&(X="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",
f="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),Bq("PDE handleAdd error"),A.return(iM(a,!1,void 0,X,f,"DOWNLOAD_STATE_FAILED"))}})},Nil=function(e,a){var r,P,B,h,c,y,T,X,f,A,U,C,G,O,d,W,V,L,z,q,M,m,cI,CL;
return g.Y(function(nL){switch(nL.T){case 1:return r=a.entityKey,P=g.sV(r).entityId,g.l(nL,MF(e.S,{mode:"readonly",DD:!0},function(y3){var aT=qF(y3,r,"playbackData"),$N=qF(y3,g.mf(P,"offlineVideoPolicy"),"offlineVideoPolicy");y3=qF(y3,g.mf(P,"transfer"),"transfer");return g.bk.all([aT,$N,y3])}),2);
case 2:B=nL.S;h=g.Z(B);c=h.next().value;y=h.next().value;T=h.next().value;X=c;f=y;A=T;if(!X||!f)return nL.return(iM(a,!0));U=[];O=((G=X)==null?0:G.playerResponseJson)?JSON.parse(X.playerResponseJson):null;if(!(A&&O&&e.iW.X("html5_refresh_deprecated_downloads"))){nL.Oo(3);break}C=iXl(e,O,A);return g.l(nL,ztN(e,A),4);case 4:U=nL.S;case 3:d={lastPlayerResponseTimestampSeconds:X.playerResponseTimestamp,offlineToken:f.offlineToken,formatIds:U};W={};if((V=A)==null?0:V.maximumDownloadQuality)W.maximumDownloadQuality=
A.maximumDownloadQuality;g.kN(nL,5);L=void 0;return g.l(nL,YCG(e,a),7);case 7:return L=nL.S,g.kN(nL,8),g.l(nL,QaN(r,e.iW,{refreshData:d,gK:W,offlineSourceData:L,mediaCapabilities:C}),10);case 10:z=nL.S;g.Dl(nL,9,5);break;case 8:return g.Q3(nL,5),q=Tf(a)?"OFFLINE_ORCHESTRATION_FAILURE_REASON_RECOVERABLE_NETWORK_ERROR":"OFFLINE_ORCHESTRATION_FAILURE_REASON_UNRECOVERABLE_NETWORK_ERROR",Bq("PDE handleRefresh error"),nL.return(iM(a,!1,void 0,"OFFLINE_OPERATION_FAILURE_REASON_NETWORK_REQUEST_FAILED",q,
"DOWNLOAD_STATE_FAILED"));case 9:return g.l(nL,wPB(e,z,a),11);case 11:return nL.return(iM(a,!0,z.orchestrationActions));case 5:return M=g.Q3(nL),m="PDE handleRefresh error",M instanceof Error&&(m="PDE handleRefresh error: "+M.message),cI="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",CL="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",M instanceof g.XX&&M.type==="QUOTA_EXCEEDED"&&(cI="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",CL="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),
Bq(m),nL.return(iM(a,!1,void 0,cI,CL,"DOWNLOAD_STATE_FAILED"))}})},YCG=function(e,a){var r,P,B,h;
return g.Y(function(c){if(c.T==1)return r=g.sV(a.entityKey).entityId,P=g.mf(r,"videoDownloadContextEntity"),g.l(c,um(e.S,P,"videoDownloadContextEntity"),2);B=c.S;return(h=B)!=null&&h.offlineModeType?c.return({offlineModeType:B.offlineModeType}):c.return(void 0)})},wPB=function(e,a,r){var P,B,h,c,y;
return g.Y(function(T){if(T.T==1){if(!a.frameworkUpdates||!g.H(a.frameworkUpdates,dB))return T.return();if(!(g.H(a.frameworkUpdates,dB).mutations&&g.H(a.frameworkUpdates,dB).mutations.length>0&&g.H(a.frameworkUpdates,dB).mutations[0].type==="ENTITY_MUTATION_TYPE_DELETE"))return T.Oo(2);P=g.sV(g.H(a.frameworkUpdates,dB).mutations[0].entityKey).entityId;return g.l(T,J8(e.S,P),3)}if(T.T!=2){B=T.S;h=g.H(r.actionMetadata,pM);if(y=(c=h)==null?void 0:c.playlistId)B.playlistId=y;B.offlineDeleteReason="OFFLINE_DELETE_REASON_UNKNOWN";
return g.tZ(e.iW)?g.l(T,ko(P,e.S,r,e.B,B),2):g.L$(e.iW)?g.l(T,Dr(P,e.S,r,e.B),2):T.Oo(2)}return g.l(T,oON(g.H(a.frameworkUpdates,dB)),0)})},iM=function(e,a,r,P,B,h){return new wB(a?"OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS":"OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",Tf(e),r,P,B,h)},iXl=function(e,a,r){a=Sm8(e.iW,r.cotn,a);
r=g.WE(a);return g.GZq(a,r,e.iW)},ztN=function(e,a){var r,P,B,h,c,y,T,X,f,A,U;
return g.Y(function(C){if(C.T==1)return r=[],g.l(C,MF(e.S,{mode:"readonly",DD:!0},function(G){var O=[],d=a.offlineVideoStreams;if(d){d=g.Z(d);for(var W=d.next();!W.done;W=d.next())O.push(qF(G,W.value,"offlineVideoStreams"))}return g.bk.all(O)}),2);
if(P=C.S)for(B=g.Z(P),h=B.next();!h.done;h=B.next())if(c=h.value,y=void 0,(y=c)==null?0:y.streamsProgress)for(T=c.streamsProgress,X=0;X<T.length;X++)f=T[X],A=JSON.parse(f.formatStreamBytes),U={itag:A.itag,lmt:A.lastModified,xtags:A.xtags},r.push(U);return C.return(r)})},xeb=function(e,a){this.S=e;
this.iW=a},InZ=function(e,a){var r,P,B,h,c,y,T,X,f,A,U,C;
return g.Y(function(G){switch(G.T){case 1:return r=Tf(a),g.l(G,Kb(e.S,"videoPlaybackPositionEntity"),2);case 2:P=G.S;if(P.length===0)return G.return(new wB("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",r));g.kN(G,3);return g.l(G,xv.getInstance(),5);case 5:B=G.S;if(!B)throw Error("prefStorage is undefined");return g.l(G,B.get("psi"),6);case 6:return h=G.S,T=(y=(c=h)==null?void 0:c.Kc)!=null?y:"0",g.l(G,VpZ(P,T),7);case 7:return X=G.S,f={isPaused:X.watchHistoryPaused,Kc:X.syncTimestampUsec},g.l(G,B.set("psi",
f),8);case 8:if(f.isPaused){G.Oo(9);break}A=g.H(X.frameworkUpdates,dB);if(!X.frameworkUpdates||!A){G.Oo(9);break}return g.l(G,oON(A),9);case 9:g.Dl(G,4);break;case 3:return U=g.Q3(G),C="PPE handleRefresh error: "+(U instanceof Error?U.message:"unknown error"),Bq(C),G.return(new wB("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",r,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 4:return G.return(new wB("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
r))}})},qCb=function(e,a){var r,P,B,h,c,y,T,X;
return g.Y(function(f){switch(f.T){case 1:return r=Tf(a),P=g.sV(a.entityKey).entityId,g.kN(f,2),g.l(f,xv.getInstance(),4);case 4:B=f.S;if(!B)throw Error("prefStorage is undefined");return g.l(f,B.get("psi"),5);case 5:h=f.S;c=g.H(a.actionMetadata,HX9);if(((y=h)==null?void 0:y.isPaused)!==!1||(T=c)==null||!T.lastPlaybackPositionSeconds){f.Oo(6);break}X={key:g.mf(P,"videoPlaybackPositionEntity"),videoId:P,lastPlaybackPositionSeconds:c.lastPlaybackPositionSeconds};return g.l(f,jx(e.S,X,"videoPlaybackPositionEntity"),
6);case 6:g.Dl(f,3);break;case 2:return g.Q3(f),f.return(new wB("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",r,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 3:return f.return(new wB("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",r))}})},v4N=function(e,a){var r,P,B;
return g.Y(function(h){switch(h.T){case 1:r=Tf(a);g.kN(h,2);P=g.sV(a.entityKey).entityId;if(P==="!*$_ALL_ENTITIES_!*$")return g.l(h,r49(e.S),5);B=g.mf(P,"videoPlaybackPositionEntity");return g.l(h,a_G(e.S,B),5);case 5:g.Dl(h,3);break;case 2:return g.Q3(h),h.return(new wB("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",r,void 0,"OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 3:return h.return(new wB("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
r))}})},RtN=function(e,a){this.api=e;
this.S=a;this.logger=new g.bl("woffle");this.T=!1;this.Ob={Ya:this.Ya};this.logger.debug("Initialized OfflineMediaManager")},SCa=function(e){return g.Y(function(a){return a.return(UiG(e))})},saw=function(e){var a;
return g.Y(function(r){if(r.T==1)return g.l(r,g.sEI(e),2);a=r.S;return r.return(a.filter(function(P){return!!P.url}).map(function(P){return P.url}))})},zf=function(e,a){var r=g.et(a);
if(r===1||r===0)return Promise.resolve();(r=mea(e,a))&&r.stopVideo();e.B=0;return SCa(a)},NZ=function(e,a,r,P){r=r===void 0?!1:r;
P=P===void 0?!0:P;var B=typeof a==="string"?a:a.videoDetails.videoId;g.et(B)===2&&((a=mea(e,B))?a.stopVideo():e.logger.info(function(){return"Corresponding player for "+B+" not found. Pausing anyway"}),g.aG(B,2),e.B=2,r?FsN(e.S):P&&MpZ(e.S))},mea=function(e,a){var r;
return((r=e.player)==null?void 0:r.getVideoData().videoId)===a?e.player:null},jaB=function(e,a,r){a.getPlayerResponse();
g.aG(a.videoId,2);e.B=2;e.T=!1;var P;(P=e.player)==null||P.dispose();e.player=e.api.A8(a);a={};e.player.N2((a.localmediachange=e.JT,a.signatureexpired=e.g$,a.statechange=e.Hrm,a),e);e.X("html5_generate_content_po_token")&&e.player.Z2();var B=e.Ya(r);e.player.vg(g.dp(B,B,!0,"m"),!1);e.logger.debug(function(){return"Starting headless playback with quality: "+B});
e.player.U3(!1)},uuV=function(e,a){this.S=e;
this.iW=a},e7V=function(e,a){var r,P;
return g.Y(function(B){switch(B.T){case 1:return r=Tf(a),g.l(B,um(e.S,a.entityKey,"transfer"),2);case 2:if(P=B.S)return B.return(new wB("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",r));g.kN(B,3);return g.l(B,KsV(e,a),5);case 5:g.Dl(B,4);break;case 3:return g.Q3(B),B.return(new wB("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",r,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 4:return B.return(new wB("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
r))}})},awl=function(e,a){var r,P;
return g.Y(function(B){switch(B.T){case 1:return r=Tf(a),g.l(B,um(e.S,a.entityKey,"transfer"),2);case 2:P=B.S;if(!P||P.transferState!=="TRANSFER_STATE_COMPLETE")return B.return(new wB("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",r));g.kN(B,3);return g.l(B,KsV(e,a,!0),5);case 5:g.Dl(B,4);break;case 3:return g.Q3(B),B.return(new wB("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",r,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));
case 4:return B.return(new wB("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",r))}})},riV=function(e,a){var r,P,B,h,c,y,T,X,f,A;
return g.Y(function(U){switch(U.T){case 1:return r=Tf(a),P=g.sV(a.entityKey).entityId,g.l(U,MF(e.S,{mode:"readonly",DD:!0},function(C){var G=qF(C,a.entityKey,"transfer");C=qF(C,g.mf(P,"videoDownloadContextEntity"),"videoDownloadContextEntity");return g.bk.all([G,C])}),2);
case 2:B=U.S;h=g.Z(B);c=h.next().value;y=h.next().value;T=c;X=y;if(!T||T.transferState!=="TRANSFER_STATE_WAITING_FOR_PLAYER_RESPONSE_REFRESH")return U.return(new wB("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",r));g.kN(U,3);T.transferState="TRANSFER_STATE_TRANSFER_IN_QUEUE";return g.l(U,jx(e.S,T,"transfer"),5);case 5:f=g.sV(T.key).entityId;xi8({videoId:f,rb:T,offlineModeType:(A=X)==null?void 0:A.offlineModeType});g.Dl(U,4);break;case 3:return g.Q3(U),U.return(new wB("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",
r,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 4:return U.return(new wB("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",r))}})},KsV=function(e,a,r){r=r===void 0?!1:r;
var P,B,h,c,y,T,X,f,A,U,C,G,O,d,W;return g.Y(function(V){switch(V.T){case 1:return P=g.H(a.actionMetadata,PYa),B=g.sV(a.entityKey).entityId,h=g.mf(B,"downloadStatusEntity"),g.l(V,MF(e.S,{mode:"readonly",DD:!0},function(L){var z=qF(L,h,"downloadStatusEntity");L=qF(L,g.mf(B,"videoDownloadContextEntity"),"videoDownloadContextEntity");return g.bk.all([z,L])}),2);
case 2:return c=V.S,y=g.Z(c),T=y.next().value,X=y.next().value,f=T,A=X,U="TRANSFER_STATE_TRANSFER_IN_QUEUE",((C=f)==null?void 0:C.downloadState)==="DOWNLOAD_STATE_USER_DELETED"&&(U="TRANSFER_STATE_PAUSED_BY_USER"),d={key:a.entityKey,transferState:U,cotn:g.Ch(16),enqueuedTimestampMs:Date.now().toString(),maximumDownloadQuality:(G=P)==null?void 0:G.maximumDownloadQuality,preferredAudioTrack:(O=P)==null?void 0:O.preferredAudioTrack,transferRetryCount:0,isRefresh:r,hasLoggedFirstStarted:!1},g.l(V,MF(e.S,
{mode:"readwrite",DD:!0},function(L){var z=[];r&&z.push(sB(L,g.mf(B,"offlineVideoStreams")));z.push(Sx(L,d,"transfer"));return g.bk.all(z)}),3);
case 3:if(!r){V.Oo(4);break}return g.l(V,SCa(B),4);case 4:z35({videoId:B,rb:d,offlineModeType:(W=A)==null?void 0:W.offlineModeType}),g.OO(V)}})},h79=function(e,a,r,P){if(!e.action.entityKey)throw Error("entityKey is missing.");
var B=g.sV(e.action.entityKey);B={entityType:B.eD,entityId:B.entityId,offlineOrchestrationActionType:e.action.actionType,orchestrationAction:{orchestrationActionId:e.actionId}};a&&(B.offlineOrchestrationActionResult=a.status,B.isRetryable=r?!1:a.S,a.B&&(B.offlineOrchestrationFailureReason=BrN(a.B,B.isRetryable)));var h,c;if((h=e.action.actionMetadata)==null?0:(c=h.offlineLoggingData)==null?0:c.offlineModeType)B.offlineModeType=e.action.actionMetadata.offlineLoggingData.offlineModeType;P&&(B.additionalOrchestrationActions=
P.map(function(y){return{orchestrationActionId:y.actionId}}));
return B},BrN=function(e,a){return e!=="OFFLINE_ORCHESTRATION_FAILURE_REASON_RECOVERABLE_NETWORK_ERROR"||a?e==="OFFLINE_ORCHESTRATION_FAILURE_REASON_UNRECOVERABLE_NETWORK_ERROR"&&a?"OFFLINE_ORCHESTRATION_FAILURE_REASON_RECOVERABLE_NETWORK_ERROR":e:"OFFLINE_ORCHESTRATION_FAILURE_REASON_UNRECOVERABLE_NETWORK_ERROR"},cia=function(e,a){var r={offlineOrchestrationContext:h79(e)};
a=Zp5(a,r);OpM(gOZ(),a,e.rootActionId)},oxN=function(e,a,r,P){P=P===void 0?[]:P;
a={offlineOrchestrationContext:h79(e,a,r,P)};a=Zp5(3,a);OpM(gOZ(),a,e.rootActionId)},nxM=function(){this.actions=[]},yi5=function(e,a){a=g.Z(a);
for(var r=a.next();!r.done;r=a.next())r=r.value,cia(r,1),e.actions.push(r);e.actions.sort(e.S)},TrG=function(e,a){if(a)for(var r=0;r<e.actions.length;r++)if(a==="!*$_ALL_ENTITIES_!*$"&&e.actions[r].actionId!==a||a!=="!*$_ALL_ENTITIES_!*$"&&e.actions[r].rootActionId===a&&e.actions[r].actionId!==a)e.actions.splice(r,1),r--},XDM=function(e,a){e=g.Z(e.actions);
for(var r=e.next();!r.done;r=e.next())if(r.value.actionId===a)return!0;return!1},xo=function(e,a,r,P,B){g.N.call(this);
var h=this;this.T=e;this.TQ=a;this.HW=r;this.D=P;this.iW=B;this.S=new nxM;this.Z=new g.xM;this.B=new g.vP(function(){h.retry()});
this.Y=NaN;this.C=!1;this.Ob={lhP:function(){return h.S},
Qx:function(){return h.Z},
QcQ:function(){return h.B},
retry:function(){return h.retry()}};
g.x(this,this.B);this.N=this.T.observe(this.oH.bind(this))},UoM=function(e,a,r,P,B){var h;
return g.Y(function(c){if(c.T==1)return h=new xo(e,a,r,P,B),g.l(c,fwG(h),2);Aib(h);return c.return(h)})},Aib=function(e){var a=e.S.actions[0];
return e.L?((a==null?void 0:a.action.actionType)==="OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE"&&e.L[0].action.actionType!=="OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE"&&(e.C=!0),Promise.resolve()):CYw(e)},CYw=function(e){var a,r,P,B,h,c,y,T,X,f,A,U,C,G,O,d,W;
return g.Y(function(V){switch(V.T){case 1:if(e.L)throw Error("Already processing an action");if(e.wP())return V.return();a=e.S.actions.shift();pnN(e.HW,!a);if(a===void 0)return V.return();a.action.actionType==="OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH"&&a.actionId==="DOWNLOADS_LIST_ENTITY_ID_SMART_DOWNLOADS"&&TrG(e.S,a.actionId);r="";a.action.actionType==="OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE"&&a.rootActionId===a.actionId&&(r=a.actionId);P=[a];e.L=P;if(B=e.TQ[a.entityType]){V.Oo(2);break}e.L=
void 0;return g.l(V,CYw(e),3);case 3:return V.return();case 2:h=g.Z(P);for(c=h.next();!c.done;c=h.next())y=c.value,cia(y,2);g.kN(V,4,5);return g.l(V,ln5(B,P.map(function(L){return L.action})),7);
case 7:T=V.S,X=g.Z(P),f=X.next();case 8:if(f.done){V.Oo(10);break}A=f.value;U=T.get(A.action);return g.l(V,G$G(e,A,U),9);case 9:f=X.next();V.Oo(8);break;case 10:TrG(e.S,r);case 5:g.YN(V);e.L=void 0;g.pL(V,6);break;case 4:return C=g.Q3(V),Bq("Orchestration error",C),g.kN(V,12),g.l(V,Exw(e,P),14);case 14:g.Dl(V,5);break;case 12:G=g.Q3(V);Bq("Orchestration retry error",G);O=g.Z(P);for(d=O.next();!d.done;d=O.next())W=d.value,W.retryScheduleIndex<3&&yi5(e.S,[W]);V.Oo(5);break;case 6:return g.l(V,CYw(e),
0)}})},G$G=function(e,a,r){var P,B,h,c,y,T,X,f,A,U,C,G;
return g.Y(function(O){switch(O.T){case 1:P=a.retryScheduleIndex+2===3;if(r.status==="OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS"){O.Oo(2);break}if(r.status!=="OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE"){O.Oo(0);break}oxN(a,r,P);if(r.S&&a.retryScheduleIndex+1<3)return g.l(O,Exw(e,[a]),0);h=((B=r)==null?0:B.T)?r.T:"OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN";c={entityKey:a.action.entityKey,failureReason:h};y=void 0;g.tZ(e.iW)?y="mainVideoDownloadStateEntity":g.L$(e.iW)&&(y="musicTrackDownloadMetadataEntity");
if(!y||!r.downloadState){O.Oo(7);break}T=g.sV(a.action.entityKey).entityId;return g.l(O,U6(T,y,e.T,r.downloadState),7);case 7:cq(e.D,c);if(r.downloadState==="DOWNLOAD_STATE_FAILED"&&e.iW.X("html5_auto_retry_failed_pde_actions")){O.Oo(0);break}Bq("Orchestration result is not retryable, deleting action");return g.l(O,a_G(e.T,gB(a).key),0);case 2:X=void 0;try{X=(f=r.L)==null?void 0:f.map(function(d){return e.createAction(d,a)})}catch(d){return oxN(a,r,P),A={entityKey:a.action.entityKey,
failureReason:"OFFLINE_OPERATION_FAILURE_REASON_UNSUPPORTED_ENTITY_FAILED"},cq(e.D,A),Bq("Orchestration subactions creation error",d),O.return()}oxN(a,r,P,X);if(!X){O.Oo(12);break}U=X.map(function(d){return gB(d)});
C=0;case 13:if(!(C<X.length)||e.C){O.Oo(15);break}return g.l(O,MF(e.T,{mode:"readwrite",DD:!0},function(d){var W=[];W.push(RwM(d,U.slice(C,C+10),"offlineOrchestrationActionWrapperEntity"));return g.bk.all(W)}),16);
case 16:C+=10;O.Oo(13);break;case 15:if(e.C)return e.C=!1,O.return();case 12:return G=gB(a),g.l(O,a_G(e.T,G.key),17);case 17:cia(a,4),g.OO(O)}})},ZTa=function(e,a){var r,P,B,h,c,y,T,X,f,A,U,C;
return g.Y(function(G){r=[];P=Infinity;B=4E3;h=g.Z(a);for(c=h.next();!c.done;c=h.next())y=c.value,T=Number(y.enqueueTimeSec),X=bTG(T),f=y.retryScheduleIndex,A=f!=null&&f>0,X>0&&A?(P=Math.min(P,T),B=Math.min(X,B)):r.push(y);isFinite(P)&&(!e.B.isActive()||P<e.Y)&&(e.Y=P,e.B.start(B));e.Z.ZY()||(U=r.length,r=r.filter(function(O){var d;O=((d=O.actionProto)==null?void 0:d.actionType)||"OFFLINE_ORCHESTRATION_ACTION_TYPE_UNKNOWN";return!tG5.includes(O)}),C=r.length<U,!e.B.isActive()&&C&&e.B.start(1));
r.length>0&&gx5(e,r);return g.l(G,Aib(e),0)})},k$V=function(e){var a,r,P,B,h,c,y;
return g.Y(function(T){if(T.T==1)return g.l(T,OTV(e),2);a=T.S;r=[];P=g.Z(a);for(B=P.next();!B.done;B=P.next())h=B.value,c=g.sV(h.key),y=c.entityId,XDM(e.S,y)||r.push(h);return g.l(T,ZTa(e,r),0)})},bTG=function(e){e=e*1E3-Date.now();
return e>4E3?4E3:e},Exw=function(e,a){var r,P,B;
return g.Y(function(h){r=g.Z(a);for(P=r.next();!P.done;P=r.next()){B=P.value;var c=void 0,y=void 0,T=((y=B.action)==null?void 0:(c=y.actionMetadata)==null?void 0:c.retryScheduleIntervalsInSeconds)||[1,2,4];c=1;B.retryScheduleIndex<T.length&&(c=T[B.retryScheduleIndex]);B.S=c*1E3+Date.now();B.retryScheduleIndex++}return g.l(h,doV(e,a),0)})},fwG=function(e){var a;
return g.Y(function(r){if(r.T==1)return g.l(r,Kb(e.T,"offlineOrchestrationActionWrapperEntity"),2);a=r.S;return g.l(r,ZTa(e,a),0)})},gx5=function(e,a){a.length!==0&&a.forEach(function(r){r=t8(r);
r.retryScheduleIndex<3&&yi5(e.S,[r])})},OTV=function(e,a){var r;
return g.Y(function(P){if(P.T==1)return g.l(P,Kb(e.T,"offlineOrchestrationActionWrapperEntity",a),2);r=P.S;return P.return(r.filter(nO8))})},doV=function(e,a){if(a.length===0)return Promise.resolve([]);
a=a.map(function(r){return gB(r)});
return e3b(e.T,a)},JiB=function(e){this.j1=e;
this.S=void 0},Do9=function(e,a){var r,P,B,h;
return g.Y(function(c){r=a.videoId;P=!0;if(a.captionTracks.length)B=zFw(a),e.S=new g.Wp(e.j1,a,B);else if(a.Yf)h=g.a3O(a),e.S=new g.Lk(e.j1,a.Yf,r,h,a.SQ,a.eventId),P=a.SQ;else return c.return();return c.return(new Promise(function(y){var T;(T=e.S)==null||T.ov({hH:function(){return g.Y(function(X){if(X.T==1)return g.l(X,e.hH(r,P),2);y();g.OO(X)})},
lC:function(){}})}))})},VGN=function(e){var a;
return g.Y(function(r){if(r.T==1)return g.l(r,A4N(e),2);a=r.S;return r.return(!!a&&a.length>0)})},Io=function(e){g.N.call(this);
this.S=e;this.T=this.S.observe(this.B.bind(this))},$o5=function(e,a){var r,P,B,h,c,y,T;
return g.Y(function(X){switch(X.T){case 1:if(a.length===0)return X.return([]);r=a.map(function(f){return g.mf(f,"transfer")});
return g.l(X,Kb(e.S,"transfer",r),2);case 2:P=X.S;B=P.filter(nO8).map(function(f){return g.sV(f.key).entityId});
h=a.filter(function(f){return B.indexOf(f)===-1});
if(h.length===0)return X.return([]);c=g.Z(h);y=c.next();case 3:if(y.done){X.Oo(5);break}T=y.value;return g.l(X,SCa(T),4);case 4:y=c.next();X.Oo(3);break;case 5:return X.return(h)}})},lwB=function(e,a,r,P,B,h){var c,y,T;
return g.Y(function(X){c="STREAM_TYPE_UNKNOWN";r.video&&r.audio?(c="STREAM_TYPE_AUDIO_AND_VIDEO",Bq("unexpected stream type")):r.video&&!r.audio?c="STREAM_TYPE_VIDEO":!r.video&&r.audio&&(c="STREAM_TYPE_AUDIO");y=g.mf(a,"offlineVideoStreams");T={numBytesDownloaded:B.toFixed(),numTotalBytes:h.toFixed(),streamType:c,streamState:"DOWNLOAD_STREAM_STATE_IN_PROGRESS",formatStreamBytes:JSON.stringify(P),itag:c==="STREAM_TYPE_AUDIO_AND_VIDEO"?Number(r.itag):void 0};return g.l(X,MF(e,{mode:"readwrite",DD:!0},
function(f){var A=qF(f,y,"offlineVideoStreams"),U=qF(f,g.mf(a,"transfer"),"transfer");return g.bk.all([A,U]).then(function(C){C=g.Z(C);var G=C.next().value;C=C.next().value;if(!C)return sB(f,y).then(function(){});
var O=QcV(G);G=WDZ(G,P,T,y);var d=Sx(f,G,"offlineVideoStreams");QcV(G)>O&&(C.lastProgressTimeMs=Date.now().toString());O=[d];C.offlineVideoStreams||(C.offlineVideoStreams=[]);C.offlineVideoStreams.indexOf(y)===-1&&(C.offlineVideoStreams.push(y),O.push(Sx(f,C,"transfer")));return g.bk.all(O)})}),0)})},LDB=function(e,a){var r,P,B,h,c;
return g.Y(function(y){if(y.T==1)return r=g.mf(a,"offlineVideoStreams"),g.l(y,um(e,r,"offlineVideoStreams"),2);P=y.S;if(!P||!P.streamsProgress)return y.return();B=g.Z(P.streamsProgress);for(h=B.next();!h.done;h=B.next())c=h.value,c.streamState="DOWNLOAD_STREAM_STATE_COMPLETE",c.numTotalBytes!==c.numBytesDownloaded&&(c.numBytesDownloaded=c.numTotalBytes);return g.l(y,jx(e,P,"offlineVideoStreams"),0)})},WDZ=function(e,a,r,P){if(e&&e.streamsProgress){P=e;
a:{a=a.itag+";"+a.xtags;for(var B=e.streamsProgress,h=0;h<B.length;h++){var c=JSON.parse(B[h].formatStreamBytes);if(c.itag+";"+c.xtags===a){B[h]=r;r=B;break a}}B.push(r);r=B}P.streamsProgress=r}else e={key:P,streamsProgress:[r]};return e},QcV=function(e){if(e==null?0:e.streamsProgress){var a=0;
e=e.streamsProgress;for(var r=0;r<e.length;r++){var P=e[r];isNaN(Number(P.numBytesDownloaded))?Bq("stream progress bytes number invalid"):a+=Number(P.numBytesDownloaded)}return a}return 0},YyM=function(e,a,r,P){g.N.call(this);
var B=this;this.T=e;this.api=a;this.Uo=r;this.oH=P;this.Z=new g.xM;this.L=new g.vP(function(){B.S&&B.S.transferState==="TRANSFER_STATE_TRANSFERRING"&&B.Z.ZY()&&((B.S.transferRetryCount||0)<3?NZ(B.D,B.C,!1,!1):zf(B.D,B.C.videoDetails.videoId),B.zF("TRANSFER_FAILURE_REASON_TIMEOUT_NO_PROGRESS"))});
this.HW=this.Lf=0;this.N=this.Y=!1;this.GQ=g.eS(this.api.G().experiments,"html5_transfer_processing_logs_interval");this.XM=new g.Zc(this);this.Ob={scm:function(){return B.L},
gX1:function(){return B.oH},
Qx:function(){return B.Z}};
this.TQ=this.T.observe(this.PF.bind(this));this.D=new RtN(a,this);this.ym=new JiB(a);this.Eo=new Io(this.T);this.e1=this.Z.listen("publicytnetworkstatus-online",this.Aq.bind(this));this.Cf=this.Z.listen("publicytnetworkstatus-offline",this.ci1.bind(this));this.N=this.api.G().X("html5_less_transfer_processing_logs");g.x(this,this.XM);this.XM.j(a,"offlinetransferpause",this.mdo);if(g.tZ(this.api.G()))this.B="mainVideoDownloadStateEntity";else if(g.L$(this.api.G())||g.Zm(this.api.G()))this.B="musicTrackDownloadMetadataEntity"},
wDM=function(e){return g.Y(function(a){if(a.T==1)a=g.l(a,XnZ(),2);
else{var r=e.Eo;var P=g.KQ();P=Object.keys(P);r=$o5(r,P);a=g.l(a,r,0)}return a})},qZ=function(e,a){a=a===void 0?!1:a;
var r;return g.Y(function(P){if(P.T==1){if(e.S)throw Error("Already downloading a video");e.HW=0;e.Y=!1;return g.l(P,pDG(e),2)}return P.T!=4?(r=P.S,ipb(e.Uo,!r),r&&e.Z.ZY()?a?g.l(P,new Promise(function(B){g.Tu(B,1E3)}),4):P.Oo(4):(!r&&e.S&&Hq(e),P.Oo(0))):g.l(P,iTN(e,r),0)})},z7a=function(e){return g.Y(function(a){if(a.T==1)return e.C?g.l(a,zf(e.D,e.C.videoDetails.videoId),3):a.Oo(0);
Hq(e);g.OO(a)})},NrN=function(e,a){var r,P,B;
return g.Y(function(h){switch(h.T){case 1:return g.kN(h,2),(r=!!a.captionTracks.length||!!a.Yf)?g.l(h,VGN(a.videoId),4):h.return();case 4:return(P=h.S)?h.return():g.l(h,Do9(e.ym,a),5);case 5:g.Dl(h,0);break;case 2:B=g.Q3(h),Bq("Caption downloading error",B,a.cotn),g.OO(h)}})},iTN=function(e,a){var r,P,B,h,c,y;
return g.Y(function(T){switch(T.T){case 1:if(e.Y)return T.return();e.Y=!0;e.S=a;r=g.sV(e.S.key);P=r.entityId;B=void 0;if(e.S.transferState==="TRANSFER_STATE_TRANSFERRING")return g.l(T,vq(e,P),7);if(e.S.transferState!=="TRANSFER_STATE_TRANSFER_IN_QUEUE"||e.S.transferRetryCount||e.S.hasLoggedFirstStarted){T.Oo(3);break}return g.l(T,vq(e,P),5);case 5:return B=T.S,e.S.hasLoggedFirstStarted=!0,g.l(T,xol(e),6);case 6:Nkl({videoId:P,rb:e.S,offlineModeType:B},void 0,void 0,!0);T.Oo(3);break;case 7:B=T.S,
yS({transferStatusType:"TRANSFER_STATUS_TYPE_RESUME_PROCESSING",statusType:"OFFLINING_RETRIED"},{videoId:P,rb:e.S,offlineModeType:B});case 3:return g.l(T,IwN(e),8);case 8:return h=null,g.kN(T,9),g.l(T,HTB(e,a),11);case 11:h=T.S;e.C=h;g.Dl(T,10);break;case 9:return c=g.Q3(T),Bq("error getting player response",c,a.cotn),g.l(T,e.zF("TRANSFER_FAILURE_REASON_SERVER_PROPERTY_MISSING"),12);case 12:return T.return();case 10:return y=Sm8(e.api.G(),a.cotn,h),g.l(T,NrN(e,y),13);case 13:return g.l(T,saw(y.videoId),
14);case 14:y.t6=T.S,jaB(e.D,y,a.maximumDownloadQuality),e.L.start(108E5),g.OO(T)}})},pDG=function(e){var a,r;
return g.Y(function(P){if(P.T==1)return g.l(P,Kb(e.T,"transfer"),2);a=P.S;r=a.filter(qyG).sort(vxN);return r.length===0?P.return():P.return(r[0])})},IwN=function(e){var a,r,P;
return g.Y(function(B){if(B.T==1){if(!e.S)return Ro(e,"onTransferStart"),B.return();e.L.start(108E5);return g.l(B,S4(e,"TRANSFER_STATE_TRANSFERRING"),2)}a=e.S;return(P=((r=a)==null?0:r.key)?g.sV(a.key).entityId:"")&&e.B?g.l(B,U6(P,e.B,e.T,"DOWNLOAD_STATE_DOWNLOAD_IN_PROGRESS"),0):B.Oo(0)})},FsN=function(e){var a,r,P,B;
g.Y(function(h){switch(h.T){case 1:if(!e.S){Ro(e,"onTransferPausedByUser");h.Oo(2);break}a=e.S;e.L.stop();return g.l(h,S4(e,"TRANSFER_STATE_PAUSED_BY_USER"),3);case 3:P=((r=a)==null?0:r.key)?g.sV(a.key).entityId:"";if(!P||!e.B){h.Oo(4);break}return g.l(h,U6(P,e.B,e.T,"DOWNLOAD_STATE_PAUSED"),4);case 4:return g.l(h,vq(e,P),6);case 6:B=h.S,I_G({videoId:P,rb:a,offlineModeType:B});case 2:Hq(e),qZ(e),g.OO(h)}})},MpZ=function(e){var a,r,P;
g.Y(function(B){if(B.T==1){if(!e.S)return Ro(e,"onTransferPausedByNetwork"),B.return();e.L.stop();return g.l(B,S4(e,"TRANSFER_STATE_TRANSFER_IN_QUEUE"),2)}if(B.T!=3)return a=e.S,(P=((r=a)==null?0:r.key)?g.sV(a.key).entityId:"")&&e.B?g.l(B,U6(P,e.B,e.T,"DOWNLOAD_STATE_PAUSED"),3):B.Oo(3);Hq(e);g.OO(B)})},R7a=function(e){var a,r,P,B,h;
g.Y(function(c){switch(c.T){case 1:if(!e.S)return Ro(e,"onTransferComplete"),c.return();a=e.S;e.L.stop();if(!a||!e.C){c.Oo(2);break}r=Sm8(e.api.G(),a.cotn,e.C);return g.l(c,NrN(e,r),2);case 2:return g.l(c,S4(e,"TRANSFER_STATE_COMPLETE","DOWNLOAD_STREAM_STATE_COMPLETE"),4);case 4:B=((P=a)==null?0:P.key)?g.sV(a.key).entityId:"";if(!B||!e.B){c.Oo(5);break}return g.l(c,U6(B,e.B,e.T,"DOWNLOAD_STATE_COMPLETE"),5);case 5:return g.l(c,LDB(e.T,B),7);case 7:return g.l(c,vq(e,B),8);case 8:h=c.S,yS({transferStatusType:"TRANSFER_STATUS_TYPE_COMPLETED",
statusType:"SUCCESS"},{videoId:B,rb:a,offlineModeType:h}),Hq(e),qZ(e),g.OO(c)}})},Syb=function(e,a,r){var P,B;
g.Y(function(h){switch(h.T){case 1:if(!e.S)return Ro(e,"onTransferProgress: "+a),h.return();if(e.S.transferState==="TRANSFER_STATE_TRANSFERRING"){h.Oo(2);break}return g.l(h,IwN(e),2);case 2:P=Date.now();if(!(P-e.Lf>1E3)){h.Oo(4);break}e.Lf=P;return g.l(h,lwB(e.T,r.videoId,r.T,r.D_,r.bytesDownloaded,r.S),5);case 5:if(e.N&&!(e.N&&P-e.HW>e.GQ)){h.Oo(4);break}e.HW=P;return g.l(h,vq(e,a),7);case 7:B=h.S,Nkl({videoId:a,rb:e.S,offlineModeType:B},r.bytesDownloaded,r.S);case 4:e.L.start(108E5),g.OO(h)}})},
scG=function(e){var a=(e.S.transferRetryCount||0)<3;
a&&(e=e.S,e.transferRetryCount=(e.transferRetryCount||0)+1);return a},moZ=function(e,a){a=a===void 0?"TRANSFER_FAILURE_REASON_UNKNOWN":a;
var r,P,B,h;return g.Y(function(c){if(c.T==1)return e.S||Ro(e,"setTransferToFailed: "+a),r="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",a==="TRANSFER_FAILURE_REASON_NETWORK"?r="OFFLINE_OPERATION_FAILURE_REASON_NETWORK_REQUEST_FAILED":a==="TRANSFER_FAILURE_REASON_FILESYSTEM_WRITE"&&(r="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED"),g.l(c,S4(e,"TRANSFER_STATE_FAILED","DOWNLOAD_STREAM_STATE_ERROR_STREAMS_MISSING",a),2);if(c.T!=3)return cq(e.oH,{entityKey:(P=e.S)==null?void 0:P.key,failureReason:r}),
B=e.S?g.sV(e.S.key).entityId:"",g.l(c,vq(e,B),3);h=c.S;var y={videoId:B,rb:e.S,offlineModeType:h},T=a,X={transferStatusType:"TRANSFER_STATUS_TYPE_TERMINATED_WITH_FAILURE",statusType:"FAILED"};T&&(X.transferFailureReason=T,X.failureReason=Hpw(T));yS(X,y);g.OO(c)})},S4=function(e,a,r,P){var B;
return g.Y(function(h){if(h.T==1){if(!e.S)return Ro(e,"saveTransferState: "+a),h.return();e.S.transferState=a;e.S.failureReason=P;g.kN(h,2);return g.l(h,xol(e,function(c){return r?vX(c,"offlineVideoStreams",e.S.offlineVideoStreams).then(function(y){for(var T=g.Z(y),X=T.next();!X.done;X=T.next())if((X=X.value)&&X.streamsProgress){X=g.Z(X.streamsProgress);for(var f=X.next();!f.done;f=X.next())f.value.streamState=r}return RwM(c,y.filter(function(A){return!!A}),"offlineVideoStreams")}):g.bk.resolve(void 0)}),
4)}if(h.T!=2)return g.Dl(h,0);
B=g.Q3(h);return B instanceof g.XX&&B.type==="QUOTA_EXCEEDED"?g.l(h,e.zF("TRANSFER_FAILURE_REASON_FILESYSTEM_WRITE"),0):h.Oo(0)})},xol=function(e,a){var r;
return g.Y(function(P){if(!e.S)return P.return();r=e.S;return g.l(P,MF(e.T,{mode:"readwrite",DD:!0},function(B){var h=[Sx(B,r,"transfer")];a&&h.push(a(B));return g.bk.all(h)}),0)})},Hq=function(e){e.S=void 0;
e.C=void 0;e.L.stop()},HTB=function(e,a){var r,P,B,h,c;
return g.Y(function(y){if(y.T==1)return r=g.sV(a.key),P=r.entityId,B=g.mf(P,"playbackData"),g.l(y,um(e.T,B,"playbackData"),2);h=y.S;if((c=h)==null?0:c.playerResponseJson)return y.return(JSON.parse(h.playerResponseJson));throw Error("No PlayerResponse found");})},Ro=function(e,a){e.api.nf("woffle",{mcte:a});
Bq("missing current transfer entity.")},vq=function(e,a){var r,P,B;
return g.Y(function(h){if(h.T==1)return g.l(h,um(e.T,g.mf(a,"videoDownloadContextEntity"),"videoDownloadContextEntity"),2);r=h.S;return h.return((B=(P=r)==null?void 0:P.offlineModeType)!=null?B:void 0)})},qyG=function(e){return FDV[e.transferState]!==void 0},vxN=function(e,a){var r=FDV[e.transferState],P=FDV[a.transferState];
return r!==P?r-P:Number(e.enqueuedTimestampMs)-Number(a.enqueuedTimestampMs)},s6=function(e,a){var r=this;
this.iW=e;this.api=a;this.Z=new g.xM;this.C=new g.fp;this.Ob={wq:function(){return r.B.Ob.wq()},
Qx:function(){return r.Z},
OSo:function(){return r.B},
vL:function(){return r.vL()},
bH:function(){return r.bH()},
O0:function(){return r.O0()},
Cn:function(){return r.Cn()},
WH:function(){return r.WH()},
lD:function(P){return r.lD(P)}};
this.B=new L0w(function(){return MGl(r)},function(){r.O0()},this.api.XU(),this.api.X.bind(this.api));
this.S=new h8(this.api);YmZ(this.B)},MGl=function(e){return g.Y(function(a){e.api.qF("onOrchestrationBecameLeader");
return g.l(a,e.bH(),0)})},uTw=function(e){var a,r;
return g.Y(function(P){if(P.T==1)return g.l(P,e4(),2);if(P.T!=3){a=P.S;if(!a)return Bq("PES is undefined"),P.return();e.T=new YyM(a,e.api,e.B,e.S);r=e.IC(a);return g.l(P,UoM(a,r,e.B,e.S,e.iW),3)}e.D=P.S;return g.l(P,jcw(e),0)})},jcw=function(e){var a;
return g.Y(function(r){switch(r.T){case 1:if(!e.T)return Bq("transferManager is undefined"),r.return();if(e.T.S){r.Oo(2);break}return g.l(r,qZ(e.T),2);case 2:if(!e.iW.X("woffle_enable_main_downloads_library")){r.Oo(4);break}return g.l(r,e.jG(),4);case 4:if(!e.iW.X("html5_offline_playback_position_sync")){r.Oo(6);break}return g.l(r,e.qL(),7);case 7:return g.l(r,e.lD(864E5),6);case 6:return g.l(r,e.refreshAllStaleEntities(43200,!0),9);case 9:return g.l(r,e.XS(),10);case 10:if(!e.iW.X("html5_retry_downloads_for_expiration")){r.Oo(11);
break}return g.l(r,e.WH(),11);case 11:return e.Y=g.Xw(function(){e.refreshAllStaleEntities(43200,!0);e.XS()},9E5),g.S$(g.Fn(),function(){return e.Cn()}),g.l(r,e4(),13);
case 13:return a=r.S,g.l(r,l_B(a),14);case 14:wn9(e.B),g.OO(r)}})},KDB=function(){var e,a,r,P,B,h;
return g.Y(function(c){switch(c.T){case 1:return g.l(c,e4(),2);case 2:e=c.S;if(!e)return c.return([]);a=Date.now()/1E3;return g.l(c,Kb(e,"offlineVideoPolicy"),3);case 3:r=c.S,P=g.Z(r),B=P.next();case 4:if(B.done){c.Oo(6);break}h=B.value;if(!(h.expirationTimestamp&&Number(h.expirationTimestamp)<a)){c.Oo(5);break}h.action="OFFLINE_VIDEO_POLICY_ACTION_DISABLE";h.offlinePlaybackDisabledReason="OFFLINE_PLAYBACK_DISABLED_REASON_CLIENT_OFFLINE_CONTENT_EXPIRED";return g.l(c,jx(e,h,"offlineVideoPolicy"),5);
case 5:B=P.next();c.Oo(4);break;case 6:return c.return(r.map(function(y){return y.key}))}})},mB=function(e,a,r,P,B){var h,c,y;
return g.Y(function(T){if(T.T==1)return g.l(T,e4(),2);h=T.S;if(!h)return T.return([]);c=a.map(function(X){var f=g.mf(X,r);f={actionType:P,entityKey:f,actionMetadata:Object.assign({},szl(),B)};P!=="OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH"&&(f.actionMetadata.priority=0);X=new bM(r,X,f);return gB(X)});
y=e3b(h,c);YmZ(e.B);return T.return(y)})},enw=function(e,a,r,P){var B,h,c,y,T,X,f,A;
return g.Y(function(U){switch(U.T){case 1:B=[],h=g.Z(a),c=h.next();case 2:if(c.done){U.Oo(4);break}y=c.value;if(y.upToDate||r&&!y.shouldAutoSyncMetadata||!y.playlistId){U.Oo(3);break}T={};switch(P){case "mainPlaylistEntity":X={nextAutoRefreshIntervalSeconds:y.checkInSeconds,autoSync:r};T={mainPlaylistEntityActionMetadata:X};break;case "musicPlaylist":f={autoSync:r},T={musicPlaylistEntityActionMetadata:f}}return g.l(U,mB(e,[y.playlistId],P,"OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH",T),6);case 6:(A=
U.S)&&B.push.apply(B,g.UO(A));case 3:c=h.next();U.Oo(2);break;case 4:return U.return(B)}})},aj8=function(e,a){var r;
return g.Y(function(P){return a.length?(r=szl(),g.L4(r,pM,{isEnqueuedForExpiredStreamUrlRefetch:!0}),e.api.nf("qrd",{v:a.length}),P.return(mB(e,a,"playbackData","OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",r))):P.return([])})},raa=function(e,a,r){this.S=e;
this.iW=a;this.B=r},hna=function(e,a){var r,P,B,h,c,y,T,X,f,A,U,C,G,O,d,W,V;
return g.Y(function(L){switch(L.T){case 1:return r=Tf(a),P=g.sV(a.entityKey),B=P.entityId,h=[],g.kN(L,2),g.l(L,Pxl(e,B),4);case 4:h=L.S;if(!(e.iW.X("woffle_enable_main_downloads_library")&&((c=h)==null?0:c.length))){L.Oo(5);break}return g.l(L,cn9(e.S,[a.entityKey]),5);case 5:g.Dl(L,3);break;case 2:return y=g.Q3(L),T="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",X="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",y instanceof g.XX&&y.type==="QUOTA_EXCEEDED"?(T="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",
X="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"):Bq("Playlist add error"),L.return(new wB("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",r,void 0,T,X));case 3:f=[];if(!e.iW.X("html5_offline_prevent_redownload_downloaded_video")){L.Oo(7);break}return g.l(L,R3V(e.S,"mainVideoEntity",h),8);case 8:h=L.S;case 7:if((A=h)==null?0:A.length)for(U=g.Z(h),C=U.next();!C.done;C=U.next())if(G=C.value,O=G.offlineVideoData,d=void 0,(d=O)==null?0:d.videoId)W=void 0,V=Number(((W=a.actionMetadata)==null?void 0:W.priority)||
0)+1,f.push(Yo("OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",O.videoId,"mainVideoEntity",V,FA,BMB(a,O,B)));return L.return(new wB("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",r,f))}})},om8=function(e,a){var r,P,B,h,c,y,T,X,f,A,U,C,G,O,d,W,V,L,z,q,M,m,cI,CL,nL,y3,aT,$N,F4,ea,EG,n5,lq,cd,iN,vB,oQ,Q,IQ,L5,PI,Jw,k,r4,Lf,nD,IZ,sO,rb,aD,Hd,J,t,D,w,I,fL,R,K,p,w4,qj,oT,XN,LL,Jz,ry,db,zV,V3,kH,WI,Y9,DB;
return g.Y(function(nf){switch(nf.T){case 1:return r=Tf(a),P=a.entityKey,B=g.sV(P).entityId,h=[],c=!1,B==="!*$_ALL_ENTITIES_!*$"?(c=!0,g.l(nf,Kb(e.S,"mainPlaylistEntity"),5)):g.l(nf,um(e.S,P,"mainPlaylistEntity"),4);case 4:(y=nf.S)&&h.push(y);nf.Oo(3);break;case 5:h=nf.S;case 3:if((T=h)==null||!T.length)return nf.return(new wB("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",r));X=g.H(a.actionMetadata,ca5);A=(f=X)==null?void 0:f.nextAutoRefreshIntervalSeconds;C=(U=X)==null?void 0:U.autoSync;G=[];d=O=
!0;W=!1;if(!c&&C===!1){nf.Oo(6);break}g.kN(nf,7);return g.l(nf,g4G(0,!!C,!0,h),9);case 9:G=nf.S;g.Dl(nf,8);break;case 7:V=g.Q3(nf);if(!(V instanceof Error&&V.message==="No data")){V instanceof Error&&V.message==="Empty response body"&&Bq(V.message);nf.Oo(8);break}return B==="!*$_ALL_ENTITIES_!*$"?g.l(nf,et9(e.S,a,e.B,"OFFLINE_DELETE_REASON_UNAVAILABLE"),8):g.l(nf,uDN(B,e.S,a,e.B),8);case 8:if(!G.length||!c&&G[0].playlistId!==B)return nf.return(new wB("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
r));case 6:if(c){L=[];z=g.Z(G);for(q=z.next();!q.done;q=z.next())M=q.value,M.upToDate||C&&!M.shouldAutoSyncMetadata||!M.playlistId||(m={nextAutoRefreshIntervalSeconds:M.checkInSeconds,autoSync:C},L.push(Yo("OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH",M.playlistId,"mainPlaylistEntity",0,FA,{mainPlaylistEntityActionMetadata:m})));return nf.return(new wB("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",r,L))}G.length&&(cI=G[0],W=!!cI.upToDate,C&&(O=(CL=cI.shouldAutoSyncMetadata)!=null?CL:!0,d=(nL=cI.shouldAutoSyncVideos)!=
null?nL:!0,cI.checkInSeconds&&(A=cI.checkInSeconds)));if(W||!O)return nf.return(new wB("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",r));y3=[];aT=h[0];if(!aT.downloadState){$N=void 0;nf.Oo(15);break}return g.l(nf,um(e.S,aT.downloadState,"mainPlaylistDownloadStateEntity"),16);case 16:$N=nf.S;case 15:return F4=$N,EG=((ea=F4)==null?0:ea.addedTimestampMillis)?String(F4.addedTimestampMillis):void 0,g.kN(nf,17),g.l(nf,Pxl(e,B,EG,A),19);case 19:y3=nf.S;g.Dl(nf,18);break;case 17:n5=g.Q3(nf);if(!(n5 instanceof
Error&&n5.message==="No data for playlist")){if(n5 instanceof Error&&n5.message==="Empty response body for playlist")Bq(n5.message);else return lq="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",cd="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",n5 instanceof g.XX&&n5.type==="QUOTA_EXCEEDED"&&(lq="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",cd="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),nf.return(new wB("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",r,void 0,lq,cd));
nf.Oo(18);break}return g.l(nf,uDN(B,e.S,a,e.B),18);case 18:if(!d)return nf.return(new wB("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",r));iN=[];vB=new Map;if((oQ=y3)==null?0:oQ.length)for(Q=g.Z(y3),IQ=Q.next();!IQ.done;IQ=Q.next())L5=IQ.value,PI=L5.offlineVideoData,Jw=void 0,((Jw=PI)==null?0:Jw.videoId)&&vB.set(PI.videoId,PI);k=new Map;r4=[];if((Lf=aT)==null?0:(nD=Lf.videos)==null?0:nD.length)for(IZ=g.Z(aT.videos),sO=IZ.next();!sO.done;sO=IZ.next())if(rb=sO.value,aD=JSON.parse(g.sV(rb).entityId),
Hd=aD.videoId)vB.has(Hd)?(k.set(Hd,vB.get(Hd)),vB.delete(Hd)):r4.push(Hd);t=Number(((J=a.actionMetadata)==null?void 0:J.priority)||0)+1;D=g.Z(vB.entries());for(w=D.next();!w.done;w=D.next())I=w.value,fL=g.Z(I),R=fL.next().value,K=fL.next().value,p=R,w4=K,iN.push(Yo("OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",p,"mainVideoEntity",t,FA,BMB(a,w4,B)));qj=g.Z(k.entries());for(oT=qj.next();!oT.done;oT=qj.next())XN=oT.value,LL=g.Z(XN),Jz=LL.next().value,ry=LL.next().value,db=Jz,zV=ry,iN.push(Yo("OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH",
db,"mainVideoEntity",t,FA,BMB(a,zV,B)));V3=g.Z(r4);for(kH=V3.next();!kH.done;kH=V3.next())WI=kH.value,Y9={playlistId:B},DB={offlineLoggingData:{offlineDeleteReason:"OFFLINE_DELETE_REASON_PARENT_LIST_REFRESH"},mainVideoEntityActionMetadata:Y9},iN.push(Yo("OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE",WI,"mainVideoEntity",0,FA,DB));return nf.return(new wB("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",r,iN))}})},nmN=function(e,a){var r,P,B,h;
return g.Y(function(c){switch(c.T){case 1:return r=Tf(a),g.kN(c,2),P=g.sV(a.entityKey).entityId,P==="!*$_ALL_ENTITIES_!*$"?g.l(c,et9(e.S,a,e.B,(B=a.actionMetadata)==null?void 0:(h=B.offlineLoggingData)==null?void 0:h.offlineDeleteReason),5):g.l(c,uDN(P,e.S,a,e.B),6);case 6:if(!e.iW.X("woffle_enable_main_downloads_library")){c.Oo(5);break}return g.l(c,o4l(e.S,a.entityKey),5);case 5:g.Dl(c,3);break;case 2:return g.Q3(c),c.return(new wB("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",r,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",
"OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 3:return c.return(new wB("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",r))}})},Pxl=function(e,a,r,P){var B,h,c,y,T,X,f;
return g.Y(function(A){switch(A.T){case 1:return g.l(A,bX5([a]),2);case 2:return B=A.S,g.l(A,yaG(e,B[0],r,P),3);case 3:return h=A.S,c=h.mainPlaylistEntity,y=h.JiW,X=MUM(c,(T=y)==null?void 0:T.avatar),g.kN(A,4),g.l(A,O6(X),6);case 6:g.Dl(A,5);break;case 4:f=g.Q3(A),f instanceof Error&&f.message==="Failed to fetch"&&Bq(f.message);case 5:return A.return(B[0].videos)}})},yaG=function(e,a,r,P){var B,h,c,y,T,X,f,A,U,C,G,O,d,W,V,L,z;
return g.Y(function(q){switch(q.T){case 1:B=Date.now().toString();r||(r=B);h=a.videos;c=a.playlistId;y=[];T=[];if(h)for(X=g.Z(h),f=X.next();!f.done;f=X.next()){A=f.value;U=A.offlineVideoData;if(!U||!U.videoId)throw Bq("Invalid offlineVideoData for playlist"),Error("Invalid offlineVideoData for playlist");C=U.videoId;G={videoId:C,playlistId:c};O={id:g.mf(JSON.stringify(G),"mainPlaylistVideoEntity"),video:g.mf(C,"mainVideoEntity")};y.push(O);T.push(O.id)}W={key:g.mf(c,"mainPlaylistDownloadStateEntity"),
addedTimestampMillis:r,lastSyncedTimestampMillis:B};V={key:g.mf(c,"mainPlaylistEntity"),playlistId:c,videos:T,title:a.title,thumbnailStyleData:TMZ(a),visibility:XVB(a),downloadState:W.key};a.channel&&(L=a.channel.offlineChannelData,d=fjN(g.mf(c,"ytMainChannelEntity"),L),V.channelOwner=d.id);((z=V)==null?0:z.entityMetadata)?(V.entityMetadata.offlineLastModifiedTimestampSeconds=a.lastModifiedTimestamp,P&&(V.entityMetadata.nextAutoRefreshIntervalSeconds=String(P))):V&&(V.entityMetadata={nextAutoRefreshIntervalSeconds:P?
String(P):void 0,offlineLastModifiedTimestampSeconds:a.lastModifiedTimestamp});g.kN(q,2);return g.l(q,MF(e.S,{mode:"readwrite",DD:!0},function(M){var m=Sx(M,V,"mainPlaylistEntity"),cI=Sx(M,W,"mainPlaylistDownloadStateEntity");m=[m,cI];cI=g.Z(y);for(var CL=cI.next();!CL.done;CL=cI.next())m.push(Sx(M,CL.value,"mainPlaylistVideoEntity"));d&&m.push(Sx(M,d,"ytMainChannelEntity"));return g.bk.all(m)}),4);
case 4:g.Dl(q,3);break;case 2:throw g.Q3(q),Bq("PES failure for playlist"),Error("PES failure for playlist");case 3:return q.return({mainPlaylistEntity:V,JiW:d,A6m:y})}})},fjN=function(e,a){return{id:e,
channelId:a.channelId,title:a.title,avatar:a.thumbnail}},TMZ=function(e){var a=[],r=e.videos;
r&&r.length>0&&a.push({key:Number("PLAYLIST_THUMBNAIL_STYLE_FIRST_VIDEO"),value:{collageThumbnail:{coverThumbnail:r[0].offlineVideoData.thumbnail}}});if((e=e.additionalMetadadatas)&&e.length>0)for(e=g.Z(e),r=e.next();!r.done;r=e.next()){var P=r.value.offlineBundleItemPlaylistData,B=void 0;r=(B=P)==null?void 0:B.style;B=void 0;P={collageThumbnail:{coverThumbnail:(B=P)==null?void 0:B.coverThumbnail}};switch(r){case "BUNDLE_ITEM_STYLE_UNSPECIFIED":a.push({key:Number("PLAYLIST_THUMBNAIL_STYLE_UNKNOWN"),
value:P});break;case "BUNDLE_ITEM_STYLE_TWO_BY_TWO":a.push({key:Number("PLAYLIST_THUMBNAIL_STYLE_TWO_BY_TWO"),value:P});break;case "BUNDLE_ITEM_STYLE_ONE_AND_TWO_AVATAR":a.push({key:Number("PLAYLIST_THUMBNAIL_STYLE_ONE_AND_TWO_AVATAR"),value:P});break;case "BUNDLE_ITEM_STYLE_ONE_AND_TWO":a.push({key:Number("PLAYLIST_THUMBNAIL_STYLE_ONE_AND_TWO"),value:P})}}return a},XVB=function(e){switch(e.privacy){case "PRIVATE":return"PLAYLIST_VISIBILITY_PRIVATE";
case "PUBLIC":return"PLAYLIST_VISIBILITY_PUBLIC";case "UNLISTED":return"PLAYLIST_VISIBILITY_UNLISTED";default:return"PLAYLIST_VISIBILITY_UNKNOWN"}},BMB=function(e,a,r){a={offlineVideoData:a,
playlistId:r};if(e=g.H(e.actionMetadata,ca5))a.maximumDownloadQuality=e.maximumDownloadQuality;return{mainVideoEntityActionMetadata:a}},Aa9=function(e,a,r){this.S=e;
this.iW=a;this.B=r},GtM=function(e,a){var r,P,B,h,c,y,T,X,f,A,U,C,G;
return g.Y(function(O){switch(O.T){case 1:return r=Tf(a),P=g.sV(a.entityKey),B=P.entityId,h=g.H(a.actionMetadata,MZ),y=!((c=h)==null?0:c.playlistId),g.kN(O,2),g.l(O,UAN(e,B,void 0,(T=h)==null?void 0:T.offlineVideoData,y),4);case 4:g.Dl(O,3);break;case 2:return X=g.Q3(O),f="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",A="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",X instanceof g.XX&&X.type==="QUOTA_EXCEEDED"&&(f="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",A="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),
O.return(new wB("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",r,void 0,f,A));case 3:U=1;U=Number(((C=a.actionMetadata)==null?void 0:C.priority)||0)+1;var d=(d=g.H(a.actionMetadata,MZ))?{playbackDataActionMetadata:{maximumDownloadQuality:d.maximumDownloadQuality}}:void 0;G=Yo("OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",B,"playbackData",U,Cx8,d);return O.return(new wB("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",r,[G]))}})},EmN=function(e,a){var r,P,B,h,c,y,T,X,f,A,U,C,G,O,d,W,V;
return g.Y(function(L){switch(L.T){case 1:return r=Tf(a),P=g.sV(a.entityKey),B=P.entityId,g.l(L,um(e.S,a.entityKey,"mainVideoEntity"),2);case 2:h=L.S;if(!h){c=void 0;L.Oo(3);break}return g.l(L,um(e.S,h.downloadState,"mainVideoDownloadStateEntity"),4);case 4:c=L.S;case 3:y=c;if(!h||!y)return L.return(new wB("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",r));g.kN(L,5);return g.l(L,UAN(e,B,y.addedTimestampMillis,(X=g.H(a.actionMetadata,MZ))==null?void 0:X.offlineVideoData),7);case 7:f=1;f=Number(((A=
a.actionMetadata)==null?void 0:A.priority)||0)+1;T=Yo("OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH",B,"playbackData",f,Cx8);g.Dl(L,6);break;case 5:U=g.Q3(L);if(!(U instanceof Error&&U.message==="No data")){if(U instanceof Error&&U.message==="Empty response body")Bq(U.message);else return C="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",G="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",U instanceof g.XX&&U.type==="QUOTA_EXCEEDED"&&(C="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",
G="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),L.return(new wB("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",r,void 0,C,G));L.Oo(6);break}return g.l(L,J8(e.S,B),9);case 9:O=L.S;d=g.H(a.actionMetadata,MZ);if(V=(W=d)==null?void 0:W.playlistId)O.playlistId=V;O.offlineDeleteReason="OFFLINE_DELETE_REASON_UNAVAILABLE";return g.l(L,ko(B,e.S,a,e.B,O),6);case 6:return L.return(new wB("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",r,T?[T]:void 0))}})},bGZ=function(e,a){var r,P,B,h,c,y,T,X,f,A;
return g.Y(function(U){switch(U.T){case 1:return r=Tf(a),g.kN(U,2),P=g.sV(a.entityKey).entityId,P==="!*$_ALL_ENTITIES_!*$"?g.l(U,et9(e.S,a,e.B,(f=a.actionMetadata)==null?void 0:(A=f.offlineLoggingData)==null?void 0:A.offlineDeleteReason),5):g.l(U,J8(e.S,P),6);case 6:B=U.S;h=g.H(a.actionMetadata,MZ);if(y=(c=h)==null?void 0:c.playlistId)B.playlistId=y;B.offlineDeleteReason=(T=a.actionMetadata)==null?void 0:(X=T.offlineLoggingData)==null?void 0:X.offlineDeleteReason;return g.l(U,ko(P,e.S,a,e.B,B),7);
case 7:if(!e.iW.X("woffle_enable_main_downloads_library")){U.Oo(5);break}return g.l(U,o4l(e.S,a.entityKey),5);case 5:g.Dl(U,3);break;case 2:return g.Q3(U),U.return(new wB("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",r,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 3:return U.return(new wB("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",r))}})},UAN=function(e,a,r,P,B){var h,c,y,T,X,f;
return g.Y(function(A){switch(A.T){case 1:if(h=P){A.Oo(2);break}return g.l(A,E4V([a]),3);case 3:c=A.S,h=c[0];case 2:return g.l(A,tXa(e,h,r,B),4);case 4:y=A.S;T=y.mainVideoEntity;X=y.channelEntity;g.kN(A,5);var U=E6(T.thumbnail),C=E6(X.avatar);return g.l(A,O6(U.concat(C)),7);case 7:g.Dl(A,0);break;case 5:f=g.Q3(A),f instanceof Error&&f.message==="Failed to fetch"&&Bq(f.message),g.OO(A)}})},tXa=function(e,a,r,P){var B,h,c,y,T,X,f,A,U,C,G,O,d;
return g.Y(function(W){switch(W.T){case 1:r||(r=Date.now().toString());h=(B=a.channel)==null?void 0:B.offlineChannelData;c={id:g.mf(a.videoId,"ytMainChannelEntity"),channelId:h.channelId,title:h.title,avatar:h.thumbnail};y={key:g.mf(a.videoId,"mainVideoDownloadStateEntity"),playbackData:g.mf(a.videoId,"playbackData"),addedTimestampMillis:r,videoDownloadContextEntity:g.mf(a.videoId,"videoDownloadContextEntity")};T={key:g.mf(a.videoId,"videoPlaybackPositionEntity"),videoId:a.videoId,lastPlaybackPositionSeconds:"0"};
e.iW.X("html5_offline_playback_position_sync")&&(X={playbackPosition:T.key});f=g.mf(a.videoId,"mainVideoEntity");A={key:f,videoId:a.videoId,title:a.title,thumbnail:a.thumbnail,localizedStrings:{viewCount:a.shortViewCountText},userState:X,lengthSeconds:a.lengthSeconds?Number(a.lengthSeconds):void 0,publishedTimestampMillis:a.publishedTimestamp?(Number(a.publishedTimestamp)*1E3).toString():void 0,formattedDescription:a.description,owner:c.id,downloadState:y.key};if(!e.iW.X("woffle_enable_main_downloads_library")||
!P){W.Oo(2);break}return g.l(W,htw(e.S,[f]),3);case 3:if(G=W.S)U=G.mainDownloadsLibraryEntity,C=G.mainDownloadsListEntity;case 2:return d=vO9,O={key:g.mf(a.videoId,"downloadStatusEntity"),downloadState:"DOWNLOAD_STATE_PENDING_DOWNLOAD"},g.L4(y,d,O),g.l(W,MF(e.S,{mode:"readwrite",DD:!0},function(V){var L=Sx(V,c,"ytMainChannelEntity"),z=Sx(V,y,"mainVideoDownloadStateEntity"),q=Sx(V,A,"mainVideoEntity");L=[L,z,q];e.iW.X("html5_offline_playback_position_sync")&&(z=Sx(V,T,"videoPlaybackPositionEntity"),
L.push(z));U&&(z=Sx(V,U,"mainDownloadsLibraryEntity"),L.push(z));C&&(z=Sx(V,C,"mainDownloadsListEntity"),L.push(z));O&&(V=Sx(V,O,"downloadStatusEntity"),L.push(V));return g.bk.all(L)}),4);
case 4:return W.return({mainVideoEntity:A,channelEntity:c})}})},gm9=function(e,a,r){this.S=e;
this.iW=a;this.B=r},OGN=function(e,a){var r,P,B,h,c,y,T,X,f,A,U,C,G,O,d,W,V,L,z,q,M,m,cI,CL,nL,y3,aT;
return g.Y(function($N){switch($N.T){case 1:return r=Tf(a),P=[],g.l($N,xv.getInstance(),2);case 2:B=$N.S;if(!B){$N.Oo(3);break}return g.l($N,B.get("sdois"),4);case 4:return h=$N.S,g.l($N,(y=B)==null?void 0:y.get("lmqf"),5);case 5:c=$N.S;case 3:g.kN($N,6);if(h===void 0)throw Error("prefStorage or opt-in state is undefined");T=[];if(h){$N.Oo(8);break}return g.l($N,Bib(e.S),9);case 9:T=$N.S,T.reverse();case 8:if(!T.length){$N.Oo(10);break}X=g.Z(T);f=X.next();case 11:if(f.done){$N.Oo(10);break}A=f.value;
if(!A){$N.Oo(12);break}U=g.sV(A).entityId;return g.l($N,J8(e.S,U),14);case 14:return C=$N.S,C.offlineDeleteReason="OFFLINE_DELETE_REASON_PARENT_LIST_DELETE",g.l($N,ko(U,e.S,{entityKey:A,actionType:a.actionType},e.B,C),12);case 12:f=X.next();$N.Oo(11);break;case 10:return g.l($N,OX9(h,(G=c)!=null?G:"SD"),16);case 16:return O=$N.S,g.l($N,anM(O),17);case 17:d=P9a(O);if(!e.iW.X("woffle_enable_main_downloads_library")){$N.Oo(18);break}if(h){$N.Oo(19);break}return g.l($N,o4l(e.S,g.xi),19);case 19:return g.l($N,
cn9(e.S,[g.xi]),18);case 18:if((W=d)==null?0:W.length)for(V=g.Z(d),L=V.next();!L.done;L=V.next())if(q=z=L.value,M=q.actionType,m=q.entityKey,cI=q.actionMetadata,M&&m&&cI&&!g.H(cI,ZGB)){M==="OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE"&&(cI.offlineLoggingData={offlineDeleteReason:"OFFLINE_DELETE_REASON_PARENT_LIST_DELETE"});if(CL=g.H(z.actionMetadata,MZ))CL.playlistId="DOWNLOADS_LIST_ENTITY_ID_SMART_DOWNLOADS",z.actionMetadata=Object.assign({},z.actionMetadata,{mainVideoEntityActionMetadata:CL});P.push(z)}g.Dl($N,
7);break;case 6:return nL=g.Q3($N),y3="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",aT="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",nL instanceof g.XX&&nL.type==="QUOTA_EXCEEDED"&&(y3="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",aT="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),$N.return(new wB("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",r,void 0,y3,aT));case 7:return $N.return(new wB("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",r,P))}})},kta=function(){s6.apply(this,
arguments);
this.N="mainVideoEntity"},dAN=function(e,a,r){a=a===void 0?43200:a;
r=r===void 0?!0:r;var P=P===void 0?!1:P;var B,h,c;return g.Y(function(y){switch(y.T){case 1:if(!e.Z.ZY())return y.return([]);B=[];g.kN(y,2);return g.l(y,g4G(a,r,P),4);case 4:B=y.S;g.Dl(y,3);break;case 2:h=g.Q3(y),h instanceof Error&&h.message==="No data"||h instanceof Error&&h.message==="Empty response body"&&Bq(h.message);case 3:return c=enw(e,B,r,"mainPlaylistEntity"),y.return(c)}})},Jaw=function(e,a,r,P){P=P===void 0?!1:P;
var B,h,c,y,T,X,f,A,U,C,G,O,d,W,V;return g.Y(function(L){switch(L.T){case 1:return B=[],g.l(L,ZXN(),2);case 2:return(h=L.S)||P?g.l(L,kkG(a,r),3):L.return([]);case 3:c=L.S;if((y=c)==null||!y.length)return L.return([]);T={offlineDeleteReason:"OFFLINE_DELETE_REASON_PARENT_LIST_REFRESH"};X=g.Z(c);f=X.next();case 4:if(f.done){L.Oo(6);break}U=A=f.value;C=U.actionType;G=U.entityKey;O=U.actionMetadata;if(!(C&&G&&O)||g.H(O,ZGB)){L.Oo(5);break}C==="OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE"&&(O.offlineLoggingData=
T);d=g.sV(G);W=d.entityId;return g.l(L,mB(e,[W],"mainVideoEntity",C,O),8);case 8:V=L.S,B=B.concat(V);case 5:f=X.next();L.Oo(4);break;case 6:return L.return(B)}})},DAB=function(e,a){this.S=e;
this.B=a},$A5=function(e,a){var r,P,B,h,c,y,T,X,f,A,U,C,G,O,d,W;
return g.Y(function(V){switch(V.T){case 1:return r=Tf(a),P=g.sV(a.entityKey),B=P.entityId,h=[],g.kN(V,2),g.l(V,VX9(e,B),4);case 4:h=V.S;if((c=h)==null||!c.length){V.Oo(5);break}return g.l(V,fnG(e.S,a.entityKey),5);case 5:g.Dl(V,3);break;case 2:return y=g.Q3(V),T="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",X="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",y instanceof g.XX&&y.type==="QUOTA_EXCEEDED"&&(T="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",X="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),
V.return(new wB("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",r,void 0,T,X));case 3:return f=[],g.l(V,R3V(e.S,"musicTrack",h),7);case 7:h=V.S;if(h.length)for(A=g.Z(h),U=A.next();!U.done;U=A.next())if(C=U.value,G=C.offlineVideoData,O=void 0,(O=G)==null?0:O.videoId)d=void 0,W=Number(((d=a.actionMetadata)==null?void 0:d.priority)||0)+1,f.push(Yo("OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",G.videoId,"musicTrack",W,j4,QS(a,G,B)));return V.return(new wB("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",r,f))}})},
QMa=function(e,a){var r,P,B,h,c,y,T,X,f,A,U,C,G,O,d,W,V,L,z,q,M,m,cI,CL,nL,y3,aT,$N,F4,ea,EG,n5,lq,cd,iN,vB,oQ,Q,IQ,L5,PI,Jw,k,r4,Lf,nD,IZ,sO,rb,aD,Hd,J,t,D,w,I,fL,R,K;
return g.Y(function(p){switch(p.T){case 1:return r=Tf(a),P=a.entityKey,B=g.sV(P).entityId,h=[],c=!1,B==="!*$_ALL_ENTITIES_!*$"?(c=!0,g.l(p,Kb(e.S,"musicAlbumRelease"),5)):g.l(p,um(e.S,P,"musicAlbumRelease"),4);case 4:(y=p.S)&&h.push(y);p.Oo(3);break;case 5:h=p.S;case 3:if((T=h)==null||!T.length)return p.return(new wB("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",r));if(c){X=[];f=g.Z(h);for(A=f.next();!A.done;A=f.next())U=A.value,C=g.sV(U.id).entityId,X.push(Yo("OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH",
C,"musicAlbumRelease",0,j4));return p.return(new wB("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",r,X))}G=[];O=h[0];d=void 0;if(!O.downloadMetadata){p.Oo(6);break}return g.l(p,um(e.S,O.downloadMetadata,"musicAlbumReleaseDownloadMetadataEntity"),7);case 7:W=p.S,d=Number((L=(V=W)==null?void 0:V.addedTimestampMillis)!=null?L:"0")/1E3;case 6:return g.kN(p,8),g.l(p,VX9(e,B,(z=d)==null?void 0:z.toString()),10);case 10:G=p.S;g.Dl(p,9);break;case 8:q=g.Q3(p);if(!(q instanceof Error&&q.message==="No data")){if(q instanceof
Error&&q.message==="Empty response body")Bq(q.message);else return M="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",m="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",q instanceof g.XX&&q.type==="QUOTA_EXCEEDED"&&(M="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",m="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),p.return(new wB("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",r,void 0,M,m));p.Oo(9);break}return g.l(p,VS(B,"musicAlbumRelease",e.S,a,e.B),9);case 9:cI=[];CL=new Map;
if((nL=G)==null?0:nL.length)for(y3=g.Z(G),aT=y3.next();!aT.done;aT=y3.next())$N=aT.value,F4=$N.offlineVideoData,ea=void 0,((ea=F4)==null?0:ea.videoId)&&CL.set(F4.videoId,F4);EG=new Map;n5=[];if((lq=O)==null?0:(cd=lq.tracks)==null?0:cd.length)for(iN=g.Z(O.tracks),vB=iN.next();!vB.done;vB=iN.next())if(oQ=vB.value,Q=g.sV(oQ).entityId)CL.has(Q)?(EG.set(Q,CL.get(Q)),CL.delete(Q)):n5.push(Q);L5=Number(((IQ=a.actionMetadata)==null?void 0:IQ.priority)||0)+1;PI=g.Z(CL.entries());for(Jw=PI.next();!Jw.done;Jw=
PI.next())k=Jw.value,r4=g.Z(k),Lf=r4.next().value,nD=r4.next().value,IZ=Lf,sO=nD,cI.push(Yo("OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",IZ,"musicTrack",L5,j4,QS(a,sO)));rb=g.Z(EG.entries());for(aD=rb.next();!aD.done;aD=rb.next())Hd=aD.value,J=g.Z(Hd),t=J.next().value,D=J.next().value,w=t,I=D,cI.push(Yo("OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH",w,"musicTrack",L5,j4,QS(a,I)));fL=g.Z(n5);for(R=fL.next();!R.done;R=fL.next())K=R.value,cI.push(Yo("OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE",K,"musicTrack",
0,j4));return p.return(new wB("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",r,cI))}})},WVb=function(e,a){var r,P;
return g.Y(function(B){switch(B.T){case 1:return r=Tf(a),g.kN(B,2),P=g.sV(a.entityKey).entityId,P==="!*$_ALL_ENTITIES_!*$"?g.l(B,$o(e.S,a,e.B),5):g.l(B,VS(P,"musicAlbumRelease",e.S,a,e.B),6);case 6:return g.l(B,AnG(e.S,a.entityKey),5);case 5:g.Dl(B,3);break;case 2:return g.Q3(B),B.return(new wB("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",r,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 3:return B.return(new wB("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
r))}})},VX9=function(e,a,r){var P,B,h;
return g.Y(function(c){switch(c.T){case 1:return g.l(c,bX5([a]),2);case 2:return P=c.S,g.l(c,ljN(e,P[0],r),3);case 3:return B=c.S,h=E6(B.thumbnailDetails),g.l(c,O6(h),4);case 4:return c.return(P[0].videos)}})},ljN=function(e,a,r){var P,B,h,c,y,T,X,f,A,U,C,G,O,d;
return g.Y(function(W){if(W.T==1){P=a.additionalMetadadatas;B=void 0;if(P&&P.length>0)for(h=g.Z(P),c=h.next();!c.done;c=h.next())if(y=c.value,y.offlineMusicPlaylistData){B=y.offlineMusicPlaylistData;break}T=a.playlistId;X=UeG(a);f=X.f$;A=X.zq;U=r?(Number(r)*1E3).toString():Date.now().toString();C=a.lastModifiedTimestamp?(Number(a.lastModifiedTimestamp)*1E3).toString():"0";G={id:g.mf(T,"musicAlbumReleaseDownloadMetadataEntity"),trackDownloadMetadatas:A,lastModifiedTimestampMillis:C,addedTimestampMillis:U,
syncState:"DOWNLOAD_SYNC_STATE_UP_TO_DATE"};O={id:g.mf(T,"musicAlbumRelease"),title:a.title,audioPlaylistId:T,trackCount:a.totalVideoCount,tracks:f,downloadMetadata:G.id};B&&(O.thumbnailDetails=(d=B.albumHqThumbnail)!=null?d:B.albumArtistThumbnail,O.artistDisplayName=B.albumArtistDisplayName,O.releaseDate=B.albumReleaseDate,O.contentRating={explicitType:B.albumReleaseExplicitType},O.releaseType=B.albumReleaseType);return g.l(W,MF(e.S,{mode:"readwrite",DD:!0},function(V){var L=Sx(V,O,"musicAlbumRelease");
V=Sx(V,G,"musicAlbumReleaseDownloadMetadataEntity");return g.bk.all([L,V])}),2)}return W.return(O)})},LVN=function(e,a){this.S=e;
this.B=a},wVB=function(e,a){var r,P,B,h,c,y,T,X,f,A,U,C,G,O,d,W;
return g.Y(function(V){switch(V.T){case 1:return r=Tf(a),P=g.sV(a.entityKey),B=P.entityId,h=[],g.kN(V,2),g.l(V,Y7M(e,B),4);case 4:h=V.S;if((c=h)==null||!c.length){V.Oo(5);break}return g.l(V,fnG(e.S,a.entityKey),5);case 5:g.Dl(V,3);break;case 2:return y=g.Q3(V),T="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",X="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",y instanceof g.XX&&y.type==="QUOTA_EXCEEDED"&&(T="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",X="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),
V.return(new wB("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",r,void 0,T,X));case 3:return f=[],g.l(V,R3V(e.S,"musicTrack",h),7);case 7:h=V.S;if(h.length)for(A=g.Z(h),U=A.next();!U.done;U=A.next())if(C=U.value,G=C.offlineVideoData,O=void 0,(O=G)==null?0:O.videoId)d=void 0,W=Number(((d=a.actionMetadata)==null?void 0:d.priority)||0)+1,f.push(Yo("OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",G.videoId,"musicTrack",W,uM,QS(a,G,B)));return V.return(new wB("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",r,f))}})},
pV8=function(e,a){var r,P,B,h,c,y,T,X,f,A,U,C,G,O,d,W,V,L,z,q,M,m,cI,CL,nL,y3,aT,$N,F4,ea,EG,n5,lq,cd,iN,vB,oQ,Q,IQ,L5,PI,Jw,k,r4,Lf,nD,IZ,sO,rb,aD,Hd,J,t,D,w,I,fL,R,K,p,w4,qj,oT,XN,LL,Jz,ry,db,zV,V3,kH;
return g.Y(function(WI){switch(WI.T){case 1:return r=Tf(a),P=a.entityKey,B=g.sV(P).entityId,h=[],c=!1,B==="!*$_ALL_ENTITIES_!*$"?(c=!0,g.l(WI,Kb(e.S,"musicPlaylist"),5)):g.l(WI,um(e.S,P,"musicPlaylist"),4);case 4:(y=WI.S)&&h.push(y);WI.Oo(3);break;case 5:h=WI.S;case 3:if((T=h)==null||!T.length)return WI.return(new wB("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",r));X=g.H(a.actionMetadata,C9N);A=(f=X)==null?void 0:f.autoSync;U=[];G=C=!0;O=!1;d=void 0;if(!c&&A===!1){WI.Oo(6);break}g.kN(WI,7);return g.l(WI,
deN(0,!!A,!0,h),9);case 9:U=WI.S;g.Dl(WI,8);break;case 7:W=g.Q3(WI);if(!(W instanceof Error&&W.message==="No data")){W instanceof Error&&W.message==="Empty response body"&&Bq(W.message);WI.Oo(8);break}return B==="!*$_ALL_ENTITIES_!*$"?g.l(WI,$o(e.S,a,e.B),8):g.l(WI,VS(B,"musicPlaylist",e.S,a,e.B),8);case 8:if(!U.length||!c&&U[0].playlistId!==B)return WI.return(new wB("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",r));case 6:if(c){V=[];L=g.Z(U);for(z=L.next();!z.done;z=L.next())q=z.value,q.upToDate||
A&&!q.shouldAutoSyncMetadata||!q.playlistId||(M={autoSync:A},V.push(Yo("OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH",q.playlistId,"musicPlaylist",0,uM,{musicPlaylistEntityActionMetadata:M})));return WI.return(new wB("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",r,V))}U.length&&(m=U[0],O=!!m.upToDate,A&&(C=(cI=m.shouldAutoSyncMetadata)!=null?cI:!0,G=(CL=m.shouldAutoSyncVideos)!=null?CL:!0,m.checkInSeconds&&(d=m.checkInSeconds)));if(O||!C)return WI.return(new wB("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
r));nL=[];y3=h[0];aT=void 0;if(!y3.downloadMetadata){WI.Oo(15);break}return g.l(WI,um(e.S,y3.downloadMetadata,"musicPlaylistDownloadMetadataEntity"),16);case 16:$N=WI.S,aT=Number((ea=(F4=$N)==null?void 0:F4.addedTimestampMillis)!=null?ea:"0")/1E3;case 15:return g.kN(WI,17),g.l(WI,Y7M(e,B,(EG=aT)==null?void 0:EG.toString(),d),19);case 19:nL=WI.S;g.Dl(WI,18);break;case 17:n5=g.Q3(WI);if(!(n5 instanceof Error&&n5.message==="No data")){if(n5 instanceof Error&&n5.message==="Empty response body")Bq(n5.message);
else return lq="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",cd="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",n5 instanceof g.XX&&n5.type==="QUOTA_EXCEEDED"&&(lq="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",cd="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),WI.return(new wB("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",r,void 0,lq,cd));WI.Oo(18);break}return g.l(WI,VS(B,"musicPlaylist",e.S,a,e.B),18);case 18:if(!G)return WI.return(new wB("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
r));iN=[];vB=new Map;if((oQ=nL)==null?0:oQ.length)for(Q=g.Z(nL),IQ=Q.next();!IQ.done;IQ=Q.next())L5=IQ.value,PI=L5.offlineVideoData,Jw=void 0,((Jw=PI)==null?0:Jw.videoId)&&vB.set(PI.videoId,PI);k=new Map;r4=[];if((Lf=y3)==null?0:(nD=Lf.tracks)==null?0:nD.length)for(IZ=g.Z(y3.tracks),sO=IZ.next();!sO.done;sO=IZ.next())if(rb=sO.value,aD=g.sV(rb).entityId)vB.has(aD)?(k.set(aD,vB.get(aD)),vB.delete(aD)):r4.push(aD);J=Number(((Hd=a.actionMetadata)==null?void 0:Hd.priority)||0)+1;t=g.Z(vB.entries());for(D=
t.next();!D.done;D=t.next())w=D.value,I=g.Z(w),fL=I.next().value,R=I.next().value,K=fL,p=R,iN.push(Yo("OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",K,"musicTrack",J,uM,QS(a,p)));w4=g.Z(k.entries());for(qj=w4.next();!qj.done;qj=w4.next())oT=qj.value,XN=g.Z(oT),LL=XN.next().value,Jz=XN.next().value,ry=LL,db=Jz,iN.push(Yo("OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH",ry,"musicTrack",J,uM,QS(a,db)));zV=g.Z(r4);for(V3=zV.next();!V3.done;V3=zV.next())kH=V3.value,iN.push(Yo("OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE",
kH,"musicTrack",0,uM));return WI.return(new wB("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",r,iN))}})},iGG=function(e,a){var r,P;
return g.Y(function(B){switch(B.T){case 1:return r=Tf(a),g.kN(B,2),P=g.sV(a.entityKey).entityId,P==="!*$_ALL_ENTITIES_!*$"?g.l(B,$o(e.S,a,e.B),5):g.l(B,VS(P,"musicPlaylist",e.S,a,e.B),6);case 6:return g.l(B,AnG(e.S,a.entityKey),5);case 5:g.Dl(B,3);break;case 2:return g.Q3(B),B.return(new wB("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",r,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 3:return B.return(new wB("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
r))}})},Y7M=function(e,a,r,P){var B,h,c;
return g.Y(function(y){switch(y.T){case 1:return g.l(y,bX5([a]),2);case 2:return B=y.S,g.l(y,zn5(e,B[0],r,P),3);case 3:return h=y.S,c=E6(h.thumbnailDetails),g.l(y,O6(c),4);case 4:return y.return(B[0].videos)}})},zn5=function(e,a,r,P){var B,h,c,y,T,X,f,A,U;
return g.Y(function(C){return C.T==1?(B=a.playlistId,h=UeG(a),c=h.f$,y=h.zq,T=r?(Number(r)*1E3).toString():Date.now().toString(),X=a.lastModifiedTimestamp?(Number(a.lastModifiedTimestamp)*1E3).toString():"0",f={id:g.mf(B,"musicPlaylistDownloadMetadataEntity"),trackDownloadMetadatas:y,lastModifiedTimestampMillis:X,addedTimestampMillis:T,syncState:"DOWNLOAD_SYNC_STATE_UP_TO_DATE"},A={id:g.mf(B,"musicPlaylist"),title:a.title,playlistId:B,thumbnailDetails:a.thumbnail,visibility:NMa(a),trackCount:a.totalVideoCount,
tracks:c,downloadMetadata:f.id},P&&(((U=A)==null?0:U.entityMetadata)?A.entityMetadata.nextAutoRefreshIntervalSeconds=String(P):A&&(A.entityMetadata={nextAutoRefreshIntervalSeconds:String(P)})),g.l(C,MF(e.S,{mode:"readwrite",DD:!0},function(G){var O=Sx(G,A,"musicPlaylist");G=Sx(G,f,"musicPlaylistDownloadMetadataEntity");return g.bk.all([O,G])}),2)):C.return(A)})},NMa=function(e){switch(e.privacy){case "PRIVATE":return"PLAYLIST_ENTITY_VISIBILITY_PRIVATE";
case "PUBLIC":return"PLAYLIST_ENTITY_VISIBILITY_PUBLIC";case "UNLISTED":return"PLAYLIST_ENTITY_VISIBILITY_UNLISTED";default:return"PLAYLIST_ENTITY_VISIBILITY_UNKNOWN"}},xAw=function(e,a){this.S=e;
this.B=a},vmw=function(e,a){var r,P,B,h,c,y,T,X,f,A,U,C,G;
return g.Y(function(O){switch(O.T){case 1:return r=Tf(a),P=g.sV(a.entityKey),B=P.entityId,h=g.H(a.actionMetadata,Ijw),g.kN(O,2),g.l(O,HG5(e,B,void 0,(c=h)==null?void 0:c.track,(y=h)==null?void 0:y.albumRelease),4);case 4:if((T=h)==null?0:T.playlistId){O.Oo(5);break}return g.l(O,fnG(e.S,a.entityKey),5);case 5:g.Dl(O,3);break;case 2:return X=g.Q3(O),f="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",A="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",X instanceof g.XX&&X.type==="QUOTA_EXCEEDED"&&
(f="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",A="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),O.return(new wB("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",r,void 0,f,A));case 3:C=Number(((U=a.actionMetadata)==null?void 0:U.priority)||0)+1;var d=(d=g.H(a.actionMetadata,Ijw))?{playbackDataActionMetadata:{maximumDownloadQuality:d.maximumDownloadQuality}}:void 0;G=Yo("OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",B,"playbackData",C,q7V,d);return O.return(new wB("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
r,[G]))}})},Rnw=function(e,a){var r,P,B,h,c,y,T,X,f,A,U,C,G,O,d;
return g.Y(function(W){switch(W.T){case 1:return r=Tf(a),P=g.sV(a.entityKey),B=P.entityId,g.l(W,um(e.S,a.entityKey,"musicTrack"),2);case 2:h=W.S;if(!h){c=void 0;W.Oo(3);break}return g.l(W,um(e.S,h.downloadMetadata,"musicTrackDownloadMetadataEntity"),4);case 4:c=W.S;case 3:y=c;if(!h||!y)return W.return(new wB("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",r));X=g.H(a.actionMetadata,Ijw);g.kN(W,5);return g.l(W,HG5(e,B,y.addedTimestampMillis,(f=X)==null?void 0:f.track,(A=X)==null?void 0:A.albumRelease),
7);case 7:C=Number(((U=a.actionMetadata)==null?void 0:U.priority)||0)+1;T=Yo("OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH",B,"playbackData",C,q7V);g.Dl(W,6);break;case 5:G=g.Q3(W);if(!(G instanceof Error&&G.message==="No data")){if(G instanceof Error&&G.message==="Empty response body")Bq(G.message);else return O="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",d="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",G instanceof g.XX&&G.type==="QUOTA_EXCEEDED"&&(O="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",
d="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),W.return(new wB("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",r,void 0,O,d));W.Oo(6);break}return g.l(W,Dr(B,e.S,a,e.B),6);case 6:return W.return(new wB("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",r,T?[T]:void 0))}})},S7G=function(e,a){var r,P;
return g.Y(function(B){switch(B.T){case 1:return r=Tf(a),g.kN(B,2),P=g.sV(a.entityKey).entityId,P==="!*$_ALL_ENTITIES_!*$"?g.l(B,$o(e.S,a,e.B),5):g.l(B,Dr(P,e.S,a,e.B),6);case 6:return g.l(B,AnG(e.S,a.entityKey),5);case 5:g.Dl(B,3);break;case 2:return g.Q3(B),B.return(new wB("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",r,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 3:return B.return(new wB("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
r))}})},HG5=function(e,a,r,P,B){var h,c,y,T,X,f;
return g.Y(function(A){switch(A.T){case 1:if(h=P){A.Oo(2);break}return g.l(A,E4V([a]),3);case 3:c=A.S,y=c[0],h=XPw(y);case 2:return g.l(A,sM9(e,h,a,B,r),4);case 4:T=A.S;X=T.musicTrackEntity;f=T.gm;var U=E6(X.thumbnailDetails),C=[];f&&(C=E6(f.thumbnailDetails));return g.l(A,O6(U.concat(C)),0)}})},sM9=function(e,a,r,P,B){var h;
return g.Y(function(c){return c.T==1?(B||(B=Date.now().toString()),h={id:g.mf(r,"musicTrackDownloadMetadataEntity"),playbackData:g.mf(r,"playbackData"),addedTimestampMillis:B,videoDownloadContextEntity:g.mf(r,"videoDownloadContextEntity")},P&&(a.albumRelease=P.id),g.l(c,MF(e.S,{mode:"readwrite",DD:!0},function(y){var T=[],X=Sx(y,h,"musicTrackDownloadMetadataEntity");T.push(X);X=Sx(y,a,"musicTrack");T.push(X);P&&(y=Sx(y,P,"musicAlbumRelease"),T.push(y));return g.bk.all(T)}),2)):c.T!=3?g.l(c,U6(r,"musicTrackDownloadMetadataEntity",
e.S,"DOWNLOAD_STATE_PENDING_DOWNLOAD"),3):c.return({musicTrackEntity:a,
gm:P})})},KM=function(){s6.apply(this,arguments);
this.N="musicTrack"},mAl=function(e,a,r){a=a===void 0?43200:a;
r=r===void 0?!0:r;var P=P===void 0?!1:P;var B,h;return g.Y(function(c){switch(c.T){case 1:if(!e.Z.ZY())return c.return([]);B=[];g.kN(c,2);return g.l(c,deN(a,r,P),4);case 4:B=c.S;g.Dl(c,3);break;case 2:g.Q3(c);case 3:return h=enw(e,B,r,"musicPlaylist"),c.return(h)}})},FVa=function(){g.Vn.apply(this,arguments);
var e=this;this.events=new g.Zc(this);this.iW=this.player.G();this.Ob={Li1:function(){return e.S},
tQ:function(){return e.tQ()},
Ct:function(a){return e.Ct(a)}}},MXl=function(e){var a;
e=g.H((a=e.getWatchNextResponse())==null?void 0:a.currentVideoEndpoint,g.g3);if(e==null?0:e.playlistId)var r=e.playlistId;return r},jMN=function(e,a){var r,P,B,h;
return g.Y(function(c){if(c.T==1){r=a.clientPlaybackNonce;P={cpn:r,offlineSourceVisualElement:g.C4(a.e1||"").getAsJson(),selectedOfflineMode:"OFFLINE_NOW",isPartialPlayback:!1};a.T&&(P.videoFmt=Number(a.T.itag));a.L&&(P.audioFmt=Number(a.L.itag));if((B=MXl(a))&&a.videoId){var y=a.videoId;y=B!=="PPSV"?Promise.resolve(!1):e.S.Ut(y);c=g.l(c,y,3)}else c=c.Oo(2);return c}c.T!=2&&(h=c.S)&&(P.selectedOfflineMode="OFFLINE_MODE_TYPE_AUTO_OFFLINE");e.T=r;g.BU("offlinePlaybackStarted",P);g.OO(c)})};
g.Hx.prototype.A8=g.BI(45,function(e){return this.app.A8(e)});
g.gZ.prototype.A8=g.BI(44,function(e){return g.P$T(this,9,e)});
g.b(zv,im);g.hz.Object.defineProperties(zv.prototype,{entityMetadata:{configurable:!0,enumerable:!0,get:function(){return this.S.entityMetadata},
set:function(e){this.S.entityMetadata=e}}});
g.b(x1a,zv);x1a.prototype.T=function(){return[]};
g.b(Isb,zv);Isb.prototype.T=function(){return[]};
g.b(HrG,zv);HrG.prototype.T=function(){return[]};
g.b(qw5,zv);qw5.prototype.T=function(){return[]};
g.b(vcl,zv);vcl.prototype.T=function(){return[]};
g.b(RF8,zv);RF8.prototype.T=function(){var e=[];this.S.alternateChannel&&e.push(this.S.alternateChannel);this.S.alternateChannelList&&e.push.apply(e,g.UO(this.S.alternateChannelList));this.S.oneofChannelEntity&&e.push(this.S.oneofChannelEntity);return[].concat(g.UO(new Set(e)))};
g.b(SwN,zv);SwN.prototype.T=function(){var e=[];this.S.entryCollection&&e.push(this.S.entryCollection);return[].concat(g.UO(new Set(e)))};
g.b(s5a,im);s5a.prototype.T=function(){var e=[];this.S.video&&e.push(this.S.video);return[].concat(g.UO(new Set(e)))};
g.b(m1a,zv);m1a.prototype.T=function(){var e=[];this.S.parentPlaylist&&e.push(this.S.parentPlaylist);if(this.S.entries)for(var a=g.Z(this.S.entries),r=a.next();!r.done;r=a.next())e.push.apply(e,g.UO((new s5a(r.value)).T()));return[].concat(g.UO(new Set(e)))};
g.b(FS9,zv);FS9.prototype.T=function(){var e=[];this.S.descriptionEntity&&e.push(this.S.descriptionEntity);this.S.creators&&e.push.apply(e,g.UO(this.S.creators));this.S.theBiggestFan&&e.push(this.S.theBiggestFan);return[].concat(g.UO(new Set(e)))};
g.b(MOM,zv);MOM.prototype.T=function(){return[]};
g.b(j5M,zv);j5M.prototype.T=function(){return[]};
g.b(uEG,zv);uEG.prototype.T=function(){return[]};
g.b(KSB,zv);KSB.prototype.T=function(){return[]};
g.b(ecG,zv);ecG.prototype.T=function(){return[]};
g.b(aOB,zv);aOB.prototype.T=function(){return[]};
g.b(rSN,zv);rSN.prototype.T=function(){return[]};
g.b(Pba,zv);Pba.prototype.T=function(){return[]};
g.b(B9V,zv);B9V.prototype.T=function(){return[]};
g.b(hcV,zv);hcV.prototype.T=function(){var e=[];this.S.downloadsList&&e.push(this.S.downloadsList);this.S.smartDownloadsList&&e.push(this.S.smartDownloadsList);this.S.recommendedDownloadsList&&e.push(this.S.recommendedDownloadsList);this.S.refresh&&e.push(this.S.refresh);return[].concat(g.UO(new Set(e)))};
g.b(cS9,im);cS9.prototype.T=function(){var e=[];this.S.video&&e.push(this.S.video);this.S.playlist&&e.push(this.S.playlist);this.S.videoItem&&e.push(this.S.videoItem);this.S.playlistItem&&e.push(this.S.playlistItem);return[].concat(g.UO(new Set(e)))};
g.b(oqB,zv);oqB.prototype.T=function(){var e=[];this.S.refresh&&e.push(this.S.refresh);if(this.S.downloads)for(var a=g.Z(this.S.downloads),r=a.next();!r.done;r=a.next())e.push.apply(e,g.UO((new cS9(r.value)).T()));return[].concat(g.UO(new Set(e)))};
g.b(nq8,zv);nq8.prototype.T=function(){var e=[];this.S.localImageEntities&&e.push.apply(e,g.UO(this.S.localImageEntities));return[].concat(g.UO(new Set(e)))};
g.b(ySN,zv);ySN.prototype.T=function(){var e=[];this.S.playbackData&&e.push(this.S.playbackData);this.S.localImageEntities&&e.push.apply(e,g.UO(this.S.localImageEntities));this.S.videoDownloadContextEntity&&e.push(this.S.videoDownloadContextEntity);return[].concat(g.UO(new Set(e)))};
g.b(T9G,zv);T9G.prototype.T=function(){return[]};
g.b(X1M,zv);X1M.prototype.T=function(){var e=[];this.S.fakeChildren&&e.push.apply(e,g.UO(this.S.fakeChildren));return[].concat(g.UO(new Set(e)))};
g.b(fO9,zv);fO9.prototype.T=function(){var e=[];this.S.video&&e.push(this.S.video);this.S.playbackData&&e.push(this.S.playbackData);this.S.offlineVideoPolicy&&e.push(this.S.offlineVideoPolicy);return[].concat(g.UO(new Set(e)))};
g.b(ASN,zv);ASN.prototype.T=function(){return[]};
g.b(Uqw,zv);Uqw.prototype.T=function(){var e=[];this.S.channelOwner&&e.push(this.S.channelOwner);this.S.videos&&e.push.apply(e,g.UO(this.S.videos));this.S.collaboratorChannels&&e.push.apply(e,g.UO(this.S.collaboratorChannels));this.S.downloadState&&e.push(this.S.downloadState);this.S.refresh&&e.push(this.S.refresh);return[].concat(g.UO(new Set(e)))};
g.b(Cb5,zv);Cb5.prototype.T=function(){var e=[];this.S.video&&e.push(this.S.video);this.S.channelContributor&&e.push(this.S.channelContributor);return[].concat(g.UO(new Set(e)))};
g.b(GpV,im);GpV.prototype.T=function(){var e=[];this.S.localImageEntities&&e.push.apply(e,g.UO(this.S.localImageEntities));this.S.videoDownloadContextEntity&&e.push(this.S.videoDownloadContextEntity);return[].concat(g.UO(new Set(e)))};
g.b(EqN,im);EqN.prototype.T=function(){var e=[];this.S.recommendedVideoMetadata&&e.push.apply(e,g.UO((new GpV(this.S.recommendedVideoMetadata)).T()));return[].concat(g.UO(new Set(e)))};
g.b(beb,im);beb.prototype.T=function(){var e=[];this.S.playbackPosition&&e.push(this.S.playbackPosition);return[].concat(g.UO(new Set(e)))};
g.b(tkB,zv);tkB.prototype.T=function(){var e=[];this.S.owner&&e.push(this.S.owner);this.S.downloadState&&e.push(this.S.downloadState);this.S.userState&&e.push.apply(e,g.UO((new beb(this.S.userState)).T()));this.S.additionalMetadata&&e.push.apply(e,g.UO((new EqN(this.S.additionalMetadata)).T()));return[].concat(g.UO(new Set(e)))};
g.b(gqB,zv);gqB.prototype.T=function(){var e=[];this.S.userChannelDetails&&e.push(this.S.userChannelDetails);return[].concat(g.UO(new Set(e)))};
g.b(ZeG,zv);ZeG.prototype.T=function(){var e=[];this.S.channelOwner&&e.push(this.S.channelOwner);this.S.playbackPosition&&e.push(this.S.playbackPosition);this.S.localImageEntities&&e.push.apply(e,g.UO(this.S.localImageEntities));this.S.downloadStatus&&e.push(this.S.downloadStatus);return[].concat(g.UO(new Set(e)))};
g.b(OeM,zv);OeM.prototype.T=function(){return[]};
g.b(kpM,zv);kpM.prototype.T=function(){return[]};
g.b(dq5,zv);dq5.prototype.T=function(){return[]};
g.b(JSb,zv);JSb.prototype.T=function(){return[]};
g.b(DqZ,zv);DqZ.prototype.T=function(){return[]};
g.b(VkG,zv);VkG.prototype.T=function(){return[]};
g.b($qa,zv);$qa.prototype.T=function(){return[]};
g.b(Qsl,zv);Qsl.prototype.T=function(){return[]};
g.b(WeB,zv);WeB.prototype.T=function(){return[]};
g.b(lO8,zv);lO8.prototype.T=function(){return[]};
g.b(Lea,zv);Lea.prototype.T=function(){return[]};
g.b(Yew,zv);Yew.prototype.T=function(){return[]};
g.b(w1l,zv);w1l.prototype.T=function(){var e=[];this.S.trackDownloadMetadatas&&e.push.apply(e,g.UO(this.S.trackDownloadMetadatas));return[].concat(g.UO(new Set(e)))};
g.b(p1M,zv);
p1M.prototype.T=function(){var e=[];this.S.downloadedTracks&&e.push.apply(e,g.UO(this.S.downloadedTracks));this.S.smartDownloadedTracks&&e.push.apply(e,g.UO(this.S.smartDownloadedTracks));this.S.downloadedEpisodes&&e.push.apply(e,g.UO(this.S.downloadedEpisodes));this.S.downloadedAlbumReleases&&e.push.apply(e,g.UO(this.S.downloadedAlbumReleases));this.S.smartDownloadedAlbumReleases&&e.push.apply(e,g.UO(this.S.smartDownloadedAlbumReleases));this.S.downloadedPlaylists&&e.push.apply(e,g.UO(this.S.downloadedPlaylists));this.S.smartDownloadedPlaylists&&
e.push.apply(e,g.UO(this.S.smartDownloadedPlaylists));this.S.metadataOnlyTracks&&e.push.apply(e,g.UO(this.S.metadataOnlyTracks));return[].concat(g.UO(new Set(e)))};
g.b(ieM,zv);ieM.prototype.T=function(){var e=[];this.S.trackDownloadMetadatas&&e.push.apply(e,g.UO(this.S.trackDownloadMetadatas));return[].concat(g.UO(new Set(e)))};
g.b(zc8,zv);zc8.prototype.T=function(){var e=[];this.S.playbackData&&e.push(this.S.playbackData);this.S.localImageEntities&&e.push.apply(e,g.UO(this.S.localImageEntities));this.S.videoDownloadContextEntity&&e.push(this.S.videoDownloadContextEntity);return[].concat(g.UO(new Set(e)))};
g.b(N9Z,zv);N9Z.prototype.T=function(){var e=[];this.S.musicLibraryStatusEntity&&e.push(this.S.musicLibraryStatusEntity);this.S.primaryArtists&&e.push.apply(e,g.UO(this.S.primaryArtists));this.S.details&&e.push(this.S.details);this.S.userDetails&&e.push(this.S.userDetails);this.S.tracks&&e.push.apply(e,g.UO(this.S.tracks));this.S.share&&e.push(this.S.share);this.S.downloadMetadata&&e.push(this.S.downloadMetadata);this.S.refresh&&e.push(this.S.refresh);return[].concat(g.UO(new Set(e)))};
g.b(xqw,zv);xqw.prototype.T=function(){var e=[];this.S.albumRelease&&e.push(this.S.albumRelease);this.S.tracks&&e.push.apply(e,g.UO(this.S.tracks));return[].concat(g.UO(new Set(e)))};
g.b(IOG,zv);IOG.prototype.T=function(){var e=[];this.S.albumRelease&&e.push(this.S.albumRelease);return[].concat(g.UO(new Set(e)))};
g.b(Hea,zv);Hea.prototype.T=function(){var e=[];this.S.details&&e.push(this.S.details);this.S.userDetails&&e.push(this.S.userDetails);return[].concat(g.UO(new Set(e)))};
g.b(qeM,zv);qeM.prototype.T=function(){var e=[];this.S.parentArtist&&e.push(this.S.parentArtist);return[].concat(g.UO(new Set(e)))};
g.b(vq5,zv);vq5.prototype.T=function(){var e=[];this.S.parentArtist&&e.push(this.S.parentArtist);return[].concat(g.UO(new Set(e)))};
g.b(Rcw,zv);Rcw.prototype.T=function(){return[]};
g.b(SeB,zv);SeB.prototype.T=function(){return[]};
g.b(ssZ,im);ssZ.prototype.T=function(){var e=[];this.S.creatorEntity&&e.push(this.S.creatorEntity);return[].concat(g.UO(new Set(e)))};
g.b(mq9,zv);
mq9.prototype.T=function(){var e=[];this.S.tracks&&e.push.apply(e,g.UO(this.S.tracks));this.S.refresh&&e.push(this.S.refresh);this.S.musicLibraryStatusEntity&&e.push(this.S.musicLibraryStatusEntity);this.S.details&&e.push(this.S.details);this.S.downloadMetadata&&e.push(this.S.downloadMetadata);this.S.sideloadMetadata&&e.push(this.S.sideloadMetadata);this.S.userDetails&&e.push(this.S.userDetails);this.S.entryCollection&&e.push(this.S.entryCollection);this.S.share&&e.push(this.S.share);this.S.podcastShowAdditionalMetadata&&
e.push.apply(e,g.UO((new ssZ(this.S.podcastShowAdditionalMetadata)).T()));return[].concat(g.UO(new Set(e)))};
g.b(FeN,zv);FeN.prototype.T=function(){return[]};
g.b(Mk8,zv);
Mk8.prototype.T=function(){var e=[];this.S.musicLibraryStatusEntity&&e.push(this.S.musicLibraryStatusEntity);this.S.artists&&e.push.apply(e,g.UO(this.S.artists));this.S.audioModeVersion&&e.push(this.S.audioModeVersion);this.S.videoModeVersion&&e.push(this.S.videoModeVersion);this.S.userDetails&&e.push(this.S.userDetails);this.S.details&&e.push(this.S.details);this.S.albumRelease&&e.push(this.S.albumRelease);this.S.share&&e.push(this.S.share);this.S.libraryEdit&&e.push(this.S.libraryEdit);this.S.downloadMetadata&&
e.push(this.S.downloadMetadata);this.S.playbackPosition&&e.push(this.S.playbackPosition);this.S.lyrics&&e.push(this.S.lyrics);return[].concat(g.UO(new Set(e)))};
g.b(jsB,zv);jsB.prototype.T=function(){var e=[];this.S.parentTrack&&e.push(this.S.parentTrack);return[].concat(g.UO(new Set(e)))};
g.b(ut9,zv);ut9.prototype.T=function(){var e=[];this.S.parentTrack&&e.push(this.S.parentTrack);return[].concat(g.UO(new Set(e)))};
g.b(KeZ,zv);KeZ.prototype.T=function(){return[]};
g.b(ew5,zv);ew5.prototype.T=function(){return[]};
g.b(aNB,zv);aNB.prototype.T=function(){return[]};
g.b(rPN,zv);rPN.prototype.T=function(){return[]};
g.b(PE5,zv);PE5.prototype.T=function(){var e=[];this.S.transfer&&e.push(this.S.transfer);this.S.adsPlaybackData&&e.push.apply(e,g.UO(this.S.adsPlaybackData));this.S.drmLicense&&e.push(this.S.drmLicense);this.S.offlineVideoPolicy&&e.push(this.S.offlineVideoPolicy);this.S.videoDownloadContextEntity&&e.push(this.S.videoDownloadContextEntity);return[].concat(g.UO(new Set(e)))};
g.b(BWG,zv);BWG.prototype.T=function(){return[]};
g.b(hwG,zv);hwG.prototype.T=function(){var e=[];this.S.offlineVideoStreams&&e.push.apply(e,g.UO(this.S.offlineVideoStreams));this.S.captionTrack&&e.push.apply(e,g.UO(this.S.captionTrack));return[].concat(g.UO(new Set(e)))};
g.b(cPV,zv);cPV.prototype.T=function(){return[]};
g.b(oPG,zv);oPG.prototype.T=function(){return[]};
g.b(nPa,zv);nPa.prototype.T=function(){return[]};
g.b(yPG,zv);yPG.prototype.T=function(){return[]};
g.b(TW9,zv);TW9.prototype.T=function(){return[]};
g.b(Xya,zv);Xya.prototype.T=function(){return[]};
g.b(fN9,zv);fN9.prototype.T=function(){return[]};
g.b(AP9,zv);AP9.prototype.T=function(){return[]};
g.b(U_N,zv);U_N.prototype.T=function(){return[]};
g.b(CE8,zv);CE8.prototype.T=function(){return[]};
g.b(GQV,zv);GQV.prototype.T=function(){return[]};
g.b(EPZ,zv);EPZ.prototype.T=function(){return[]};
g.b(bNa,zv);bNa.prototype.T=function(){return[]};
g.b(tCN,zv);tCN.prototype.T=function(){return[]};
g.b(gPN,zv);gPN.prototype.T=function(){return[]};
g.b(ZNa,zv);ZNa.prototype.T=function(){return[]};
g.b(ONa,zv);ONa.prototype.T=function(){return[]};
g.b(kQG,zv);kQG.prototype.T=function(){return[]};
g.b(d_8,zv);d_8.prototype.T=function(){return[]};
g.b(JP8,zv);JP8.prototype.T=function(){return[]};
g.b(D_G,zv);D_G.prototype.T=function(){return[]};
var Jnl=["browse","music/browse","unplugged/browse"],Wsl=["offline/playlist_sync_check"],GkM=["offline"],DeV=["offline/offline_video_playback_position_sync"],$ea=["offline/get_playback_data_entity"],NF;xv.getInstance=function(){return g.Y(function(e){return e.return(new Promise(function(a){g.mQ().then(function(r){r?(xv.instance||(xv.instance=new xv(r)),a(xv.instance)):a(void 0)})}))})};
xv.prototype.get=function(e){var a=this,r,P,B;return g.Y(function(h){if(h.T==1)return g.l(h,WKG(a.token),2);if(h.T!=3)return r=h.S,g.l(h,r.get("prefs",e),3);P=h.S;if(!P)return h.return();B=(0,g.Ov)();return P.expirationTimestampMs<=B?h.return():h.return(P.value)})};
xv.prototype.set=function(e,a,r){r=r===void 0?31536E3:r;var P=this,B,h,c;return g.Y(function(y){if(y.T==1)return B=(0,g.Ov)(),h={key:e,value:a,expirationTimestampMs:B+r*1E3},g.l(y,WKG(P.token),2);c=y.S;return g.l(y,g.$h(c,"prefs",h),0)})};
xv.prototype.remove=function(e){var a=this,r;return g.Y(function(P){if(P.T==1)return g.l(P,WKG(a.token),2);r=P.S;return g.l(P,r.delete("prefs",e),0)})};
g.b(IC,g.I6);g.b(HX,py5);HX.prototype.B=function(e,a){a=zw8(a);e=(new TextEncoder).encode(JSON.stringify(e));return this.S.encrypt(e,a)};
HX.prototype.T=function(e,a){if(!(e instanceof Uint8Array))throw lNN(1);var r=new TextDecoder;a=zw8(a);e=this.S.decrypt(e,a);return JSON.parse(r.decode(e))};
var NWN={accountLinkStatusEntity:uEG,booleanEntity:qw5,buttonEntity:tCN,captionTrack:KeZ,channelHandle:x1a,chipEntity:fN9,commerceAcquisitionClientPayloadEntity:ZNa,commerceCartListEntity:ONa,contextNoteFeedEntityPayload:Isb,contextNoteUserRatingEntityPayload:HrG,continuationTokenEntity:ASN,downloadQualityPickerEntity:rSN,downloadsPageRefreshTokenEntity:B9V,downloadsPageViewConfigurationEntity:OeM,downloadStatusEntity:Pba,dismissState:AP9,sfvAudioItemCurrentlyPlayingEntity:yPG,emojiFountainDataEntity:EPZ,
emojiCustomizationSetEntity:GQV,fakeChannel:RF8,fakePlaylist:SwN,fakePlaylistEntryCollection:m1a,fakeVideo:FS9,fakeVideoDescription:MOM,featuredProductsEntity:lO8,flowStateEntity:j5M,iconBadgeEntity:kQG,interstitialInteractionStateEntity:ecG,likeButtonAnimationEntity:kpM,liveChatPollStateEntity:aOB,liveViewerLeaderboardChatEntryPointStateEntity:oPG,liveViewerLeaderboardPointsEntity:nPa,liveReactionsDataEntity:bNa,logoEntity:KSB,macroMarkerEntity:dq5,mainDownloadsLibraryEntity:hcV,mainDownloadsListEntity:oqB,
mainPlaylistDownloadStateEntity:nq8,mainPlaylistEntity:Uqw,mainPlaylistVideoEntity:Cb5,mainVideoDownloadStateEntity:ySN,mainVideoEntity:tkB,markersEngagementPanelSyncEntity:JSb,markersVisibilityOverrideEntity:DqZ,musicAlbumReleaseDetail:xqw,musicAlbumReleaseDownloadMetadataEntity:w1l,musicAlbumRelease:N9Z,musicAlbumReleaseUserDetail:IOG,musicArtistDetail:qeM,musicArtist:Hea,musicArtistUserDetail:vq5,musicDownloadsLibraryEntity:p1M,musicLibraryEdit:Rcw,musicLibraryStatusEntity:SeB,musicPlaylist:mq9,
musicPlaylistDownloadMetadataEntity:ieM,musicShare:FeN,musicTrackDetail:jsB,musicTrackDownloadMetadataEntity:zc8,musicTrack:Mk8,musicTrackUserDetail:ut9,offlineOrchestrationActionWrapperEntity:ew5,offlineVideoPolicy:aNB,offlineVideoStreams:rPN,offlineabilityEntity:T9G,orchestrationWebSamplingEntity:X1M,pageHeaderEntity:U_N,pdpStateEntity:d_8,pinnedProductEntity:Lea,playbackData:PE5,playerStateEntity:VkG,quantityIncrementerEntity:JP8,refresh:BWG,saveToPlaylistListEntity:TW9,selectedChipIndexEntityPayload:$qa,
settingEntity:Xya,stringEntity:vcl,suggestedFeedbackChipStateEntity:Qsl,transfer:hwG,trendingOfferEntity:Yew,videoDownloadContextEntity:cPV,videoOverviewAsyncDataEntity:D_G,videoPlaybackPositionEntity:gPN,votingEntity:CE8,ytMainChannelEntity:gqB,youchatPendingResponseEntity:WeB,ytMainDownloadedVideoEntity:fO9,ytMainVideoEntity:ZeG};g.b(mL,py5);mL.prototype.B=function(e){return e};
mL.prototype.T=function(e){if(e instanceof Uint8Array)throw lNN(0);return e};
g.b(FG,g.N);FG.prototype.observe=function(e){var a=this;this.observers.push(e);return function(){var r=a.observers.indexOf(e);r>=0&&a.observers.splice(r,1)}};
FG.prototype.T=function(e){KK5(this,e.data)};
FG.prototype.RH=function(){this.channel.close()};
var BkG,rnG=new g.Zj("elementsCommand");var dB=new g.Zj("entityBatchUpdate");var vO9=new g.Zj("downloadStatusEntity");var ca5=new g.Zj("mainPlaylistEntityActionMetadata");var MZ=new g.Zj("mainVideoEntityActionMetadata");var C9N=new g.Zj("musicPlaylistEntityActionMetadata");var Ijw=new g.Zj("musicTrackEntityActionMetadata");var ZGB=new g.Zj("localImageEntityActionMetadata");var pM=new g.Zj("playbackDataActionMetadata");var PYa=new g.Zj("transferEntityActionMetadata");var HX9=new g.Zj("videoPlaybackPositionEntityActionMetadata");var tUN;new g.fp;new g.fp;dia.prototype.request=function(e,a,r){a=a===void 0?{}:a;return this.locks.request(e,a,function(P){return r(P)})};var Pq=g.uq.caches,rB,QzB;ao.prototype.open=function(e){return Pq.open(VUl(e))};
ao.prototype.has=function(e){return Pq.has(VUl(e))};
ao.prototype.delete=function(e){return Pq.delete(VUl(e))};
ao.prototype.match=function(e,a){var r=this,P,B,h,c,y,T;return g.Y(function(X){switch(X.T){case 1:return g.l(X,r.keys(),2);case 2:P=X.S,B=g.Z(P),h=B.next();case 3:if(h.done){X.Oo(5);break}c=h.value;return g.l(X,r.open(c),6);case 6:return y=X.S,g.l(X,y.match(e,a),7);case 7:if(T=X.S)return X.return(T);h=B.next();X.Oo(3);break;case 5:return X.return()}})};
g.b(DiN,ao);DiN.prototype.keys=function(){var e,a,r,P,B,h,c,y,T;return g.Y(function(X){if(X.T==1)return e=[],a=g.Hh("CacheStorage keys"),g.l(X,Pq.keys(),2);r=X.S;P=g.Z(r);for(B=P.next();!B.done;B=P.next()){h=B.value;var f=h.indexOf(":");c=f===-1?{Hb:h}:{Hb:h.substring(0,f),datasyncId:h.substring(f+1)};y=c.Hb;T=c.datasyncId;T===a&&e.push(y)}return X.return(e)})};g.b(h8,g.N);h8.prototype.B=function(e){this.api.qF("onOfflineOperationFailure",e.data)};
h8.prototype.L=function(e){this.api.publish("offlinetransferpause",e.data)};
h8.prototype.RH=function(){var e;(e=this.S)==null||e.close();var a;(a=this.T)==null||a.close()};L0w.prototype.GG=function(){this.S&&oo(this)};
L0w.prototype.m7=function(){this.T&&this.T.resolve();this.B=this.S=!1;this.N()};var tG5=["OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD","OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH"];var K0b="captionTrack downloadStatusEntity ytMainChannelEntity mainPlaylistEntity mainPlaylistDownloadStateEntity mainPlaylistVideoEntity mainVideoEntity mainVideoDownloadStateEntity offlineVideoPolicy offlineVideoStreams playbackData transfer videoDownloadContextEntity videoPlaybackPositionEntity".split(" ");var Ti9="downloadStatusEntity musicAlbumRelease musicDownloadsLibraryEntity musicPlaylist musicTrack musicTrackDownloadMetadataEntity offlineVideoPolicy offlineVideoStreams playbackData transfer videoDownloadContextEntity".split(" ");g.b(LsN,LM);LsN.prototype.T=function(e){return XA(e)?pPG(this,e):fM(e)?Nil(this,e):Promise.reject(Error("Unsupported action type: "+e.actionType))};g.b(xeb,LM);xeb.prototype.T=function(e){return fM(e)?InZ(this,e):qmG(e)?qCb(this,e):A8(e)?v4N(this,e):Promise.reject(Error("Unsupported action type: "+e.actionType))};g.E=RtN.prototype;g.E.Hrm=function(e){var a=this,r,P,B,h;return g.Y(function(c){if(!g.S(e.state,128))return c.Oo(0);r=e.state.xu;var y=(P=r)==null?void 0:P.errorCode,T=(B=r)==null?void 0:B.Xp;h=y==="net.connect"&&T===1?"TRANSFER_FAILURE_REASON_NETWORK_LOST":(y==null?0:y.startsWith("net."))?"TRANSFER_FAILURE_REASON_NETWORK":"TRANSFER_FAILURE_REASON_INTERNAL";return g.l(c,a.zF(a.player.getVideoData().videoId,h),0)})};
g.E.zF=function(e,a){var r=this;return g.Y(function(P){if(P.T==1){if(r.T)return P.return();r.T=!0;return a==="TRANSFER_FAILURE_REASON_NETWORK_LOST"?(NZ(r,e,!1,!0),P.Oo(0)):g.l(P,zf(r,e),3)}g.aG(e,4);return g.l(P,r.S.zF(a),0)})};
g.E.JT=function(e){e.status===2?(e.status!==this.B&&(IwN(this.S),g.aG(e.videoId,2)),e.Bg&&Syb(this.S,e.videoId,e.Bg)):e.status===4?(zf(this,e.videoId),this.zF(e.videoId,e.CF?"TRANSFER_FAILURE_REASON_FILESYSTEM_WRITE":"TRANSFER_FAILURE_REASON_INTERNAL")):e.status===1&&R7a(this.S);this.B=e.status;this.api.qF("localmediachange",{videoId:e.videoId,status:e.status})};
g.E.g$=function(){var e=this,a;return g.Y(function(r){if(r.T==1){if(e.T)return r.return();e.T=!0;a=e.player.getVideoData().videoId;return g.l(r,zf(e,a),2)}return g.l(r,e.S.g$(),0)})};
g.E.Ya=function(e){switch(e){case "HD_1080":return"hd1080";case "HD":return"hd720";case "SD":return"large";case "LD":return"tiny";default:return"hd720"}};
g.E.X=function(e){return this.api.G().X(e)};g.b(uuV,LM);uuV.prototype.T=function(e){return XA(e)?e7V(this,e):fM(e)?awl(this,e):qmG(e)?riV(this,e):Promise.reject(Error("Unsupported action type: "+e.actionType))};nxM.prototype.S=function(e,a){var r=e.action.actionMetadata.priority-a.action.actionMetadata.priority;r===0&&(e.S<a.S?r=-1:e.S>a.S&&(r=1));return r};g.b(xo,g.N);xo.prototype.RH=function(){this.N&&this.N();g.N.prototype.RH.call(this)};
xo.prototype.createAction=function(e,a){var r=g.sV(e.entityKey).entityType,P=g.Ch(16);return new bM(r,P,e,a.actionId,a.rootActionId)};
xo.prototype.oH=function(e){var a=this,r,P,B,h,c,y,T,X,f;return g.Y(function(A){if(A.T==1){if(a.wP())return A.return();P=(r=e.offlineOrchestrationActionWrapperEntity)!=null?r:new Set;B=[];h=g.Z(P);for(c=h.next();!c.done;c=h.next())y=c.value,T=g.sV(y),X=T.entityId,XDM(a.S,X)||B.push(y);return g.l(A,OTV(a,B),2)}f=A.S;return g.l(A,ZTa(a,f),0)})};
xo.prototype.retry=function(){var e=this;return g.Y(function(a){return g.l(a,k$V(e),0)})};JiB.prototype.hH=function(e,a){a=a===void 0?!0:a;var r=this,P,B,h,c,y,T,X,f;return g.Y(function(A){switch(A.T){case 1:if(!r.S)return A.return();P=[];B=g.o7(r.S.T,a);h=[];for(c={Rp:0};c.Rp<B.length;c={Rp:c.Rp},c.Rp++)y=B[c.Rp],T=r.S.zz(y,"json3"),X=g.de(T,{withCredentials:!0,format:"RAW"},3,500).then(function(U){return function(C){C={metadata:g.xG(B[U.Rp]),trackData:C.xhr.responseText};h.push(C)}}(c)).Vl(function(U){Bq("Caption fetch error",U)}),P.push(X);
return g.l(A,NT5(P),2);case 2:return g.kN(A,3),g.l(A,f_N(e,h),5);case 5:g.Dl(A,0);break;case 3:f=g.Q3(A),Bq("Caption DB transaction error",f),g.OO(A)}})};g.b(Io,g.N);Io.prototype.RH=function(){this.T&&this.T();g.N.prototype.RH.call(this)};
Io.prototype.B=function(e){var a=this,r,P,B,h,c,y,T,X;return g.Y(function(f){P=(r=e.transfer)!=null?r:new Set;B=[];h=g.Z(P);for(c=h.next();!c.done;c=h.next())y=c.value,T=g.sV(y),X=T.entityId,B.push(X);return B.length===0?f.return():g.l(f,$o5(a,B),0)})};g.b(YyM,g.N);g.E=YyM.prototype;g.E.RH=function(){this.TQ&&this.TQ();this.Eo.dispose();this.L.dispose();this.e1&&g.ub(this.Z.e_,this.e1);this.Cf&&g.ub(this.Z.e_,this.Cf);g.N.prototype.RH.call(this)};
g.E.mdo=function(e){var a=this,r,P,B;return g.Y(function(h){switch(h.T){case 1:r=g.mf(e,"transfer");if(a.S&&r===a.S.key){NZ(a.D,a.C,!0);a.L.stop();h.Oo(0);break}return g.l(h,MF(a.T,{mode:"readwrite",DD:!0},function(c){return qF(c,r,"transfer").then(function(y){if(y&&y.transferState!=="TRANSFER_STATE_COMPLETE"&&y.transferState!=="TRANSFER_STATE_FAILED")return y.transferState="TRANSFER_STATE_PAUSED_BY_USER",Sx(c,y,"transfer").then(function(){return y})})}),3);
case 3:P=h.S;if(!P){h.Oo(0);break}if(!e||!a.B){h.Oo(5);break}return g.l(h,U6(e,a.B,a.T,"DOWNLOAD_STATE_PAUSED"),5);case 5:return g.l(h,vq(a,e),7);case 7:B=h.S,I_G({videoId:e,rb:P,offlineModeType:B}),g.OO(h)}})};
g.E.ci1=function(){var e=this;if(this.S&&this.C){NZ(this.D,this.C,!1);var a=this.S,r=(a==null?0:a.key)?g.sV(a.key).entityId:"";r&&this.B&&(new Promise(function(P,B){U6(r,e.B,e.T,"DOWNLOAD_STATE_PAUSED").catch(function(h){B(h)})})).catch(function(P){Bq("Download state setting error",P)})}this.L.stop()};
g.E.Aq=function(){this.S?iTN(this,this.S):qZ(this)};
g.E.PF=function(e){var a=this;return g.Y(function(r){switch(r.T){case 1:if(!a.S){r.Oo(2);break}if(a.S.transferState==="TRANSFER_STATE_COMPLETE"||a.S.transferState==="TRANSFER_STATE_FAILED"||!e.transfer||!e.transfer.has(a.S.key)){r.Oo(3);break}return g.l(r,um(a.T,a.S.key,"transfer"),4);case 4:a.S=r.S;if(a.S){r.Oo(3);break}return g.l(r,z7a(a),3);case 3:if(a.S)return r.return();case 2:return g.l(r,qZ(a),0)}})};
g.E.zF=function(e,a){var r=this,P,B,h,c,y;return g.Y(function(T){switch(T.T){case 1:if(!r.S){Ro(r,"onTransferFailure: "+e);T.Oo(2);break}P=r.S;h=((B=P)==null?0:B.key)?g.sV(P.key).entityId:"";a:switch(e){case "TRANSFER_FAILURE_REASON_FILESYSTEM_WRITE":case "TRANSFER_FAILURE_REASON_EXTERNAL_FILESYSTEM_WRITE":case "TRANSFER_FAILURE_REASON_PLAYABILITY":case "TRANSFER_FAILURE_REASON_TOO_MANY_RETRIES":var X=!1;break a;default:X=!0}return X&&scG(r)?g.l(T,S4(r,"TRANSFER_STATE_TRANSFER_IN_QUEUE"),8):g.l(T,
moZ(r,e),5);case 5:if(!h||!r.B){T.Oo(2);break}return g.l(T,U6(h,r.B,r.T,"DOWNLOAD_STATE_FAILED"),2);case 8:return g.l(T,vq(r,h),9);case 9:c=T.S;yS({transferStatusType:"TRANSFER_STATUS_TYPE_REENQUEUED_BY_RETRY"},{videoId:h,rb:P,offlineModeType:c});if(!h||!r.B){T.Oo(2);break}return g.l(T,U6(h,r.B,r.T,"DOWNLOAD_STATE_RETRYABLE_FAILURE"),2);case 2:Hq(r),y=qZ(r,!0),a&&a(y),g.OO(T)}})};
g.E.g$=function(e){var a=this,r,P,B,h,c,y,T,X,f,A,U,C;return g.Y(function(G){switch(G.T){case 1:if(!a.S){Ro(a,"onMaybeTransferStreamsExpired");G.Oo(2);break}return scG(a)?g.l(G,S4(a,"TRANSFER_STATE_WAITING_FOR_PLAYER_RESPONSE_REFRESH"),9):g.l(G,moZ(a,"TRANSFER_FAILURE_REASON_STREAM_MISSING"),5);case 5:if(!a.B){G.Oo(2);break}r=a.S;B=((P=r)==null?0:P.key)?g.sV(r.key).entityId:"";if(!B){G.Oo(2);break}return g.l(G,U6(B,a.B,a.T,"DOWNLOAD_STATE_FAILED"),2);case 9:return a.S||Ro(a,"onMaybeTransferStreamsExpiredRetryAttempting"),
h=a.S,y=((c=h)==null?0:c.key)?g.sV(h.key).entityId:"",g.l(G,vq(a,y),10);case 10:return T=G.S,yS({transferStatusType:"TRANSFER_STATUS_TYPE_DEQUEUED_BY_PLAYER_RESPONSE_EXPIRATION"},{videoId:y,rb:h,offlineModeType:T}),X=szl(),g.L4(X,pM,{isEnqueuedForExpiredStreamUrlRefetch:!0}),f=g.mf(y,"playbackData"),A={actionType:"OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",entityKey:f,actionMetadata:X},U=gB(new bM("playbackData",y,A)),g.l(G,jx(a.T,U,"offlineOrchestrationActionWrapperEntity"),2);case 2:Hq(a),C=qZ(a,!0),
e&&e(C),g.OO(G)}})};
var uv8={},FDV=(uv8.TRANSFER_STATE_TRANSFERRING=1,uv8.TRANSFER_STATE_TRANSFER_IN_QUEUE=2,uv8);g.E=s6.prototype;g.E.vL=function(){return this.C.promise};
g.E.bH=function(){if(this.T&&this.D)return this.C.promise;uTw(this).then(this.C.resolve).catch(this.C.reject);return this.C.promise};
g.E.IC=function(e){var a={};return a.playbackData=new LsN(e,this.iW,this.S),a.transfer=new uuV(e,this.iW),a.videoPlaybackPositionEntity=new xeb(e,this.iW),a};
g.E.Cn=function(){var e=this;return g.Y(function(a){return e.T?g.l(a,wDM(e.T),0):a.Oo(0)})};
g.E.O0=function(){var e=this,a,r;return g.Y(function(P){if(P.T==1)return e.T||e.D?g.l(P,e.vL(),2):P.return();e.Y!==void 0&&(g.Al(e.Y),e.Y=void 0);e.L!==void 0&&(g.Al(e.L),e.L=void 0);(a=e.T)==null||a.dispose();e.T=void 0;(r=e.D)==null||r.dispose();e.D=void 0;e.api.qF("onOrchestrationLostLeader");e.C=new g.fp;g.OO(P)})};
g.E.isOrchestrationLeader=function(){return this.B.S};
g.E.Ut=function(){return g.Y(function(e){return e.return(!1)})};
g.E.AG=function(e){var a=this.S;a.api.publish("offlinetransferpause",e);var r;(r=a.T)==null||r.postMessage(e)};
g.E.Aq=function(e){var a,r;return g.Y(function(P){if(P.T==1)return g.l(P,e4(),2);a=P.S;if(!a)return P.return();r=g.mf(e,"transfer");return g.l(P,MF(a,{mode:"readwrite",DD:!0},function(B){var h=qF(B,r,"transfer"),c=qF(B,g.mf(e,"videoDownloadContextEntity"),"videoDownloadContextEntity");return g.bk.all([h,c]).then(function(y){y=g.Z(y);var T=y.next().value;var X=y.next().value;return T&&T.transferState==="TRANSFER_STATE_PAUSED_BY_USER"?(T.transferState="TRANSFER_STATE_TRANSFER_IN_QUEUE",Sx(B,T,"transfer").then(function(){yS({transferStatusType:"TRANSFER_STATUS_TYPE_REENQUEUED_BY_USER_RESUME",
statusType:"USER_RESUMED"},{videoId:e,rb:T,offlineModeType:X==null?void 0:X.offlineModeType});return g.bk.resolve(null)})):g.bk.resolve(null)})}),0)})};
g.E.pn=function(e){e=e===void 0?43200:e;var a=this,r,P,B,h,c,y,T,X;return g.Y(function(f){if(f.T==1)return a.Z.ZY()?g.l(f,e4(),2):f.return(KDB());if(f.T!=3){r=f.S;if(!r)return f.return([]);P=Date.now()/1E3;return g.l(f,Kb(r,"offlineVideoPolicy"),3)}B=f.S;h=[];c=g.Z(B);for(y=c.next();!y.done;y=c.next())T=y.value,Number(T.lastUpdatedTimestampSeconds)+e<=P&&(X=g.sV(T.key).entityId,h.push(X));return h.length?f.return(mB(a,h,a.N,"OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH")):f.return([])})};
g.E.deleteAll=function(){return mB(this,["!*$_ALL_ENTITIES_!*$"],this.N,"OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE",{offlineLoggingData:{offlineDeleteReason:"OFFLINE_DELETE_REASON_USER_INITIATED"}})};
g.E.refreshAllStaleEntities=function(e){var a=this;return g.Y(function(r){return r.T==1?g.l(r,a.pn(e),2):r.return(r.S)})};
g.E.setUpPositionSyncInterval=function(e){var a=this;this.L!==void 0&&(g.Al(this.L),this.L=void 0);var r=e!=null?e:864E5;this.L=g.Xw(function(){a.lD(r)},r)};
g.E.lD=function(e){var a=this,r,P,B,h,c,y;return g.Y(function(T){switch(T.T){case 1:return g.kN(T,2),g.l(T,xv.getInstance(),4);case 4:r=T.S;if(!r)throw Error("prefStorage is undefined");return g.l(T,r.get("psi"),5);case 5:P=T.S;h=((B=P)==null?0:B.Kc)?Number(P.Kc)/1E3:0;c=Date.now();if(!(h+e<=c)){T.Oo(6);break}return g.l(T,mB(a,["!*$_ALL_ENTITIES_!*$"],"videoPlaybackPositionEntity","OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH"),6);case 6:g.Dl(T,0);break;case 2:y=g.Q3(T),Bq("Offline manager error",y),
g.OO(T)}})};
g.E.WH=function(){var e=this,a,r,P,B,h,c,y;return g.Y(function(T){if(T.T==1)return g.l(T,e4(),2);if(T.T!=3)return(a=T.S)?g.l(T,Kb(a,"transfer"),3):T.return([]);r=T.S;P=[];B=g.Z(r);for(h=B.next();!h.done;h=B.next())c=h.value,c.transferState==="TRANSFER_STATE_WAITING_FOR_PLAYER_RESPONSE_REFRESH"&&c.key&&(y=g.sV(c.key).entityId,P.push(y));return T.return(aj8(e,P))})};
g.E.XS=function(){return g.Y(function(e){return e.return([])})};
g.E.jG=function(){return g.Y(function(e){g.OO(e)})};
g.E.qL=function(){return g.Y(function(e){g.OO(e)})};g.b(raa,LM);raa.prototype.T=function(e){return XA(e)?hna(this,e):fM(e)?om8(this,e):A8(e)?nmN(this,e):Promise.reject(Error("Unsupported action type: "+e.actionType))};
var FA=[10];g.b(Aa9,LM);Aa9.prototype.T=function(e){return XA(e)?GtM(this,e):fM(e)?EmN(this,e):A8(e)?bGZ(this,e):Promise.reject(Error("Unsupported action type: "+e.actionType))};
var Cx8=[10];g.b(gm9,LM);gm9.prototype.T=function(e){return fM(e)?OGN(this,e):Promise.reject(Error("Unsupported action type: "+e.actionType))};g.b(kta,s6);g.E=kta.prototype;g.E.IC=function(e){var a=s6.prototype.IC.call(this,e);a.mainVideoEntity=new Aa9(e,this.iW,this.S);a.mainPlaylistEntity=new raa(e,this.iW,this.S);a.mainDownloadsListEntity=new gm9(e,this.iW,this.S);return a};
g.E.refreshAllStaleEntities=function(e,a){var r=this,P,B,h,c,y,T,X,f,A,U,C;return g.Y(function(G){switch(G.T){case 1:P=[];if(!r.iW.X("web_player_offline_playlist_auto_refresh")){G.Oo(2);break}return g.l(G,dAN(r,e,a),3);case 3:P=G.S;case 2:return g.l(G,xv.getInstance(),4);case 4:return B=G.S,g.l(G,(h=B)==null?void 0:h.get("sdois"),5);case 5:return c=G.S,g.l(G,(y=B)==null?void 0:y.get("lmqf"),6);case 6:T=G.S;if(!c){G.Oo(7);break}f=P;A=f.concat;return g.l(G,Jaw(r,c,(X=T)!=null?X:"SD",e===0),8);case 8:P=
A.call(f,G.S);case 7:return U=P,C=U.concat,g.l(G,s6.prototype.refreshAllStaleEntities.call(r,e,a),9);case 9:return P=C.call(U,G.S),G.return(P)}})};
g.E.Ut=function(e){var a,r,P,B,h,c,y,T;return g.Y(function(X){if(X.T==1)return g.l(X,e4(),2);if(X.T!=3)return(a=X.S)?g.l(X,um(a,g.xi,"mainDownloadsListEntity"),3):X.return(!1);r=X.S;if((P=r)==null?0:(B=P.downloads)==null?0:B.length)for(h=g.mf(e,"mainVideoEntity"),c=g.Z(r.downloads),y=c.next();!y.done;y=c.next())if(T=y.value,T.videoItem===h)return X.return(!0);return X.return(!1)})};
g.E.XS=function(){var e=this,a,r,P,B,h,c,y,T;return g.Y(function(X){if(X.T==1)return g.l(X,e4(),2);if(X.T!=3)return(a=X.S)?g.l(X,Kb(a,"downloadStatusEntity"),3):X.return([]);r=X.S;P=[];B=g.Z(r);for(h=B.next();!h.done;h=B.next())c=h.value,c.downloadState==="DOWNLOAD_STATE_USER_DELETED"&&c.key&&(y=g.sV(c.key).entityId,P.push(y));return P.length?(T={offlineLoggingData:{offlineDeleteReason:"OFFLINE_DELETE_REASON_USER_INITIATED"}},X.return(mB(e,P,"mainVideoEntity","OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE",
T))):X.return([])})};
g.E.qL=function(){var e;return g.Y(function(a){return a.T==1?g.l(a,e4(),2):(e=a.S)?g.l(a,MF(e,{mode:"readwrite",DD:!0},function(r){return vX(r,"mainVideoEntity").then(function(P){var B=[];P=g.Z(P);for(var h=P.next();!h.done;h=P.next()){h=h.value;var c=void 0;(c=h.userState)!=null&&c.playbackPosition||(c=g.sV(h.key).entityId,c={key:g.mf(c,"videoPlaybackPositionEntity"),videoId:c,lastPlaybackPositionSeconds:"0"},B.push(Sx(r,c,"videoPlaybackPositionEntity")),h.userState={playbackPosition:c.key},B.push(Sx(r,
h,"mainVideoEntity")))}return g.bk.all(B)})}),0):a.return()})};
g.E.jG=function(){var e,a,r,P,B,h,c,y,T,X,f,A,U,C,G,O,d,W,V,L,z,q,M,m,cI,CL,nL,y3,aT,$N,F4,ea,EG,n5,lq,cd,iN,vB;return g.Y(function(oQ){if(oQ.T==1)return g.l(oQ,e4(),2);if(oQ.T!=3){e=oQ.S;if(!e)return oQ.return();a=g.mf("DOWNLOADS_LIST_ENTITY_ID_MANUAL_DOWNLOADS","mainDownloadsListEntity");return g.l(oQ,MF(e,{mode:"readonly",DD:!0},function(Q){return g.bk.all([qF(Q,a,"mainDownloadsListEntity"),qF(Q,g.xi,"mainDownloadsListEntity"),vX(Q,"mainVideoEntity"),vX(Q,"mainPlaylistEntity")])}),3)}r=oQ.S;
P=g.Z(r);B=P.next().value;h=P.next().value;c=P.next().value;y=P.next().value;T=B;X=h;f=c;A=y;U=new Set;if((C=T)==null?0:(G=C.downloads)==null?0:G.length)for(O=g.Z(T.downloads),d=O.next();!d.done;d=O.next())W=d.value,V=void 0,(L=(V=W.videoItem)!=null?V:W.playlistItem)&&U.add(L);if((z=X)==null?0:(q=z.downloads)==null?0:q.length)for(M=g.Z(X.downloads),m=M.next();!m.done;m=M.next())cI=m.value,cI.videoItem&&U.add(cI.videoItem);CL=new Set;nL=[];y3=g.Z(A);for(aT=y3.next();!aT.done;aT=y3.next()){$N=aT.value;
if($N.videos)for(F4=g.Z($N.videos),ea=F4.next();!ea.done;ea=F4.next())EG=ea.value,(n5=JSON.parse(g.sV(EG).entityId).videoId)&&CL.add(n5);$N.key&&!U.has($N.key)&&nL.push($N.key)}lq=g.Z(f);for(cd=lq.next();!cd.done;cd=lq.next())iN=cd.value,iN.key&&!U.has(iN.key)&&(vB=g.sV(iN.key).entityId,CL.has(vB)||nL.push(iN.key));return nL.length?g.l(oQ,cn9(e,nL),0):oQ.Oo(0)})};g.b(DAB,LM);DAB.prototype.T=function(e){return XA(e)?$A5(this,e):fM(e)?QMa(this,e):A8(e)?WVb(this,e):Promise.reject(Error("Unsupported action type: "+e.actionType))};
var j4=[10];g.b(LVN,LM);LVN.prototype.T=function(e){return XA(e)?wVB(this,e):fM(e)?pV8(this,e):A8(e)?iGG(this,e):Promise.reject(Error("Unsupported action type: "+e.actionType))};
var uM=[10];g.b(xAw,LM);xAw.prototype.T=function(e){return XA(e)?vmw(this,e):fM(e)?Rnw(this,e):A8(e)?S7G(this,e):Promise.reject(Error("Unsupported action type: "+e.actionType))};
var q7V=[10];g.b(KM,s6);KM.prototype.IC=function(e){var a=s6.prototype.IC.call(this,e);a.musicTrack=new xAw(e,this.S);a.musicPlaylist=new LVN(e,this.S);a.musicAlbumRelease=new DAB(e,this.S);return a};
KM.prototype.refreshAllStaleEntities=function(e,a){var r=this,P,B,h;return g.Y(function(c){if(c.T==1)return g.l(c,mAl(r,e,a),2);if(c.T!=3)return B=P=c.S,h=B.concat,g.l(c,s6.prototype.refreshAllStaleEntities.call(r,e,a),3);P=h.call(B,c.S);return c.return(P)})};g.b(FVa,g.Vn);g.E=FVa.prototype;g.E.create=function(){var e=this;g.x(this,this.events);if(g.tZ(this.iW))this.S=new kta(this.iW,this.player);else if(g.L$(this.iW)||g.Zm(this.iW))this.S=new KM(this.iW,this.player);this.events.j(this.player,"onPlaybackStartExternal",function(){e.tQ()});
this.events.j(this.player,"videodatachange",function(){e.tQ()});
this.iW.X("html5_offline_playback_position_sync")&&this.events.j(this.player,"presentingplayerstatechange",this.Ct)};
g.E.FP=function(){return!1};
g.E.pG=function(e,a,r,P){var B=this;return g.Y(function(h){return B.S?h.return(mB(B.S,e,a,r,P)):h.return(Promise.reject())})};
g.E.deleteAll=function(){return this.S.deleteAll()};
g.E.pn=function(e){return this.S.pn(e)};
g.E.refreshAllStaleEntities=function(e){return this.S.refreshAllStaleEntities(e)};
g.E.setUpPositionSyncInterval=function(e){this.S.setUpPositionSyncInterval(e)};
g.E.AG=function(e){this.S.AG(e)};
g.E.Aq=function(e){return this.S.Aq(e)};
g.E.tQ=function(){var e=this,a;return g.Y(function(r){a=e.player.getVideoData();return g.UL(a)?MXl(a)&&e.T!==a.clientPlaybackNonce?g.l(r,jMN(e,a),0):r.Oo(0):r.return()})};
g.E.Ct=function(e){var a=this,r,P,B,h,c,y,T;return g.Y(function(X){if(X.T==1)return r=a.player.getVideoData(),P=r.QH,g.TH(e,2)||g.TH(e,512)?g.l(X,e4(),2):X.return();if(X.T!=3){B=X.S;if(!B)return Bq("PES is undefined"),X.return();h=r.videoId;return g.l(X,um(B,g.mf(h,"mainVideoEntity"),"mainVideoEntity"),3)}c=X.S;if(!c)return X.return();y=Math.floor(P).toString();T={videoPlaybackPositionEntityActionMetadata:{lastPlaybackPositionSeconds:y}};return g.l(X,a.pG([h],"videoPlaybackPositionEntity","OFFLINE_ORCHESTRATION_ACTION_TYPE_UPDATE",
T),0)})};
g.E.isOrchestrationLeader=function(){return this.S.isOrchestrationLeader()};
g.E.updateDownloadState=function(e,a){var r,P,B,h;return g.Y(function(c){if(c.T==1)return g.l(c,e4(),2);r=c.S;if(!r)return Bq("PES is undefined"),c.return();P=g.sV(e);B=P.entityType;h=P.entityId;return g.l(c,U6(h,B,r,a,!0),0)})};g.DD("offline",FVa);})(_yt_player);
